<rss version="2.0">
    <channel>    
        <title>Влад Костянецкий</title>
        <description>Привет! Меня зовут Влад, я — разработчик приложений для бизнеса.</description>
        <language>ru</language>
        <link>https://kostyanetsky.ru</link>
        <lastBuildDate>Mon, 11 Jan 2021 19:10:28 +0700</lastBuildDate>
        
        <item>
            <title>Старый добрый DATETIME</title>
            <link>https://kostyanetsky.ru/notes/old-but-gold/</link>
            <guid isPermaLink="false">note-old-but-gold</guid>
            <pubDate>Wed, 11 Nov 2020 17:00:50 +0700</pubDate>
            <description><p class="measure-wide">Порылся в сети по поводу типов дат в MS SQL Server и в целом вопроса «почему 1С до сих пор носится со своим смещением» больше не имею. Люди пишут о целой пачке проблем с DATETIME2:</p>
<ol class="measure-wide">
<li>Недоступна базовая математика. Без дополнительных финтов ушами не выйдет посчитать разницу между двумя датами, прибавить к дате день и так далее.</li>
<li>Стандартные функции по-прежнему возвращают старый добрый DATETIME (например, DATEADD). Если данные хранятся в DATETIME2 — потребуется конвертация.</li>
<li>Поля с этим типом <a class="link blue dim bb" href="https://sqlperformance.com/2016/04/sql-performance/surprises-dateadd">неважно</a> индексируются, так как каждое значение DATETIME2 хранится задом наперед (сначала время, потом дата). В итоге СУБД промахивается с оценкой количества строк, которое может вернуть запрос, и строит для него неэффективный план выполнения.</li>
</ol>
<p class="measure-wide">Подробнее о всем этом можно прочитать на <a class="link blue dim bb" href="https://towardsdatascience.com/datetime2-why-you-should-not-use-it-70e50ae2bab9">Towards Data Science</a> или, например, на <a class="link blue dim bb" href="https://www.sqlservercentral.com/forums/topic/why-do-some-dbas-avoid-datetime2">SQL Server Central</a>.</p></description>
        </item>
        
        <item>
            <title>Потерянное время</title>
            <link>https://kostyanetsky.ru/notes/lost-time/</link>
            <guid isPermaLink="false">note-lost-time</guid>
            <pubDate>Tue, 10 Nov 2020 19:06:41 +0700</pubDate>
            <description><p class="measure-wide">В MS SQL Server поля DATETIME <a class="link blue dim bb" href="https://docs.microsoft.com/ru-ru/dotnet/api/system.data.sqltypes.sqldatetime.minvalue?view=dotnet-plat-ext-3.1">не могут</a> хранить даты раньше 1753-го года. Например, если попытаться записать в базу 01.01.0001 — получим ругань на out-of-range value. Я считал это забавным для такой почтенной СУБД рудиментом, пока случайно не наткнулся на <a class="link blue dim bb" href="https://stackoverflow.com/questions/3310569/what-is-the-significance-of-1-1-1753-in-sql-server">причину</a>.</p>
<p class="measure-wide">Если вкратце, в 1752-м году Великобритания внедрила у себя Григорианский календарь, и в процессе у них из летосчисления пропало одиннадцать дней. Это породило проблему: вот хочет юзер посчитать разницу в днях между 1653-м и 1753-м годом — что делать будем? Учтем потеряшек? Проигнорируем? Сделаем какие-то хинты или настройки?</p>
<p class="measure-wide">Видимо, чтобы не городить неоднозначные механизмы, разработчики СУБД решили вопрос радикально — усечением доступного диапазона дат. А для тех, для кого это проблема, есть DATETIME2, который никаких ограничений не имеет.</p>
<p class="measure-wide">Платформа 1С пока использует DATETIME, а чтобы не иметь головной боли с хранением дат раньше 1753-го года — применяет специальный <a class="link blue dim bb" href="https://its.1c.ru/db/metod8dev/content/4055/hdoc">костыль</a>. Если в двух словах, когда платформа пишет даты в БД, то тихой сапой прибавляет к каждой две тысячи лет, а когда читает — вычитает обратно. То есть в 1С пользователь видит 01.01.2000, а в БД на самом деле хранится 01.01.4000.</p>
<p class="measure-wide">Любопытно, почему 1C до сих пор не выкинула эту штуку и не переехала со «старого» DATETIME на DATETIME2? Возможно, тут есть какие-то подводные камни, но среди разработчиков самой СУБД сомнений <a class="link blue dim bb" href="https://stackoverflow.com/questions/3310569/what-is-the-significance-of-1-1-1753-in-sql-server/3310627#3310627">не заметно</a>:</p>
<blockquote>
<p class="measure-wide">Your great great great great great great great grandfather should upgrade to SQL Server 2008 and use the DateTime2 data type, which supports dates in the range: 0001-01-01 through 9999-12-31.</p>
<p class="measure-wide"><em>Joe Stefanelli (SQL Server developer)</em></p>
</blockquote>
<p class="measure-wide">Возможно, это просто на дне приоритетов. Добавление и удаление двух тысяч лет для каждой даты, конечно, увеличивает нагрузку на оборудование, но на фоне остального она теряется.</p></description>
        </item>
        
        <item>
            <title>Халк удалять!</title>
            <link>https://kostyanetsky.ru/notes/hulk-removes/</link>
            <guid isPermaLink="false">note-hulk-removes</guid>
            <pubDate>Mon, 09 Nov 2020 16:03:07 +0700</pubDate>
            <description><p class="measure-wide">На <a class="link blue dim bb" href="https://postgrespro.ru/education/courses/DBA1">курсе</a> по PostgreSQL узнал смешную деталь: в 10-й версии СУБД разработчики переименовали папку pg_xlog (журналы предзаписи) в pg_wal, а папку pg_clog (статусы транзакций) — в pg_xact.</p>
<p class="measure-wide">Знаете, почему? Из-за не слишком опытных, но уже достаточно смелых администраторов, которые триггерились на слово «log» в названии папки. Мол, мне нужно место на диске освободить, а тут СУБД забила всё своими дурацкими логами. Некогда разбираться, rm -rf их и порядок!</p>
<p class="measure-wide">В общем, в трубу одновременно вылетала и защита работы с данными в буферном кэше, и многоверсионность. После чего кластер умирал в муках. Свободного места на диске получалось много, но радоваться этому, боюсь, приходилось недолго :-)</p></description>
        </item>
        
        <item>
            <title>Время для прогулки</title>
            <link>https://kostyanetsky.ru/notes/time-to-wink/</link>
            <guid isPermaLink="false">note-time-to-wink</guid>
            <pubDate>Mon, 02 Nov 2020 15:36:28 +0700</pubDate>
            <description><p class="measure-wide">Как понять, что надо сделать перерыв в работе? Скажем так: если ваш скрипт внезапно начал вам подмигивать — точно пора проветриться.</p>
<p class="measure-wide"><img alt="Привет!" src="https://kostyanetsky.ru/notes/time-to-wink/wink.png"/></p></description>
        </item>
        
        <item>
            <title>Расследование ошибки в Конфигураторе</title>
            <link>https://kostyanetsky.ru/notes/designer-error-investigation/</link>
            <guid isPermaLink="false">note-designer-error-investigation</guid>
            <pubDate>Sat, 31 Oct 2020 12:38:15 +0700</pubDate>
            <description><p class="measure-wide">Итак, Конфигуратор выдает ошибку; нужно её исправить или обойти. Это потенциально неприятный расклад: у нас нет никакого доступа к коду приложения. Тем не менее, чтобы решить проблему — важно понять, что именно делал Конфигуратор до сбоя и почему он не справился.</p>
<p class="measure-wide">Что может с этим помочь?</p>
<p class="measure-wide">Первое — сам текст ошибки. Нередко его вполне достаточно, чтобы мысли двинулись в правильном направлении. Если причиной сбоя стал запрос, то в ошибке будет ещё и сообщение от СУБД.</p>
<p class="measure-wide">Второе — технологический журнал по событиям EXCP, SDBL и DBMSSQL (DBPOSTGRS?) для t:applicationName=Designer. Из него мы получим информацию об исключениях внутри Конфигуратора и данные запросов, которые он выполняет (нередко они и есть причина ошибки).</p>
<p class="measure-wide">Кроме того, может пригодиться трассировка запросов к базе данных. Если используется MS SQL, то трассировку можно получить через Extended Events — конкретно, нас интересуют события error_reported, rpc_completed и sql_batch_completed. Общий принцип тот же — ловим ошибки выполнения запросов и сами запросы. </p>
<p class="measure-wide">Разберем пример — может, не самый показательный, зато свежий.</p>
<p class="measure-wide">Контекст — конфигурация, использующая <a class="link blue dim bb" href="https://v8.1c.ru/platforma/razdelenie-dannyh/">разделение данных</a>. Её база данных «нарезана» на кусочки (области данных), каждый из которых ничего не знает о своих соседях — сколько их, какого они размера и так далее. При этом в БД есть и общие данные — например, справочники, к которым можно обратиться из любой области. Как правило, это разная техническая информация — например, перечень объектов метаданных.</p>
<p class="measure-wide">Задача — исключить справочник FileStorageVolumes из основного разделителя. Сейчас этот справочник — разделенный: то есть, его данные от области к области будут различаться. Нам нужно сделать так, чтобы содержимое справочника стало одинаковым для всех областей.</p>
<p class="measure-wide">Задача несложная, так как таблица справочника пуста — ни одна из областей ничего в нем не хранит. Что же, применяем <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/designer-error-investigation/setup.png">настройку</a> и:</p>
<p class="measure-wide"><img alt="Исключение" src="https://kostyanetsky.ru/notes/designer-error-investigation/error.png"/></p>
<p class="measure-wide">В <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/designer-error-investigation/error.txt">тексте</a> исключения есть сообщения: одно от платформы, второе от СУБД. Первое озадачивает: то есть как это данные не уникальны? Справочник же пуст, никаких данных нет. Возможно, проблема в каких-то вспомогательных структурах, не связанных с содержимым справочника напрямую.</p>
<p class="measure-wide">Сообщение СУБД более внятное: MS SQL Server хотела создать уникальный индекс для таблицы _DataHistorySettingsNG, но не смогла, так как сочетания индексируемых полей оказались неуникальны. Приводится даже конкретное значение, из-за которого не получилось создать индекс: это NULL.</p>
<p class="measure-wide">Выводы?</p>
<ol class="measure-wide">
<li>Очевидно, что проблема возникла в ходе реструктуризации. Во-первых, именно её мы и делали. Во-вторых, на это указывает и операция CREATE UNIQUE INDEX (создание индексов в таблицах — часть реструктуризации), и название проблемной таблицы: в нём есть постфикс NG (его получают копии таблиц, которые создаются при реструктуризации; если она проходит успешно, то платформа удаляет исходную таблицу и переименовывает копию).</li>
<li>Проблема возникла с настройками механизма истории данных (_DataHistorySettings). Там хранится статус каждого объекта метаданных: нужно или нет вести историю данных для объекта, его полей и полей его табличных частей (если они есть).</li>
</ol>
<p class="measure-wide">Последнее объясняет, почему проблема уникальности возникла на пустом справочнике: настройки истории данных для объекта хранятся независимо от того, есть в объекте какие-то данные или нет. Если посмотреть на таблицу с настройками, там всего три поля: _MetadataId (ID объекта метаданных), _Content (значения настроек) и _Fld626 (разделитель области).</p>
<p class="measure-wide">До реструктуризации данные имеют примерно такой вид:</p>
<p class="measure-wide"><img alt="Таблица _DataHistorySettings" src="https://kostyanetsky.ru/notes/designer-error-investigation/table.png"/></p>
<p class="measure-wide">Однако потом эта картина изменилась. Когда мы исключили справочник из состава общего реквизита, конфигуратор запустил реструктуризацию: создал таблицу _DataHistorySettingsNG, перенес в неё данные из _DataHistorySettings и установил значение поля _Fld626 в NULL всем записям, которые относятся к справочнику FileStorageVolumes.</p>
<p class="measure-wide">К чему это привело? А вот к чему: для справочника FileStorageVolumes появился целый ворох настроек, которые не относятся к какой-либо области. Это само по себе звучит нездорово, но настоящие проблемы начались, когда Конфигуратор попытался создать для таблицы кластерный индекс: он <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/designer-error-investigation/index.png">строится</a> по полям _MetadataId и _Fld626, является уникальным и, соответственно, не может быть создан — в таблице множество записей, у которых различается только поле _Content, а _MetadataId и _Fld626 — гарантированно идентичны.</p>
<p class="measure-wide">Для очистки совести посмотрим <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/designer-error-investigation/20103116.log">техжурнал</a> (я вычистил оттуда нерелевантные события и другую постороннюю информацию). Наши догадки подтверждается: видим, как Конфигуратор создает и заполняет таблицу _DataHistorySettingsNG, пытается проиндексировать её, но получает ошибку и удаляет. В <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/designer-error-investigation/20103116.png">трассировке</a> СУБД примерно та же картина.</p>
<p class="measure-wide">На этом интересное заканчивается, так как решение достаточно очевидно: удаляем настройки истории данных для справочника во всей областях данных и повторяем реструктуризацию. Ошибку это не исправит, конечно; по хорошему, Конфигуратор должен предсказывать такую ситуацию и выдавать адекватное сообщение — как, например, при удалении измерения регистра сведений, которое приводит к нарушению уникальности измерений для записей регистра. Однако задача будет решена.</p>
<p class="measure-wide">В общем, готово — мы великолепны!</p></description>
        </item>
        
        <item>
            <title>Расчет количества исключений по ТЖ</title>
            <link>https://kostyanetsky.ru/notes/excp-number-by-minutes/</link>
            <guid isPermaLink="false">note-excp-number-by-minutes</guid>
            <pubDate>Sat, 24 Oct 2020 12:00:12 +0700</pubDate>
            <description><p class="measure-wide">Ещё <a class="link blue dim bb" href="https://github.com/vkostyanetsky/ScriptsFor1C/blob/master/Технологический%20журнал/ExceptionsNumberByMinutes.sh">скрипт</a>. Считает количество исключений в минуту и строит топ, по которому видно распределение. Можно быстро оценить периоды, когда программы сбоили особенно яростно.</p>
<p class="measure-wide">По ходу дела столкнулся в двумя любопытными проблемами, которые меня порядком сбили с толку. Во-первых, я почему-то был уверен, что uniq -c группирует строки вне зависимости от того, где в потоке данных они встречаются. Рассмотрим пример:</p>
<pre><code>банан
банан
груша
банан
</code></pre>
<p class="measure-wide">Я думал, что если отдать эти данные uniq -c, то она сгруппирует одинаковые строки, посчитает количество повторений и выдаст примерно такое:</p>
<pre><code>3 банан
1 груша
</code></pre>
<p class="measure-wide">Но на деле получилось так:</p>
<pre><code>2 банан
1 груша
1 банан
</code></pre>
<p class="measure-wide">Вывод: утилита uniq ожидает, что повторяющиеся строки идут одна за другой. Если строка отличается от предыдущей — она начинает считать счетчик совпадений для неё с нуля. То есть, чтобы получить тот результат, на который я рассчитывал — нужно сначала отсортировать данные, и только потом передавать их в uniq.</p>
<p class="measure-wide">Второй проблемой стала утилита sed. С помощью неё я пытался удалить из потока данных всё, кроме часов и минут (текст попытки на 12-й строке скрипта). Однако часть событий упорно не попадали под регулярку несмотря на то, что визуально никак не отличались. Я промаялся кучу времени и здорово разозлился, но потом вспомнил про существование <a class="link blue dim bb" href="https://ru.wikipedia.org/wiki/Маркер_последовательности_байтов">BOM</a>. Вычистил их и дальше все пошло как по маслу.</p>
<p class="measure-wide">BOM используется во всех файлах ТЖ (в этом можно убедиться, например, с помощью <a class="link blue dim bb" href="https://github.com/vkostyanetsky/ScriptsFor1C/blob/master/Технологический%20журнал/LogFilesWithoutBOM.sh">скрипта</a>). То есть каждый лог начинается с особых символов, которых невооруженным глазом не увидеть и которые могут помешать обработать первую строку файла (так как эти самые символы не будут попадать под условие регулярного выражения).</p>
<p class="measure-wide">Вывод: проще всего удалять BOM по умолчанию, не оценивая рисков для каждой конкретной задачи. Да, иногда это будет лишним (например, решению задачи по тексту выше через grep BOM никак не мешает). Но я не люблю сюрпризы. Кроме того, несколько тактов процессора на простую замену — явно выгоднее, чем эквивалент в сгоревших нервных клетках и потерянном времени.</p></description>
        </item>
        
        <item>
            <title>Профессиональная деформация</title>
            <link>https://kostyanetsky.ru/notes/nerdview/</link>
            <guid isPermaLink="false">note-nerdview</guid>
            <pubDate>Mon, 19 Oct 2020 18:35:56 +0700</pubDate>
            <description><p class="measure-wide"><img alt="Чат с дочкой" src="https://kostyanetsky.ru/notes/nerdview/telegram.png"/></p>
<p class="measure-wide">Дочка пишет о своих планах — мол, не теряй меня. А у меня профессиональная деформация: этот вполне нормальный чат мой мозг упорно воспринимает как код на Gherkin. Просто какой-то неправильный, что ли, хочется быстренько пофиксить :-)</p>
<pre><code>И я выхожу
Тогда я в школе
И я выхожу
Тогда я покачаюсь
</code></pre>
<p class="measure-wide">Мы на этом языке пишем автотесты нашей конфигурации для <a class="link blue dim bb" href="https://github.com/Pr-Mex/vanessa-automation">Vanessa Automation</a>. Вроде не так уж много я их накатал (сравнивая с некоторыми коллегами — баловался, считай). Но, видимо, достаточно.</p></description>
        </item>
        
        <item>
            <title>Запросы и ожидания на блокировках</title>
            <link>https://kostyanetsky.ru/notes/queries-and-lock-waits/</link>
            <guid isPermaLink="false">note-queries-and-lock-waits</guid>
            <pubDate>Mon, 19 Oct 2020 06:23:06 +0700</pubDate>
            <description><p class="measure-wide">Набросал ещё два скрипта для анализа ТЖ: <a class="link blue dim bb" href="https://github.com/vkostyanetsky/ScriptsFor1C/blob/master/Технологический%20журнал/LongestQueries.sh">первый</a> строит топ тяжелых запросов к MS SQL, <a class="link blue dim bb" href="https://github.com/vkostyanetsky/ScriptsFor1C/blob/master/Технологический%20журнал/LongestLockWaitsByRegions.sh">второй</a> — топ длительных ожиданий на блокировках.</p>
<p class="measure-wide">Тяжелые запросы определяются по продолжительности событий DBMSSQL. То есть, чем дольше выполнялся запрос — тем вероятнее, что в процессе он слопал кучу ресурсов. Обычно это так и есть, хотя для нормальной диагностики нужно смотреть трассировку.</p>
<p class="measure-wide">Ожидания на блокировках тоже считаются по продолжительности. При этом скрипт проверяет, что у события TLOCK заполнено свойство WaitConnections — то есть платформа действительно ждала возможности установить блокировку, а не просто потратила какое-то время на её установку.</p></description>
        </item>
        
        <item>
            <title>Новый скрипт топа исключений</title>
            <link>https://kostyanetsky.ru/notes/top-exceptions-v2/</link>
            <guid isPermaLink="false">note-top-exceptions-v2</guid>
            <pubDate>Sat, 17 Oct 2020 13:25:02 +0700</pubDate>
            <description><p class="measure-wide">Переписал <a class="link blue dim bb" href="https://github.com/vkostyanetsky/ScriptsFor1C/blob/master/Технологический%20журнал/FrequentExceptions.sh">скрипт</a> на баше, строящий топ исключений по собранному ТЖ: хотел решить эту задачу как-то попроще.</p>
<p class="measure-wide">В итоге выкинул из кода возню с заменой начала события на маркер gawk для разделения записей (его можно сразу задать регулярным выражением) и перенес больше логики в скрипт для gawk (так нагляднее, особенно если потом захочется её расширить). </p>
<p class="measure-wide">Получилось явно лучше, чем <a class="link blue dim bb" href="https://gist.github.com/vkostyanetsky/47e02e199bb32082c4d5019ca88233c0">было</a> — во всяком случае, логика выглядит понятнее. Изначально, правда, я хотел скорее сократить скрипт в размере и получить что-то вроде:</p>
<pre><code>grep -hoP ",EXCP,.*\KDescr=.*" */*.log | uniq -c | sort -rn
</code></pre>
<p class="measure-wide">То есть фильтруем только строки с событием EXCP, отрезаем всё до описания ошибки и группируем с помощью uniq. По-моему, очень изящно.</p>
<p class="measure-wide">Однако описание у EXCP может быть многострочным. То есть мы будем время от времени терять часть данных, нужных для расследования (всё описание после первого же перевода строки). Как решить эту проблему так, чтобы скрипт не разбарабанило втрое — я пока не придумал :-)</p></description>
        </item>
        
        <item>
            <title>Уязвимости в конфигурациях 1С</title>
            <link>https://kostyanetsky.ru/notes/vulnerabilities/</link>
            <guid isPermaLink="false">note-vulnerabilities</guid>
            <pubDate>Tue, 13 Oct 2020 17:35:51 +0700</pubDate>
            <description><p class="measure-wide">В прошлом месяце был на <a class="link blue dim bb" href="https://infostart.ru/events/1269292/">митапе</a> «Инфостарта» по безопасности решений на платформе 1С. Узнал кучу интересного! Среди прочего, Олег Тымко обзорно рассказывал про подходы в разработке, которые можно считать потенциальными уязвимостями продуктов. Например, зашитых прямо в код IP-адресов, ссылок, e-mail'ов, паролей и так далее.</p>
<p class="measure-wide">Накидал вчера простой <a class="link blue dim bb" href="https://github.com/vkostyanetsky/ScriptsForLogAnalysis/blob/master/Файлы%20конфигурации/Vulnerabilities.sh">скрипт</a> на баше, который роется в выгрузке конфигурации в поисках таких косяков. По сути, эта штука просто пропускает конфигурацию через регулярки — я особо не заморачивался и чисто из спортивного интереса реализовал два-три варианта.</p>
<p class="measure-wide">Вывод: для серьёзной итеративной разработки лучше сразу думать в сторону чего-то вроде SonarQube, а не колхозить вот это всё — подходы «в лоб» дают слишком много ложных срабатываний, нужно думать над фильтрами, исключениями, историей и другой обвязкой.</p>
<p class="measure-wide">А вот для быстрой оценки такого подхода вполне достаточно — никакой инфраструктуры, никакой возни с настройкой и железом. Выгрузил конфигурацию, пнул баш и, собственно, всё — готовый результат за несколько секунд.</p></description>
        </item>
        
        <item>
            <title>Про Single Sign-On</title>
            <link>https://kostyanetsky.ru/notes/single-sign-on/</link>
            <guid isPermaLink="false">note-single-sign-on</guid>
            <pubDate>Sat, 12 Sep 2020 17:23:09 +0700</pubDate>
            <description><div class="blog-embedded-tweet" data-tweet-id="1303716447831707649"><a class="link blue dim bb" href="https://twitter.com/EpicGames/status/1303716447831707649">Твит</a></div>
<p class="measure-wide">Этот эпизод <s>схватки двух йокодзун</s> конфликта между Apple и Epic Games, безотносительно всего прочего — отличное напоминание, что Single Sign-On в интернете использовать нельзя: нигде, никогда, ни на каких сервисах. Неизвестно, какие ещё гиганты внезапно сойдутся на кулачках или какой сайт забанит тебя без всякой внятной причины. Because screw you, dude, that's why.</p>
<p class="measure-wide">В кейсе из твита выше пользователи, возможно, отделаются малой кровью, а вот если вашу учетку заблокирует что-то вроде Google — ситуация вполне может оказаться критической: куча сервисов, на которые вы ходили через гугл, резко превратятся в тыкву.</p>
<p class="measure-wide">Решений, по удобству ничем не уступающих Single Sign-On, полным-полно. Менеджеры паролей, разнообразные расширения для браузеров, «железные» ключи — да что угодно будет лучше, чем проприетарные сервисы с закрытым кодом, на которые вы не имеете никакого влияния.</p></description>
        </item>
        
        <item>
            <title>Профессионал по техвопросам</title>
            <link>https://kostyanetsky.ru/notes/techprof/</link>
            <guid isPermaLink="false">note-techprof</guid>
            <pubDate>Sat, 05 Sep 2020 16:52:54 +0700</pubDate>
            <description><p class="measure-wide">В конце августа сдал тест на профессионала 1С по техническим вопросам крупных внедрений. Это по сути такой входной билет на <a class="link blue dim bb" href="https://1c.ru/rus/partners/training/uc1/course.jsp?id=199">основной экзамен</a>, призванный проредить поток претендентов и заставить их подучить теорию.</p>
<p class="measure-wide">В тесте четырнадцать вопросов, случайно набранных из порядка пятиста возможных; нужно правильно ответить хотя бы на двенадцать. На это дается полчаса, однако по факту достаточно пяти-десяти минут: большинство ответов логически выводится или запоминается. Попадаются и неточности, и расплывчатые формулировки, но их мало. Норм вопросы, короче.</p>
<p class="measure-wide">Подбор тем показался мне порядочным винегретом — по чуть-чуть из всего подряд. Впрочем, по факту такой охват скорее полезен: смотришь на очередной непривычный вопрос, отвечаешь, ошибаешься. Тушишь задницу, лезешь разбираться как так. Становишься немного умнее (но это не точно).</p></description>
        </item>
        
        <item>
            <title>Неразрешимые ссылки на функциональные опции</title>
            <link>https://kostyanetsky.ru/notes/unresolved-gopher/</link>
            <guid isPermaLink="false">note-unresolved-gopher</guid>
            <pubDate>Wed, 19 Aug 2020 18:09:13 +0700</pubDate>
            <description><p class="measure-wide">Приведу вариант решения проблемы <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/unresolved-references">неразрешимых ссылок</a>, возникший после удаления функциональной опции. Вводная — при проверке конфигурации получаю десятка два сообщений вида:</p>
<pre><code>CommonForm.PersonalSettings.Form Unresolved metadata object references (2)
Catalog.BankAccounts.Form.GLAccountsEditForm.Form Unresolved metadata object references (1)
Catalog.CashRegisters.Form.GLAccountsEditForm.Form Unresolved metadata object references (1)
</code></pre>
<p class="measure-wide">Выгружаю конфигурацию в файлы, открываю Form.xml для одной из проблемных форм. Начинаю с той, где элементов немного — так проблему заметить будет проще.</p>
<p class="measure-wide">Бегло просматриваю файл в поисках чего-то необычного. Искать долго не приходится:</p>
<p class="measure-wide"><img alt="Подозреваемый" src="https://kostyanetsky.ru/notes/unresolved-gopher/suspect.png"/></p>
<p class="measure-wide">Нормальная ссылка на функциональную опцию — её имя (как в случае DepreciationOfAssets). А вот если вместо имени указан GUID — этой функциональной опции в конфигурации нет. Ссылка неразрешима.</p>
<p class="measure-wide">Делаю поиск этого GUID'а по остальной выгрузке и нахожу почти все проблемы, на которые ссылалась платформа при проверке. Решить их легко: удалить битую ссылку из XML, а потом загрузить файл обратно в конфигурацию. Можно ещё проще: открыть список функциональных опций для элемента формы и тут же сохранить его. В этом случая битая ссылка также будет удалена.</p>
<p class="measure-wide">Почему искать таких потеряшек через сам Конфигуратор — занятие для клинических оптимистов? Да просто проблему почти невозможно заметить. В лучшем случае вы увидите что-то в духе:</p>
<p class="measure-wide"><img alt="Настоящая улика" src="https://kostyanetsky.ru/notes/unresolved-gopher/evidence.png"/></p>
<p class="measure-wide">Конфигуратор понимает, что в поле две опции, но получить название для второй не может (её нет). А ведь чаще всего функциональная опция только одна! И картина выглядит так:</p>
<p class="measure-wide"><img alt="Ваша честь, я невиновен!" src="https://kostyanetsky.ru/notes/unresolved-gopher/innocent.png"/></p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/ihZyUBaG_8Y" width="560"></iframe></description>
        </item>
        
        <item>
            <title>Метод с сюрпризом</title>
            <link>https://kostyanetsky.ru/notes/method-with-surprise/</link>
            <guid isPermaLink="false">note-method-with-surprise</guid>
            <pubDate>Mon, 27 Jul 2020 07:38:49 +0700</pubDate>
            <description><p class="measure-wide">Пару недель назад столкнулся с досадным багом. Контекст — примитивнее не придумаешь: нужно найти документ по номеру. Если сделать так — документ будет найден:</p>
<pre><code>SELECT Ref FROM Document.Invoice WHERE Number = &amp;Number
</code></pre>
<p class="measure-wide">А вот так — фигушки:</p>
<pre><code>Documents.Invoice.FindByNumber(Number)
</code></pre>
<p class="measure-wide">Сначала я даже слегка завис, но потом полез в документацию и, конечно, нашел ответ. У метода FindByNumber() есть второй параметр, IntervalDate, нужный для поиска периодического документа. С помощью него можно сузить поиск до конкретного периода; например, если периодичность нумерации — год и мы присвоим параметру значение 01-05-2020, то поиск пойдет в периоде от 01-01-2020 до 31-12-2020. А нумерация у документа Invoice и правда периодическая — в пределах года.</p>
<p class="measure-wide">Так в чем проблема? Дело в том, что за уклончивым «the parameter is used for documents with periodic numbering» на самом деле скрывается железное правило: параметр <strong>нельзя</strong> опускать для периодических документов.</p>
<p class="measure-wide">Чтобы убедиться в этом, посмотрим, какой SQL выполняется на стороне СУБД. Делаем обычный запрос — никаких сюрпризов. P1 здесь — разделитель, P2 — номер документа:</p>
<pre><code>SELECT
    T1._IDRRef 
FROM
    dbo._Document283 T1
WHERE
    ((T1._Fld704 = @P1))
    AND ((T1._Number = @P2))
</code></pre>
<p class="measure-wide">А вот если выполнить FindByNumber(), то в запросе появится третий параметр со значением 2001-12-31 23:59:59 — ну да, «конец первого года с начала времён»:</p>
<pre><code>SELECT
    T1._IDRRef
FROM
    dbo._Document283 T1
WHERE
    ((T1._Fld704 = @P1))
    AND
    (
        T1._Number = @P2
        AND T1._Date_Time &lt;= @P3
    )
</code></pre>
<p class="measure-wide">Конечно, такой запрос не находит нужный документ. Он вообще ничего не найдет  в любой реальной базе — никогда, ни при каких обстоятельствах.</p>
<p class="measure-wide">Подведем итог. Как решить проблему — понятно: указываем IntervalDate или, если даты нет, подключаем ЗначениеРеквизитаОбъекта() БСП или его аналог. Но, честное слово, со стороны платформы, было бы куда адекватнее выбрасывать исключение, если FindByNumber() вызван без IntervalDate, а у документа включена периодичность — чем вот так, тихой сапой, делать гарантированно бессмысленные запросы.</p></description>
        </item>
        
        <item>
            <title>Один запрос, что правит всеми</title>
            <link>https://kostyanetsky.ru/notes/one-query-to-rule-them-all/</link>
            <guid isPermaLink="false">note-one-query-to-rule-them-all</guid>
            <pubDate>Sat, 25 Jul 2020 17:55:10 +0700</pubDate>
            <description><p class="measure-wide">Истории ради <a class="link blue dim bb" href="https://gist.github.com/vkostyanetsky/ddb286da9674b05d014389bed3b022c4">закинул</a> на Github Gist один из неоптимальных запросов, с которыми возился несколько месяцев назад. Он использовался для динамического списка в форме элемента справочника и, когда пользователь открывал вкладку с этим списком, платформа погружалась в медитацию даже в относительно небольшой базе.</p>
<p class="measure-wide">На первый взгляд структура запроса простая и четкая: пачка запросов к таблицам документов, соединяемых через ОБЪЕДИНИТЬ ВСЁ. Каждая из таблиц фильтруется по примерно одинаковым условиям — тип ссылки, дата и вхождение ссылки в результат подзапроса.</p>
<p class="measure-wide">Однако потенциальных проблем тут сразу несколько. Во-первых, работа идет как минимум с 14-ю таблицами — по числу соединяемых запросов. Это само по себе повышает риск того, что оптимизатор не успеет подобрать хотя бы относительно приличный план выполнения. Скорее всего, он просто ткнет пальцем в небо, а дальше — как повезет.</p>
<p class="measure-wide">Во-вторых, большая часть этой работы, вероятно, будет выполняться впустую. Каждый из запросов содержит примерно такую конструкцию:</p>
<pre><code>WHERE VALUETYPE(AdditionalExpenses.Ref) IN (&amp;DocumentsListSelectedTypes)
</code></pre>
<p class="measure-wide">То есть в динамический список передается список типов документов, которые требуется вывести. Однако это условие будет наложено <strong>после</strong> выборки данных, и если пользователю нужны только инвойсы — СУБД все равно сначала выгребет все 14 таблиц, а потом отбросит 13 из них.</p>
<p class="measure-wide">Но это всё не так критично. Если бы список проблем этим и ограничивался, мы, возможно, и не полезли бы разбираться. Главная проблема — во втором условии секций WHERE: каждый запрос проверяет вхождение ссылки на документ в результат подзапроса.</p>
<p class="measure-wide">Использование вложенного запроса в условиях — само по себе почти табу, если речь идет не о временных таблицах: СУБД часто не в состоянии понять, сколько данных вернет подзапрос и, соответственно, какой способ работы с ними подойдет лучше. Однако тут это ещё и усугубляется тем, к какому источнику данных мы делаем запрос. Критерий отбора — это не таблица в базе данных, которую можно прочитать, пусть даже со сканом — это набор таблиц. В критерии отбора DocumentsByProject их тридцать!</p>
<p class="measure-wide">В этом месте можно было бы сказать «занавес», но нужно добавить, что выборку из тридцати таблиц по определенному типу документа делает каждый из четырнадцати соединяемых запросов.</p>
<p class="measure-wide"><img alt="OMG" src="https://media.giphy.com/media/oYtVHSxngR3lC/giphy.gif"/></p>
<p class="measure-wide">Вот теперь занавес :-)</p></description>
        </item>
        
        <item>
            <title>ЭтотОбъект.ЭтотОбъект</title>
            <link>https://kostyanetsky.ru/notes/thisobject-thisobject/</link>
            <guid isPermaLink="false">note-thisobject-thisobject</guid>
            <pubDate>Fri, 24 Jul 2020 10:47:34 +0700</pubDate>
            <description><div class="blog-embedded-tweet" data-tweet-id="923830370822389760"><a class="link blue dim bb" href="https://twitter.com/webholt/status/923830370822389760">Твит</a></div>
<p class="measure-wide">Обожаю JavaScript! Каждый раз, когда у меня сгорает задница от какой-нибудь странной дичи в любимой платформе, я просто открываю любой тред про будни веб-девелоперов и быстро, очень быстро успокаиваюсь.</p>
<p class="measure-wide">Впрочем, похожие трюки можно повторить в 1С. Например, JavaScript понимает window.window.window.location, а платформа — <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/thisobject-thisobject/thisobject-thisobject.png">вот это</a> :-)</p></description>
        </item>
        
        <item>
            <title>Обновление запускатора служб</title>
            <link>https://kostyanetsky.ru/notes/service-launcher-update/</link>
            <guid isPermaLink="false">note-service-launcher-update</guid>
            <pubDate>Wed, 22 Jul 2020 20:23:40 +0700</pubDate>
            <description><p class="measure-wide">Доработал логику <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/service-launcher/">запускатора служб</a>. Теперь, если вызвать скрипт без параметров (т.е. не указав ни -start, ни -stop) — он сам решит, запускать службы или останавливать их.</p>
<p class="measure-wide">Для этого скрипт определит статус первой службы в списке. Если она работает — все службы из списка будут остановлены, если выключена — скрипт попытается их запустить.</p>
<p class="measure-wide">Зачем это нужно? Ну, если вы вызываете скрипт прямо с программируемой клавиатуры, как я — теперь вам нужна только одна кнопка. Раньше было нужно две: одна для запуска служб, вторая для остановки.</p></description>
        </item>
        
        <item>
            <title>Блог на Vue.js</title>
            <link>https://kostyanetsky.ru/notes/vuejs-blog/</link>
            <guid isPermaLink="false">note-vuejs-blog</guid>
            <pubDate>Tue, 21 Jul 2020 20:01:10 +0700</pubDate>
            <description><p class="measure-wide">В середине прошлого года я <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/so-much">загорелся</a> идеей переписать этот сайт на чем-то посовременнее PHP, выбрал Vue.js в качестве фреймворка и принялся за дело. JavaScript я на тот момент почти не знал, поэтому набил прорву шишек на кейсах в духе «метод вывода даты падает в Safari» — однако в итоге получил вполне жизнеспособное приложение.</p>
<p class="measure-wide">Ну, как жизнеспособное? С одной стороны, главное у меня получилось — я разработал клиентское веб-приложение, которое ходит на сервер только за данными, а весь интерфейс собирает само. С другой — пришлось накрутить на фреймворк целую армию <s>костылей</s> хуков даже для самых простых штук (вроде подсветки элементов меню или, скажем, выдачи правильных кодов HTTP). Кое-что я вообще с наскока реализовать не смог — например, выдачу HTML-версий страниц для Яндекса (их пауки в 2020-м году не умеют индексировать сайты на JavaScript).</p>
<p class="measure-wide">В общем, опыт вышел полезным, но результат — настолько спорным, что в конце концов я бросил эту затею, а получившегося Франкенштейна <a class="link blue dim bb" href="https://github.com/vkostyanetsky/VuejsBlog">выложил</a> на GitHub. Возможно, он кому-то сэкономит время на решение задач в духе «как вывести через Vue.js произвольный HTML» или «как научить VueI18n работать с русским языком».</p>
<p class="measure-wide">Документации там нет, правда. Я сначала хотел подробно расписать, как что работает, но быстро понял, что потрачу уйму времени без видимой пользы. Вероятно, буду возвращаться к этой теме под настроение — а пока, так сказать, ограничимся парадигмой MVP :-)</p></description>
        </item>
        
        <item>
            <title>Сломанный велосипед</title>
            <link>https://kostyanetsky.ru/notes/broken-bicycle/</link>
            <guid isPermaLink="false">note-broken-bicycle</guid>
            <pubDate>Mon, 20 Jul 2020 15:32:07 +0700</pubDate>
            <description><p class="measure-wide"><a href="https://www.1ci.com/applications/1c-drive/"><img alt="1C:Drive" src="https://kostyanetsky.ru/notes/broken-bicycle/broken-bicycle.png"/></a></p>
<p class="measure-wide">Думаю, эту картинку для 1Ci нарисовал человек, прямо вот максимально далекий от разработки самой конфигурации и программирования вообще. Потому как программист видит на ней ровно два месседжа о продукте: </p>
<ol class="measure-wide">
<li>Это велосипед.</li>
<li>Он сломан.</li>
</ol></description>
        </item>
        
        <item>
            <title>Запускатор служб</title>
            <link>https://kostyanetsky.ru/notes/service-launcher/</link>
            <guid isPermaLink="false">note-service-launcher</guid>
            <pubDate>Mon, 13 Jul 2020 20:15:07 +0700</pubDate>
            <description><p class="measure-wide">Какое-то время назад я <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/manage-services-with-powershell/">писал</a> про командлеты PowerShell, с помощью которых можно запускать и останавливать службы. В итоге я собрал из этих набросков нормальный скрипт: он читает список к запуску или остановке служб из отдельного файла, а ещё проверяет и (если нужно) запрашивает права администратора.</p>
<p class="measure-wide">Результат можно <a class="link blue dim bb" href="https://github.com/vkostyanetsky/ServiceLauncher">посмотреть</a> на GitHub'е. No big deal — хотел поупражняться в языке и упростить ежедневную рутину: в моей системе наберется десятка полтора прожорливых сервисов, которые нужны для работы, но бесполезны в другое время. Вручную останавливать, а потом запускать этот зоопарк неудобно, а вот одной командой — совсем другое дело!</p></description>
        </item>
        
        <item>
            <title>Размер данных базы 1С</title>
            <link>https://kostyanetsky.ru/notes/data-size-console/</link>
            <guid isPermaLink="false">note-data-size-console</guid>
            <pubDate>Sat, 11 Jul 2020 14:00:51 +0700</pubDate>
            <description><p class="measure-wide">На прошлой неделе листал комментарии к 8.3.15 и наткнулся на метод ПолучитьРазмерДанныхБазыДанных(). Стало любопытно, как эта штука работает и насколько её данные расходятся с теми, которые можно получить из, например, Management Studio.</p>
<p class="measure-wide">В итоге накатал что-то вроде <a class="link blue dim bb" href="https://github.com/vkostyanetsky/DataSizeConsole">консоли</a>, через которую методу можно передавать разные метаданные, и принялся следить за запросами платформы к БД.</p>
<p class="measure-wide">В общем, размер данных платформа считает примерно таким выражением:</p>
<pre><code>CAST(
    SUM(
        CAST(
            DATALENGTH(T1._Fld40) AS NUMERIC(12, 0)
        )
    ) AS NUMERIC(18, 0)
)
</code></pre>
<p class="measure-wide">И так для каждого поля, которое есть у объекта, включая стандартные. Если есть табличные части — они тоже считаются. Результат суммируется.</p>
<p class="measure-wide">Выводы?</p>
<p class="measure-wide">Ну, во-первых, понятно, почему у метода такое дурацкое название. Он считает не размер таблиц, как я изначально подумал, а именно <strong>размер данных</strong> — то есть на оценку не влияют ни расходы на схему данных, ни расходы на индексы, ни механика экстентов. Учитывается только размер самих данных, которые хранятся непосредственно в объекте.</p>
<p class="measure-wide">Таким образом, реальный объём места, которое слопал условный справочник номенклатуры, будет больше того, которое покажет метод. Возможно, значительно. Для точной аналитики такой подход не годится, но чтобы быстро оценить распределение данных в БД – вполне подходит. </p>
<p class="measure-wide">Во-вторых, метод никак не считает расходы на историю данных для анализируемых объектов, что честно указано в документации. Теоретически их можно посчитать вручную, оттолкнувшись от _DataHistoryMetadata, но подождем релиз-другой — возможно, разработчики это добавят.</p>
<p class="measure-wide">В-третьих, СУБД в ходе расчетов выгребает все содержимое нужных таблиц, а потом считает размер того, что выгребла. То есть вызов, скорее всего, приведет к куче сканирований и может быстро вымыть буферный кэш. На 1cFresh запросы будут делаться с учетом разделителей, но это слабое утешение, как по мне.</p>
<p class="measure-wide">В общем, на работающем проде применять с осторожностью.</p></description>
        </item>
        
        <item>
            <title>Выгрузка стандартных обработок</title>
            <link>https://kostyanetsky.ru/notes/what-is-inside-the-drum/</link>
            <guid isPermaLink="false">note-what-is-inside-the-drum</guid>
            <pubDate>Sun, 05 Jul 2020 11:07:20 +0700</pubDate>
            <description><p class="measure-wide">Недавно внедрили в нашу конфигурацию встроенный в платформу механизм истории данных вместо морально и функционально устаревшего велосипеда из SSLi. Сейчас как раз дописываю выгрузку историю данных в бэкап и загрузку его обратно: удивительно, но этого пока не умеет ни БСП, ни БТС, ни SSLi (впрочем, от последней я и не ждал).</p>
<p class="measure-wide">Как закончу, расскажу подробнее. Пока хочу отметить любопытную опцию, которая пригодилась по ходу дела: встроенные в платформу обработки, которые доступны из меню «Все функции», можно выгрузить в виде обычных epf-файлов! Трюк очень подробно разобрали коллеги на Инфостарте (<a class="link blue dim bb" href="https://infostart.ru/public/369487/">вот тут</a> и <a class="link blue dim bb" href="https://infostart.ru/public/538300/">вот тут</a>). Вкратце магия выглядит вот так:</p>
<pre><code>КопироватьФайл(
    "v8res://mngbase/StandardDataChangeHistory.epf",
    "Q:/StandardDataChangeHistory.epf"
);
</code></pre>
<p class="measure-wide">Полный список стандартных форм и обработок, которые можно вытащить, способ получения этого списка, а также куча споров вокруг и около — по ссылкам выше.</p>
<p class="measure-wide">Зачем это пригодится вам — честно, не знаю. Что касается нас, то мы делали интерфейсы для работы с историей данных и было любопытно, как они написаны у самой 1С (спойлер: довольно неряшливо).</p></description>
        </item>
        
        <item>
            <title>Тонкое искусство приземления</title>
            <link>https://kostyanetsky.ru/notes/how-not-to-land/</link>
            <guid isPermaLink="false">note-how-not-to-land</guid>
            <pubDate>Sun, 31 May 2020 17:34:49 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/bvim4rsNHkQ" width="560"></iframe>
<p class="measure-wide">На волне актуальных новостей наткнулся на трёхлетней давности ролик от SpaceX с подборкой неудачных приземлений на плавучую платформу. Как по мне — отличный пример того, как нужно относиться к своим ошибкам. С юмором!</p>
<blockquote>
<p class="measure-wide">Well, technically, it did land... Just not in one piece.</p>
</blockquote>
<p class="measure-wide">:D</p>
<p class="measure-wide">В комментариях не отстают:</p>
<blockquote>
<p class="measure-wide">Space X : Launches astronauts for the first time.</p>
<p class="measure-wide">Youtube: Let's recommend this video!</p>
</blockquote></description>
        </item>
        
        <item>
            <title>Фред</title>
            <link>https://kostyanetsky.ru/notes/fred/</link>
            <guid isPermaLink="false">note-fred</guid>
            <pubDate>Sun, 24 May 2020 08:00:56 +0700</pubDate>
            <description><p class="measure-wide">Игорь Сахаров перепел «Фреда» Короля и Шута на английском языке:</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/MsFQmXdC29g" width="560"></iframe>
<p class="measure-wide">Роцк! Ро-о-оцк! :-)</p>
<p class="measure-wide">Если серьёзно, я уже как-то <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/i-wish-i-could/">писал</a> про это, но мне ни разу не лень повторить: такие штуки — один из самых простых и приятных способов запомнить кучу слов и оборотов.</p>
<p class="measure-wide">Да, вокруг хватает крутанов с цепкими мозгами, которым этот трюк не нужен; он, скорее, для обычных ребят вроде меня самого. У нас все эти what a good match you and I и spellbound by your beauty pure and true в других обстоятельствах порой улетучиваются из головы, ну... Секунд через десять?</p>
<p class="measure-wide">А так — смотришь ролик, невольно подпеваешь и не замечаешь, как текст намертво оседает в памяти.</p></description>
        </item>
        
        <item>
            <title>Об идеальном балансе</title>
            <link>https://kostyanetsky.ru/notes/perfectly-balanced/</link>
            <guid isPermaLink="false">note-perfectly-balanced</guid>
            <pubDate>Wed, 20 May 2020 06:48:19 +0700</pubDate>
            <description><p class="measure-wide">Хочу поделиться парой классных текстов о современном софте. Они не особенно свежие (первый-то уж точно), но наверняка ведь кто-то пропустил:</p>
<ul class="measure-wide">
<li><a class="link blue dim bb" href="https://tonsky.me/blog/disenchantment/ru/">Моё разочарование в софте</a> Никиты Тонского</li>
<li><a class="link blue dim bb" href="https://habr.com/ru/company/jugru/blog/493178/">В софте всё восхитительно, но все недовольны</a> Евгения Трифонова</li>
</ul>
<p class="measure-wide">? Если вы — тоже сотрудник «Первого БИТа», то <a class="link blue dim bb" href="https://newportal.1cbit.ru/news/3066979/">итоги</a> хакатона лежат на портале. Там же — <a class="link blue dim bb" href="https://newportal.1cbit.ru/news/3066980/">отзыв</a> другого победителя, Димы Лещенко (там всякие интересные подробности, почитайте).</p>
<p class="measure-wide">К чему я это вспомнил? На прошлой неделе участвовал в хакатоне среди программистов нашей компании. Узнал кучу клевых штук, а по итогам даже занял первое место (вместе с ещё двумя участниками, у которых получились очень похожие решения). </p>
<p class="measure-wide">В процессе нужно было развернуть и настроить целую гору софта: EDT, RabbitMQ, Docker, GitLab, JIRA, SonarQube и ещё вагон инструментов поменьше и попроще. Ладно, к RabbitMQ у меня претензий нет: легкий и быстрый, но вот остальное... Про хороший аппетит EDT я знал и раньше, а вот прожорливость GitLab и JIRA по-настоящему удивила.</p>
<p class="measure-wide">Да, в моём случае всё запускалось в докере; да, конфигурация не была оптимальной (например, было развернуто несколько серверов PostgreSQL вместо одного); да, докер был для Windows, а его реализация под эту платформу — тема для едких шуток у всех сисадминов, с которыми я знаком. Но потратить 12 гигабайт ОЗУ прямо со старта?! Про процессор вообще молчу — нагрузка была такая, будто компьютер просчитывал ядерный взрыв в реальном времени.</p>
<p class="measure-wide">Короче, лучшей иллюстрации к тезисам Никиты подобрать трудно: софт выше слопал море ресурсов и невозмутимо попросил ещё, даже не приступив к какой-то понятной для пользователя задаче. А впрочем... Может, это иллюстрация к тексту Евгения? Я, на секундочку, одной-единственной командой развернул несколько операционных систем со сложными серверами внутри. И потратил на это несоизмеримо меньше времени чем, скажем, пришлось бы потратить несколько лет назад.</p>
<p class="measure-wide">У меня нет ответа. Думаю, ни у кого нет. Это такой вечный холивар внутри головы программиста: какую сторону не займи, на деле все равно балансируешь между двумя крайностями. С одной стороны, надо писать хороший, быстрый код. С другой — хорошо бы не решать воображаемые проблемы, из-за которых софт точно-точно будет тормозить (проблем, к слову, пока нет) (и почти наверняка не будет).</p>
<p class="measure-wide">Одно в итоге дает чистое удовольствие от хорошо сделанной работы: вспоминаешь, что ты, черт побери, неплох! Другое — просто позволяет не нажить бед с башкой в поисках идеального алгоритма сортировки пузырьком :-)</p>
<p class="measure-wide">В общем,</p>
<p class="measure-wide"><img alt="Perfectly balanced... As all things should be." src="https://kostyanetsky.ru/notes/perfectly-balanced/perfectly-balanced.jpg"/></p>
<p class="measure-wide">(вдогонку: у Вастрика был <a class="link blue dim bb" href="https://vas3k.club/battle/1400/">баттл</a> на ту же тему; там куча аргументов «за» и «против», любопытно почитать)</p></description>
        </item>
        
        <item>
            <title>Просмотр таблицы значений</title>
            <link>https://kostyanetsky.ru/notes/value-table-view/</link>
            <guid isPermaLink="false">note-value-table-view</guid>
            <pubDate>Sat, 16 May 2020 21:19:05 +0700</pubDate>
            <description><p class="measure-wide">Закинул на GitHub <a class="link blue dim bb" href="https://gist.github.com/vkostyanetsky/ef44bbb18f36a1c51826a5d0b4f3960e">короткую функцию</a>, с помощью которой произвольную таблицу значений можно превратить в табличный документ.</p>
<p class="measure-wide">Для чего? Чтобы посмотреть её содержимое. Саму таблицу на клиент передать нельзя, а вот табличный документ на её основе — можно. Кроме того, у табличного документа есть клиентский метод Show(), который отображает его в отдельном окне.</p>
<p class="measure-wide">То есть можно прямо из режима предприятия просматривать разные служебные таблицы, не тратя время на создание интерфейса для них. Просто передаем их в функцию по ссылке выше, получаем табличные документы, возвращаем их на клиент и выводим.</p></description>
        </item>
        
        <item>
            <title>Самодокументируемый код</title>
            <link>https://kostyanetsky.ru/notes/self-documenting-code/</link>
            <guid isPermaLink="false">note-self-documenting-code</guid>
            <pubDate>Sun, 03 May 2020 15:48:37 +0700</pubDate>
            <description><p class="measure-wide">Всем привет! С вами снова Джонни Кэтсвилл и передача «Самодокументируемый код»!</p>
<p class="measure-wide">Сегодня мы переберем строки таблицы значений с Н по Й:</p>
<p class="measure-wide"><img alt=":|" src="https://kostyanetsky.ru/notes/self-documenting-code/self-documenting-code.png"/></p>
<p class="measure-wide">Вроде и мелочь совсем, но когда в пределах одного модуля в пятый раз натыкаешься на такой подход к именованию переменных — глаз невольно начинает дергаться :-)</p>
<p class="measure-wide">Дело даже не в том, что этот участок <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/why-so-serious">труднее разобрать</a> — просто он неплохо говорит о качестве модуля в целом. Скорее всего, писавший его программист был вымотан, и поблизости можно встретить что-нибудь вроде отважной выгрузки справочника номенклатуры в таблицу значений, чтения кучи объектов «через точку» и прочего тяп-ляп.</p></description>
        </item>
        
        <item>
            <title>Управление службами через PowerShell</title>
            <link>https://kostyanetsky.ru/notes/manage-services-with-powershell/</link>
            <guid isPermaLink="false">note-manage-services-with-powershell</guid>
            <pubDate>Tue, 28 Apr 2020 17:18:10 +0700</pubDate>
            <description><p class="measure-wide">На днях набросал себе несколько скриптов на PowerShell'е для запуска и остановки служб на рабочем ПК. Наработки в итоге не пригодились, так что зафиксирую себе пару примеров на будущее, чтобы не потерять:</p>
<pre><code>get-service -Name 1C:Enterprise* | Where-Object {$_.status -eq 'running'} | stop-service -pass
get-service -Name *SQL* | Where-Object {$_.status -eq 'running'} | stop-service -pass
</code></pre>
<p class="measure-wide">Обе строки выше делают одно и то же: ищут службы с определенным именем, проверяют их состояния и, если службы запущены — останавливают их. Имена служб удобно задавать через шаблоны — например, у Microsoft SQL Server целый выводок служб с разным назначением и их удобно пристрелить одной строкой. Или, скажем, служба сервера 1С:Предприятия — она одна, зато её длиннющее название просто лень писать полностью :-)</p>
<p class="measure-wide">Примерно тот же подход, кстати, работает и с обычными процессами. Так, строка ниже ищет процесс obs64; если находит — останавливает. </p>
<pre><code>get-process -Name obs64 | stop-process -pass
</code></pre>
<p class="measure-wide">Если нужны детали, то на сайте разработчика есть подробная <a class="link blue dim bb" href="https://docs.microsoft.com/ru-ru/powershell/scripting/samples/managing-services?view=powershell-7">документация</a> с кучей примеров и рассуждений в духе «как запустить службу, если вы медитируете на одной ноге в условиях искусственной невесомости».</p></description>
        </item>
        
        <item>
            <title>Black Mesa</title>
            <link>https://kostyanetsky.ru/notes/black-mesa/</link>
            <guid isPermaLink="false">note-black-mesa</guid>
            <pubDate>Mon, 13 Apr 2020 20:09:31 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/YkBrNGeFwoU" width="560"></iframe>
<p class="measure-wide">Легендарный, но уже откровенно постаревший Half-Life тщательно отретушировали и дополнили кучей новых задумок. Вышло здорово; прям видно, что фанаты старались :-) Особенно Зену пошло на пользу — разве что завод, по-моему, стоило сделать покороче. Впрочем, бой с Нихилантом переделали так, что он с лихвой окупает все страдания.</p>
<p class="measure-wide">Есть мелкие косяки с музыкой, оптимизацией и переводом, но ничего особо критичного. Учитывая, сколько шла разработка — удивительно, что вообще дошло до релиза сквозь типичные для долгих проектов проблемы вроде усталости и выгорания команды. И это не считая титанической работы по переделке проекта двадцатилетней давности на современные рельсы! Quite a nasty piece of work you managed over there, guys. I am impressed.</p>
<p class="measure-wide"><a href="https://kostyanetsky.ru/notes/black-mesa/swamp.jpg"><img alt="Болото" src="https://kostyanetsky.ru/notes/black-mesa/swamp-thumbnail.jpg"/></a> <a href="https://kostyanetsky.ru/notes/black-mesa/crystaline-cave.jpg"><img alt="Кристаллическая пещера" src="https://kostyanetsky.ru/notes/black-mesa/crystaline-cave-thumbnail.jpg"/></a> <a href="https://kostyanetsky.ru/notes/black-mesa/burning-sky.jpg"><img alt="Пылающее небо" src="https://kostyanetsky.ru/notes/black-mesa/burning-sky-thumbnail.jpg"/></a> <a href="https://kostyanetsky.ru/notes/black-mesa/flycatcher.jpg"><img alt="Мухоловка" src="https://kostyanetsky.ru/notes/black-mesa/flycatcher-thumbnail.jpg"/></a></p></description>
        </item>
        
        <item>
            <title>Пустая() или ЗначениеЗаполнено()?</title>
            <link>https://kostyanetsky.ru/notes/is-ref-empty/</link>
            <guid isPermaLink="false">note-is-ref-empty</guid>
            <pubDate>Sat, 11 Apr 2020 12:24:12 +0700</pubDate>
            <description><p class="measure-wide">Несколько дней назад обсуждал с коллегой, какой способ проверки заполнения ссылки лучше. С одной стороны, несколько лет назад я слышал на каких-то курсах авторитетное мнение, что функцию ЗначениеЗаполнено() нужно использовать с осторожностью, так как её логика — сопоставлять переменную всем возможным пустым значениям, которые есть в конфигурации. И это, мол, огромная тормозная лапша. Как альтернативу авторы курса советовали использовать метод ссылки Пустая(), а композитные реквизиты предлагалось проверять примерно так:</p>
<pre><code>СсылкаЗаполнена = Ссылка &lt;&gt; Неопределено И Не Ссылка.Пустая();
</code></pre>
<p class="measure-wide">Коллега в свою очередь утверждал, что ЗначениеЗаполнено() быстрее, так как это встроенная функция, которая не тратит время на поиск метода у объекта (в скриптовых языках это сравнительно медленная операция).</p>
<p class="measure-wide">На моей памяти ни тот, ни другой метод узким местом никогда не были, но меня разобрало любопытство; написал <a class="link blue dim bb" href="https://github.com/vkostyanetsky/IsEmptyOrValueIsFilled">тест</a>, который проверяет ссылочную переменную на пустое значение обеими способами и замеряет время, которое было потрачено. </p>
<p class="measure-wide">В среднем результат выглядит <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/is-ref-empty/is-ref-empty.png">примерно так</a>. Там четыре шага — на первых двух предполагается, что ссылка определена, а на третьем и четвертом добавляется соответствующая проверка. В последней колонке таблицы виден контекст выполнения теста (клиент или сервер).</p>
<p class="measure-wide">Вывод довольно очевиден: ЗначениеЗаполнено() никакой деградации не показывает, более того — работает быстрее, чем метод Пустая() (особенно если мы начинаем проверять переменную на Неопределено). Конечно, отклонение не слишком значительное, но на каких-то длительных регламентных операциях вполне можно сэкономить пару секунд.</p>
<p class="measure-wide">Да и чисто практически проще делать проверку одним универсальным вызовом, а не пытаться угадать все возможные значения переменной.</p></description>
        </item>
        
        <item>
            <title>Запись видео в ShareX</title>
            <link>https://kostyanetsky.ru/notes/sharex-video-recording/</link>
            <guid isPermaLink="false">note-sharex-video-recording</guid>
            <pubDate>Wed, 08 Apr 2020 05:53:13 +0700</pubDate>
            <description><p class="measure-wide">Прежде чем приспособить OBS Studio для записи видео (писал о ней в <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/video-recording">предыдущей</a> заметке), я пробовал использовать <a class="link blue dim bb" href="https://getsharex.com/">ShareX</a>. Программа поначалу неплохо справлялась, однако от неё пришлось отказаться из-за неприятного бага: иногда при попытке завершить запись софт портил полученное видео.</p>
<p class="measure-wide">Я гуглил, но причину понять так и не смог. Впрочем, неудивительно — ShareX использует <a class="link blue dim bb" href="https://www.ffmpeg.org/">ffmpeg</a> для записи видео, а это дитя опенсорца вместо адекватной диагностики невозмутимо вываливает целый рулон логов. Разбирать его без соответствующего опыта — занятие для клинического оптимиста.</p>
<p class="measure-wide">Впрочем, как инструмент для создания скриншотов ShareX почти безупречна. Обилие опций слегка напоминает замотанного человека в приступе гиперактивности :-)</p>
<p class="measure-wide"><a href="https://kostyanetsky.ru/notes/sharex-video-recording/interface.png"><img alt="Настраиваем скриншоты" src="https://kostyanetsky.ru/notes/sharex-video-recording/interface-thumb.png"/></a></p>
<blockquote>
<p class="measure-wide">— Протестирую сам! Сам все протестирую! И полы вымою!</p>
<p class="measure-wide"><em><a class="link blue dim bb" href="https://www.youtube.com/watch?v=K6oZuB8_dU8&amp;feature=youtu.be&amp;t=640">Эффективность не работает. Илья Якямсев</a></em></p>
</blockquote></description>
        </item>
        
        <item>
            <title>Запись видео</title>
            <link>https://kostyanetsky.ru/notes/video-recording/</link>
            <guid isPermaLink="false">note-video-recording</guid>
            <pubDate>Fri, 03 Apr 2020 05:17:06 +0700</pubDate>
            <description><p class="measure-wide">Я работаю удалённо и с коллегами общаюсь через Zoom и Slack. В основном в чатах, но многие темы по-прежнему проще обсудить голосом. И вот тут-то возникают проблемы: приходится забыть про индексацию и поиск по сообщениям, а главное — нет никакого архива разговоров. Иногда очень нужно вспомнить: кто говорил? Что конкретно? Когда?</p>
<p class="measure-wide">Zoom и Slack сами по себе эту проблему не решают. Первый умеет записывать только те конференции, которые организуешь ты или которые тебе разрешили писать (короче, далеко не все), а второй писать видео не умеет вообще.</p>
<h2>Решение проблемы</h2>
<p class="measure-wide">Я закрыл вопрос какое-то время назад, поставив себе <a class="link blue dim bb" href="https://obsproject.com">OBS Studio</a> — популярный среди стримеров софт для записи экрана. С записью конференций он прекрасно справляется. Настройка минимальная: пишем весь экран, звук с микрофона и все звуки, которые воспроизводятся. В микшере по результатам тестовых записей можно натыкать фильтры — усиление, шумоподавление и так далее.</p>
<p class="measure-wide"><img alt="Настройка OBS Studio" src="https://kostyanetsky.ru/notes/video-recording/video-recording.png"/></p>
<p class="measure-wide">В настройках нужно указать папку, куда будут складываться записанные видео (Вывод → Запись → Путь записи). Поскольку мы пишем звонки и файлов будет много, лучше сразу разложить их в папки по дням — для этого идем в расширенные настройки и в поле «Формат имени файла» указываем нечто вроде %CCYY-%MM-%DD/%hh-%mm-%ss.</p>
<h2>Быстрое управление записью</h2>
<p class="measure-wide">Конечно, лезть в OBS при каждом звонке неудобно, но у неё есть куча хоткеев — можно прожимать какие-нибудь заковыристые комбинации в начале и в конце разговора. Однако со мной это не сработало — придуманные хоткеи почему-то постоянно вылетали из головы. Даже стикеры не помогали. </p>
<p class="measure-wide">Поначалу я здорово разозлился, но потом понял: раз не получается запомнить хоткей — надо его выкинуть. Начинать запись нажатием одной кнопки, заканчивать нажатием на другую.</p>
<p class="measure-wide">С оборудованием всё было просто: у меня эргономичная <a class="link blue dim bb" href="https://www.microsoft.com/accessories/ru-ru/products/keyboards/natural-ergonomic-keyboard-4000/b2m-00020">клавиатура</a> от Microsoft, программируемых кнопок на ней — вагон. Хуже с софтом: OBS Studio понимает некоторые <a class="link blue dim bb" href="https://github.com/obsproject/obs-studio/wiki/Launch-Parameters">параметры</a> запуска, но список откровенно бедноват — даже остановки записи нет. Хотелось бы побольше.</p>
<p class="measure-wide">В итоге решил задачу через плагин к OBS Studio, который дает порулить запущенным экземпляром программы. Он придуман для удаленного управления записью (например, со смартфона), но никто не мешает использовать его локально.</p>
<p class="measure-wide">Схема получилась такая:</p>
<ol class="measure-wide">
<li>Ставим OBS Studio и плагин <a class="link blue dim bb" href="https://obsproject.com/forum/resources/obs-websocket-remote-control-of-obs-studio-made-easy.466/">obs-websocket</a> к ней. Снимаем галку «Enable System Tray Alerts» в настройках (Tools → WebSockets Server Settings), не то программа примется сообщать о каждом чихе.</li>
<li>Кладем куда-нибудь <a class="link blue dim bb" href="https://obsproject.com/forum/resources/command-line-tool-for-obs-websocket-plugin-windows.615/">утилиту</a>, с помощью которой этим плагином можно рулить из командной строки. </li>
<li>Вешаем на одну кнопку OBSCommand.exe /startrecording, а на другую — OBSCommand.exe /stoprecording.</li>
<li>Готово, вы великолепны!</li>
</ol>
<p class="measure-wide">При вызове на долю секунду видно консоль (OBSCommand запускается, связывается с obs-websocket и ждет ответа). Сначала хотел как-нибудь скрыть это окно, но, поразмыслив, передумал — если OBS Studio не будет запущен или возникнет какая-то проблема, консоль не закроется и я хотя бы узнаю, что запись не началась.</p></description>
        </item>
        
        <item>
            <title>Неразрешимые ссылки</title>
            <link>https://kostyanetsky.ru/notes/unresolved-references/</link>
            <guid isPermaLink="false">note-unresolved-references</guid>
            <pubDate>Tue, 10 Mar 2020 20:08:36 +0700</pubDate>
            <description><p class="measure-wide">Чаще всего неразрешимые ссылки на объекты метаданных образуются в ходе удаления объектов (и, иногда, при объединении конфигураций). На ИТС есть <a class="link blue dim bb" href="https://its.1c.ru/db/metod8dev#content:2290:hdoc">статья</a> по этой теме, там хорошо описаны детали.</p>
<p class="measure-wide">На работе программы битые ссылки сказываются далеко не всегда. Конечно, поле без привязки к данным заметить несложно, но вот удалили вы, допустим, функциональную опцию — что с того, что ссылка на неё осталась где-нибудь в команде на форме? Она будет просто лежать, как обрезанный провод, инертный и безвредный. Ничего по нему не идет. </p>
<p class="measure-wide">Однако такие штуки постепенно захламляют конфигурацию, и от них правильно избавляться, и на ИТС предложена не больно-то эффективная методика (последовательный перебор всех возможных мест, где может быть битая ссылка). Представьте себе сложную форму документа с множеством элементов; сколько времени придется потратить на поиск? Еще не факт, что успешный.</p>
<p class="measure-wide">Есть более грубый, но действенный метод: последовательно удалять с формы группы элементов. Можно начинать с больших групп (например, со страниц). После каждого удаления выполнять проверку конфигурации и смотреть — исчезла битая ссылка или нет. Перед началом работы лучше удалить из формы весь код, чтобы платформа не ругалась на обращения к несуществующим элементам.</p>
<p class="measure-wide">Проблема, кстати, может быть не в элементах, а в самой форме — но там её куда проще найти (хранилище настроек, условное оформление, команды; в общем, кандидатов немного).</p>
<p class="measure-wide">Ещё можно сделать выгрузку конфигурации в файлы и порыться в полученных XML-ках. Это неплохая идея ещё и потому, что сам по себе внешний вид элементов может вас обмануть: если, например, речь идет о ссылке на функциональную опцию в команды формы, то при проверке свойств команды вы даже не заметите, что есть какая-то проблема. А вот в XML-ке будет болтаться какой-то подозрительный GUID вместо наименования опции — считай, явка с повинной :-)</p></description>
        </item>
        
        <item>
            <title>Фильтрация стандартных реквизитов</title>
            <link>https://kostyanetsky.ru/notes/standard-attributes-filtering/</link>
            <guid isPermaLink="false">note-standard-attributes-filtering</guid>
            <pubDate>Mon, 09 Mar 2020 13:52:03 +0700</pubDate>
            <description><p class="measure-wide">Короткий <a class="link blue dim bb" href="https://gist.github.com/vkostyanetsky/ee1f913868673c2218877dfbecc9b08a">фрагмент</a> кода из обработки для настройки механизма истории данных, о которой я только что <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/data-history-settings">писал</a>. Эта функция определяет, является ли Attribute стандартным реквизитом с именем StandardAttributeName, принадлежащим объекту метаданных MetadataObject. Где она нужна? Допустим, вы перебираете стандартные реквизиты объекта и по какой-то причине хотите пропустить один из них.</p>
<p class="measure-wide">На первый взгляд решение выглядит максимально индусским. Почему бы, например, просто не сравнить два реквизита — проверяемый и тот, что хотим отсеять?</p>
<pre><code>If Attribute = MetadataObject.StandardAttributes.Order Then
</code></pre>
<p class="measure-wide">Дело в том, что такой код не сработает: результат операции сравнения двух стандартных реквизитов объекта метаданных в платформе 1С — всегда Ложь.</p>
<p class="measure-wide">О'кей, скажете вы — может, тогда не будем усложнять и напишем вот так?</p>
<pre><code>If Attribute.Name = "Order" Then
</code></pre>
<p class="measure-wide">Однако так тоже не сработает, если ваш код будет запущен в русскоязычной конфигурации: стандартный реквизит, который мы пытаемся найти, в этом случае будет называться «Порядок». </p>
<p class="measure-wide">Тем не менее, к самому стандартному реквизиту внутри коллекции можно обращаться и по-русски, и по-английски. Потом получаем текущее имя атрибута и сравниваем с именем того атрибута, который проверяем.</p>
<p class="measure-wide">Конечно, можно было просто сделать сравнение имени реквизита и с «Order», и с «Порядок» — но это, во-первых, некрасиво, а во-вторых — стандарты программирования у нас в компании запрещают писать код на русском. В общем, мне хотелось найти более общее решение.</p>
<p class="measure-wide">Что до конструкции Try/Catch — она тут на тот случай, если стандартного реквизита с таким именем в конфигурации нет вообще (и попытка обратиться к нему  по имени приведет к ошибке).</p></description>
        </item>
        
        <item>
            <title>Настройки истории данных</title>
            <link>https://kostyanetsky.ru/notes/data-history-settings/</link>
            <guid isPermaLink="false">note-data-history-settings</guid>
            <pubDate>Mon, 09 Mar 2020 12:02:26 +0700</pubDate>
            <description><p class="measure-wide">Выложил на GitHub <a class="link blue dim bb" href="https://github.com/vkostyanetsky/AuditLogSettings">обработку</a> для настройки механизма истории данных, который сравнительно недавно <a class="link blue dim bb" href="https://its.1c.ru/db/v8312doc#bookmark:dev:TI000001938">появился</a> в платформе. Эта обработка:</p>
<ol class="measure-wide">
<li>Строит дерево объектов, для которых может вестись история данных;</li>
<li>Подсказывает, для каких объектов история данных ведется сейчас;</li>
<li>Дает возможность включить или выключить историю данных для объектов и их реквизитов. </li>
</ol>
<p class="measure-wide">Обработка поддерживает пакетные операции — например, можно включить историю разом для нескольких документов и всех справочников. Или вообще удалить все внесенные настройки, откатив состояние механизма к тому, которое заложил разработчик конфигурации.</p>
<p class="measure-wide">По-моему, неплохо получилось. Я писал эту штуку больше для себя, разминая мозг по вечерам — но мы, возможно, даже включим её в <a class="link blue dim bb" href="https://firstbit.ae">нашу конфигурацию</a>! Сейчас версионированием данных в ней занимается SSLi, и её механизмы трудно назвать эффективными — медленные и сильно раздувают базу. Надеюсь, платформа на тестах покажет себя лучше.</p>
<p class="measure-wide">На Инфостарте и ИТС можно найти похожие разработки, но они либо глючат, либо работают только на русскоязычных конфигурациях (не имеют английского интерфейса + опираются на БСП), либо просто-напросто устарели (например, не поддерживают работу с константами).</p></description>
        </item>
        
        <item>
            <title>Девятый вал</title>
            <link>https://kostyanetsky.ru/notes/ninth-wave/</link>
            <guid isPermaLink="false">note-ninth-wave</guid>
            <pubDate>Mon, 09 Mar 2020 11:55:06 +0700</pubDate>
            <description><p class="measure-wide">Покупал вчера утром подарки своим женщинам. Пока флорист собирала букеты, болтал с ней ни о чем и случайно перехватил взгляд в сторону нарастающей толпы покупателей — спокойный такой, с отчетливо читающейся обреченностью. Так моряки, наверное, смотрят на вздымающуюся волну, которая вот-вот похоронит их шлюпку :-)</p>
<p class="measure-wide">Люди вне цветочной индустрии иногда хмыкают — мол, восьмое марта это такой волшебный праздник для цветочников, которые делают целое состояние за десять часов. Касса в эти дни и правда собирается приличная — только вот у любого, кто когда-либо работал в этой сфере, восьмое (и пара дней до него, кстати) чаще ассоциируется с чудовищной нагрузкой на силы, нервы и здоровье.</p>
<p class="measure-wide">Я, можно сказать, ещё дешево отделался: всего-то разворачивал и обслуживал айти в местной сети цветочных магазинов (кстати, <a class="link blue dim bb" href="http://rosetta.florist/">рекомендую</a> бывших коллег!). И все равно запах цветов ещё долго вызывал у меня вьетнамский синдром :-)</p></description>
        </item>
        
        <item>
            <title>Топ исключений по ТЖ</title>
            <link>https://kostyanetsky.ru/notes/top-exceptions/</link>
            <guid isPermaLink="false">note-top-exceptions</guid>
            <pubDate>Sun, 16 Feb 2020 16:32:02 +0700</pubDate>
            <description><p class="measure-wide">Выложил на GitHub <a class="link blue dim bb" href="https://github.com/vkostyanetsky/ScriptsFor1C/blob/master/Технологический%20журнал/FrequentExceptions.sh">скрипт</a> на баше, который по собранному технологическому журналу 1С определяет наиболее частотные исключения.</p>
<p class="measure-wide">Скрипт анализирует события EXCP. Это основной источник информации об ошибках, хотя, конечно, не единственный: например, есть EXCPCNTX (событие, которое началось, но не закончилось в тот момент, когда произошла ошибка). Кроме того, если исключение происходит во время серверного вызова, то в поле RetExcp у события CALL будет текст ошибки, которая вернется на клиент.</p>
<p class="measure-wide">Впрочем, в большинстве случаев EXCP и, иногда, EXCPCNTX вполне достаточно. Часто их собирают просто по умолчанию — нагрузки это не создает, зато позволяет прогонять собранные логи через какой-нибудь инструмент аналитики (скрипт выше, например) и держать, так сказать, руку на пульсе.</p></description>
        </item>
        
        <item>
            <title>Соль</title>
            <link>https://kostyanetsky.ru/notes/salt/</link>
            <guid isPermaLink="false">note-salt</guid>
            <pubDate>Tue, 28 Jan 2020 05:48:20 +0700</pubDate>
            <description><p class="measure-wide">Люблю моменты, когда опыт из какой-нибудь видеоигры слегка пересекается с абсолютно нерелевантной реальностью.</p>
<p class="measure-wide">Взять, например, <a class="link blue dim bb" href="https://store.steampowered.com/app/283640/Salt_and_Sanctuary/">Salt and Sanctuary</a>. Дело там происходит на острове посреди моря; соль здесь — ценный ресурс, вокруг которого крутится сюжет и геймплей. Её нужно искать, отнимать у врагов и тщательно хранить. </p>
<p class="measure-wide">В общем, игру я на днях прошёл. А вчера открываю <a class="link blue dim bb" href="https://ldwg.ru/">сайт</a> Быстроновского и понять не могу — чего я так залип на <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/salt/ldwg.png">этой фразе</a>?</p>
<p class="measure-wide"><img alt="Знаете, я и сам в некотором роде собираю соль!" src="https://kostyanetsky.ru/notes/salt/scientist.png"/></p>
<p class="measure-wide">Действительно, было бы странно не залипнуть! Соли к этому моменту я собрал на пару товарных составов, никак не меньше.</p></description>
        </item>
        
        <item>
            <title>Отладка через HTTP</title>
            <link>https://kostyanetsky.ru/notes/debug-via-http/</link>
            <guid isPermaLink="false">note-debug-via-http</guid>
            <pubDate>Sun, 26 Jan 2020 12:32:49 +0700</pubDate>
            <description><p class="measure-wide">В конце недели столкнулся с довольно глупой ситуацией: отладка через TCP/IP на сервере 1С перестала работать. То есть сам по себе режим отладки включен, однако конфигуратор «не видит» контекстов отладки на сервере.</p>
<p class="measure-wide">Ситуация глупая в том смысле, что понять причину довольно сложно: явных ошибок платформа не выдает. После проверки очевидных вариантов (фаервол, порты и так далее) остается только руками разводить. </p>
<p class="measure-wide">Решил проблему, переключившись на отладку через HTTP. Инфрастуктурно это более сложная <a class="link blue dim bb" href="https://its.1c.ru/db/v8310doc#bookmark:dev:TI000001599">схема</a>, но настраивается она довольно просто; если вкратце, то нужно:</p>
<ul class="measure-wide">
<li>Запустить службу агента сервера с ключами «-debug -http».</li>
<li>В параметрах отладки конфигуратором (Сервис → Параметры → Отладка) указать HTTP как протокол отладки и сервер отладки кластера как сервер отладки.</li>
</ul>
<p class="measure-wide">Подробнее процесс настройки <a class="link blue dim bb" href="https://its.1c.ru/db/v8310doc#bookmark:dev:TI000001604">описан</a> на ИТС.</p></description>
        </item>
        
        <item>
            <title>Неподдерживаемый код</title>
            <link>https://kostyanetsky.ru/notes/unsupported-code/</link>
            <guid isPermaLink="false">note-unsupported-code</guid>
            <pubDate>Sat, 18 Jan 2020 10:56:25 +0700</pubDate>
            <description><p class="measure-wide">Случайно наткнулся на <a class="link blue dim bb" href="https://helpf.pro/faq/view/1907.html">пример</a> запроса в 1С, который считает разницу между двумя датами (в годах, месяцах и днях).</p>
<p class="measure-wide">Код, возможно, действительно работает (я не проверял), но как по мне — это хороший пример того, как делать не надо. Проблема в том, что автор забудет смысл большинства если-тогда-иначе через пару месяцев, не говоря уже о посторонних разработчиках, которые решат использовать этот код на своих проектах. В итоге при первой же доработке, которую потребуется провернуть на этом участке, куда дешевле будет заменить решение на что-то более наглядное, а не доработать.</p>
<p class="measure-wide">И это еще далеко не самый наглядный пример. Взять хотя бы <a class="link blue dim bb" href="http://www.google.ru/search?q=email+regex">регулярки для проверки e-mail</a>. Хочется выйти подышать, да? :-)</p></description>
        </item>
        
        <item>
            <title>Тысяча и одна ночь с 1С</title>
            <link>https://kostyanetsky.ru/notes/1001-nights-with-1c/</link>
            <guid isPermaLink="false">note-1001-nights-with-1c</guid>
            <pubDate>Thu, 16 Jan 2020 09:55:48 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/WvdfWMoI1oI" width="560"></iframe>
<p class="measure-wide">Архитектор нашего основного продукта (и, по совместительству, мой тимлид) рассказывает о том, как мы внедряли 1С в Дубае. Погружений в технические детали нет, так что можно смотреть всем, кто хотя бы чуть-чуть в теме.</p>
<p class="measure-wide">Видео записано на краснодарской конференции разработчиков в июне прошлого года, так что кое-что уже поменялось. Например, у нас появились вполне рабочие прототипы программы на арабском языке, а объём автотестирования вырос настолько, что мисс <a class="link blue dim bb" href="https://github.com/Pr-Mex/vanessa-automation-single">Ванессу</a> стоит считать отдельным членом команды :-)</p></description>
        </item>
        
        <item>
            <title>В пятьдесят раз быстрее</title>
            <link>https://kostyanetsky.ru/notes/fifty-times-faster/</link>
            <guid isPermaLink="false">note-fifty-times-faster</guid>
            <pubDate>Thu, 05 Dec 2019 19:56:49 +0700</pubDate>
            <description><p class="measure-wide">Получил вводную: документ закрытия месяца у заказчика проводится без малого час. База не особенно большая, но такая продолжительность в любом случае не вариант. Даже если учесть, что закрытие месяца — это ни разу не частотная операция и её можно делать, например, ночью.</p>
<p class="measure-wide">Лезу в код, делаю замер производительности и вижу, что и почти всё это время платформа тратит на одну-единственную процедуру, выполняя пакет запросов. Смотрю <a class="link blue dim bb" href="https://gist.github.com/vkostyanetsky/cf34c6cb088515e2bab6485b2f35eab8">первый</a> из них; ну, думаю, классика — запрос данных через точку от составного типа. Наверняка СУБД пристегивает целый вагон соединений с тяжеленными таблицами документов, вот оптимизатор и не успевает набросать адекватный план.</p>
<p class="measure-wide">Проверяю теорию — так, а тип SalesDocument включает всего восемь документов. Это, условно, в пределах допустимого (считается, что оптимизатор в состоянии подобрать адекватный план выполнения запроса, если количество соединений — в пределах восьми).</p>
<p class="measure-wide">Смотрю размеры таблиц документов — не особенно-то и большие. Выполняю запрос отдельно от пакета — да, работает не мгновенно (читает около 350 000 записей и отбирает примерно 200 000), но никак не час.</p>
<p class="measure-wide">Ладно, первый запрос пакета тяжелый, но проблема не в нём. Лезу во <a class="link blue dim bb" href="https://gist.github.com/vkostyanetsky/f4423dcfb28d4a27039c7310c13c3a73">второй</a> и понимаю, что до этого прочитали весь регистр Inventory и отобрали большую часть записей, а теперь — читаем его ещё раз и склеиваем обе выборки по куче условий. Подходящего индекса в таблице движений нет — только стандартный по регистратору и он, конечно, не подходит.</p>
<p class="measure-wide">Проверил — именно тут платформа и проводит большую часть времени, ожидая ответа от СУБД.</p>
<p class="measure-wide">Отказаться от двойного чтения всей таблицы регистра не вышло: я перебрал несколько вариантов, но все они требовали изменения структуры хранения данных, что было неприемлемо. В итоге остановился на промежуточном варианте: во втором запросе соединение с реальной таблицей движений регистра заменилось на соединение с заранее созданной временной таблицей, проиндексированной по полям соединения.</p>
<p class="measure-wide">Это тот случай, когда общая рекомендация 1С сработала идеально — вместо 50 минут документ стал проводиться за три, а после дополнительной оптимизации кода — за минуту. То есть, в пятьдесят раз быстрее того, что я имел вначале.</p>
<p class="measure-wide">Такой результат я счел достаточным (минута для закрытия месяца — это в общем случае нормально) и остановился.</p></description>
        </item>
        
        <item>
            <title>Зачем нужен ЦУП?</title>
            <link>https://kostyanetsky.ru/notes/what-is-pmc-for/</link>
            <guid isPermaLink="false">note-what-is-pmc-for</guid>
            <pubDate>Sun, 24 Nov 2019 15:46:53 +0700</pubDate>
            <description><p class="measure-wide">ЦУП нужен, чтобы:</p>
<ol class="measure-wide">
<li>Найти в системе некое узкое место (медленный код, тяжелый запрос);</li>
<li>Расследовать конкретные блокировки или взаимоблокировки.</li>
</ol>
<p class="measure-wide">В первом случае включают анализ запросов и, допустим, серверных вызовов. По результатам можно понять, что в системе грузит сервер приложений, а что — сервер СУБД. Часто так делают даже не решая конкретную проблему, а просто чтобы устранить узкие места и увеличить запас прочности системы на будущее.</p>
<p class="measure-wide">Во втором сценарии включают анализ блокировок или взаимоблокировок — когда знают, что они есть в системе, и хотят получить отчет: кто заблокировал, кого, когда, на какой строчке кода и так далее.</p>
<p class="measure-wide">В обеих случаях мониторинг запускают только в периоды основной нагрузки и минут на десять-пятнадцать. Массив исходных данных получается сравнительно небольшим (ЦУП'у нужно его обработать перед выдачей результата, чем больше данных — тем больше времени потребуется). Кроме того, не будет собрано лишних данных — например, не будет анализа нагрузки от регламентных работ, которые вы проводите ночью.</p>
<p class="measure-wide">Кроме того, это снижает влияние сбора данных на работу системы. Дело в том, что ЦУП может собирать очень тяжелый ТЖ, способный заметно нагрузить железо (на 30% медленнее? подержи мое пиво). С этим лучше быть осторожным.</p>
<p class="measure-wide">Для всего, что перечислено выше, достаточно аналитических показателей ЦУП'а: анализа запросов, ожиданий на блокировках, анализа взаимоблокировок 1С и MS SQL. Что до оперативных показателей — количества выполняемых запросов, суммарного времени их выполнения и так далее — то популярностью они не пользуются. Польза от них обычно не стоит времени на настройку, и ЦУП по большому счету никогда не проектировался для того, чтобы постоянно собирать их.</p></description>
        </item>
        
        <item>
            <title>Поиск методов с параметром</title>
            <link>https://kostyanetsky.ru/notes/find-methods-with-parameter/</link>
            <guid isPermaLink="false">note-find-methods-with-parameter</guid>
            <pubDate>Mon, 18 Nov 2019 19:18:12 +0700</pubDate>
            <description><p class="measure-wide">Задача: нужно найти в общих модулях конфигурации методы с определенным параметром (в этом примере — с параметром DecimalPlacesFor).</p>
<p class="measure-wide">Обычный поиск по коду конфигурации даст массу ложных срабатываний (например, все обращения к параметру с таким именем в теле методов). Поиск по регулярным выражениям платформа пока не поддерживает, поэтому выгодно выгрузить конфигурацию в файлы и натравить на папку общих модулей <a class="link blue dim bb" href="https://github.com/vkostyanetsky/ScriptsForLogAnalysis/blob/master/Файлы%20конфигурации/MethodsWithParameter.sh">скрипт</a> на баше.</p>
<p class="measure-wide">Первая часть скрипта (до пайпа) выполняет сам поиск, вторая — отрезает лишнее, чтобы на вывод уходили только названия модулей и найденных в них методов. Получится, например, так:</p>
<p class="measure-wide"><img alt="Скриншот консоли" src="https://kostyanetsky.ru/notes/find-methods-with-parameter/bash.png"/></p>
<p class="measure-wide">Профит? Профит!</p></description>
        </item>
        
        <item>
            <title>Что такое Баблокс?</title>
            <link>https://kostyanetsky.ru/notes/bablox/</link>
            <guid isPermaLink="false">note-bablox</guid>
            <pubDate>Sun, 20 Oct 2019 12:22:43 +0700</pubDate>
            <description><p class="measure-wide">Посмотрел <a class="link blue dim bb" href="https://www.youtube.com/watch?v=p6D7SdhO4LI">вебинар</a> Евгения Филиппова про Баблокс. В общем, это такая дополнительная методика оценки производительности. Как и Апдекс, опирается на замеры времени — но предлагает иную механику расчета.</p>
<p class="measure-wide">Чтобы посчитать Баблокс, нужно умножить продолжительность операции на зарплату пользователя, который эту операцию делает. Зарплатой может быть:</p>
<ul class="measure-wide">
<li>Некое среднее значение, если нужно поверхностно сравнить производительность одинаковой программы в нескольких компаниях.</li>
<li>Реальная зарплата пользователя, если нужно доказать руководству, что пришло время выделить бюджет на оптимизацию.</li>
</ul>
<p class="measure-wide">В итоге получим сумму, которую бизнес потерял, условно, из-за тормозов программы. В этом главный плюс методики: это число проще донести до среднего финансового директора. Что означает Апдекс, равный нулю целых пяти десятых — еще поди объясни, а вот что такое потерянные триста тысяч рублей — понятно сразу.</p>
<p class="measure-wide">Кроме того, снимаются субъективные вопросы, которые возникают при каждом внедрении. Например, определение ключевых операций; вот скажите, что важнее — быстрее продать товар или оприходовать на склад? Когда известно, сколько компания теряет в деньгах на каждой из этих операций — ответ дать куда проще.</p>
<p class="measure-wide">Конечно, это не идеальная модель. Например, возьмем такую ситуацию: программа тормозит у кладовщиков, но нормально работает у бухгалтеров. Зарплата кладовщиков ниже, чем зарплата бухгалтеров, и Баблокс для них будет невелик. Однако бухгалтера работают с тем, что ввели кладовщики, и пока последние не закончили — бухгалтерам нечем заняться. То есть компания теряет деньги из-за тормозов программы у кладовщиков, но Баблокс это не покажет.</p>
<p class="measure-wide">В общем, Баблокс вряд ли подвинет позиции Апдекса внутри айти-сообщества, но это и правда любопытный подход, который может здорово помочь в диалоге с клиентом.</p></description>
        </item>
        
        <item>
            <title>Большое внедрение 1С</title>
            <link>https://kostyanetsky.ru/notes/big-implementation/</link>
            <guid isPermaLink="false">note-big-implementation</guid>
            <pubDate>Tue, 15 Oct 2019 17:56:15 +0700</pubDate>
            <description><p class="measure-wide">Что можно считать большим внедрением 1С? Фактически, эта платформа в России используется почти везде — даже в тех компаниях, где широко применяются решения конкурентов (например, тот же SAP). Конечно, где-то объемы внедрения невелики и 1С решает чисто утилитарные задачи вроде формирования отчетности, но среди работ ЦКТП можно найти по-настоящему колоссальные проекты — например, оптимизацию системы «<a class="link blue dim bb" href="http://v8.1c.ru/expert/cts/cts-218-001.htm">Деловых линий</a>», которая рассчитана на пять тысяч одновременно работающих пользователей.</p>
<p class="measure-wide">В общем, всё это приводит к тому, что средним внедрением в России сейчас считаются базы, в которых одновременно работают сотни пользователей, а большим внедрением — базы, где работают от тысячи пользователей (и больше).</p>
<p class="measure-wide">Размер базы при этом — не критерий: есть множество конфигураций, не предполагающих одновременной работы пользователей. Классический пример — 1C:Документооборот, менее классический — «Управление Автовокзалами» Авибуса. Последняя в состоянии накопить в своей центральной базе огромный объем данных от удаленных узлов своей распределенной сети (автовокзалов и автостанцией), однако большое количество одновременно работающих пользователей для нее не характерно.</p></description>
        </item>
        
        <item>
            <title>Оборотный регистр без оборотов</title>
            <link>https://kostyanetsky.ru/notes/no-turnovers/</link>
            <guid isPermaLink="false">note-no-turnovers</guid>
            <pubDate>Tue, 15 Oct 2019 17:10:04 +0700</pubDate>
            <description><p class="measure-wide">Если отключить для всех измерений оборотного регистра опцию «Использование в итогах», то обороты для регистра рассчитываться не будут. Более того, таблица оборотов регистра будет удалена из базы данных, и попытка обратиться к ней на языке запросов 1С приведет к ошибке.</p>
<p class="measure-wide">Такой трюк может быть уместен, когда мы накапливаем какие-то данные, а потом просто фильтруем их по регистратору или по другим полям. То есть от регистра нам нужна только его таблица движений. В этом случае нет никакого смысла тратить ресурсы сервера на расчет таблицы оборотов и её хранение.</p>
<p class="measure-wide">Конечно, при виде такой задачи в голову сразу приходит регистр сведений. Однако эффективность этого варианта зависит от количества измерений, которые вы собираетесь завести в регистре; дело в том, что каждый индекс по регистру сведений включает все его измерения (а периодические регистры — ещё и период). Между тем, платформа создает базовый индекс по измерениям, индекс для каждого измерения с признаком «Ведущее», а ещё — индекс для каждого измерения, ресурса или реквизита, которые вы решите проиндексировать отдельно. И это мы еще не дошли до таблиц срезов, где применяется тот же подход!</p>
<p class="measure-wide">В общем, накладные расходы на содержание индексов могут быть довольно заметны, если регистр сведений спланирован не особенно удачно и содержит сравнительно много измерений (скажем, больше двух-трех). В этом случае «плоский» оборотный регистр без оборотов смотрится вполне прилично.</p></description>
        </item>
        
        <item>
            <title>River City Girls</title>
            <link>https://kostyanetsky.ru/notes/river-city-girls/</link>
            <guid isPermaLink="false">note-river-city-girls</guid>
            <pubDate>Mon, 30 Sep 2019 07:50:22 +0700</pubDate>
            <description><p class="measure-wide">Прошли на пару с мелкой River City Girls (недавно вышедший beat 'em up; это такой жанр игр, где нужно навалять всем, кто тебе не нравится).</p>
<p class="measure-wide">На <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/river-city-girls/ru.jpg">фоточке</a> я наблюдаю  за десятилетней Лисой, которая в этот момент уверенно разбрасывает толпу японских мордоворотов.</p></description>
        </item>
        
        <item>
            <title>Control</title>
            <link>https://kostyanetsky.ru/notes/control/</link>
            <guid isPermaLink="false">note-control</guid>
            <pubDate>Sat, 14 Sep 2019 16:16:53 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/r6RUXzb3NxY" width="560"></iframe>
<p class="measure-wide">К игре у меня две претензии. Во-первых, местные «измененные предметы»: их описания в сравнении с плодами буйной фантазии авторов из <a class="link blue dim bb" href="https://ru.wikipedia.org/wiki/SCP_Foundation">фонда SCP</a> выглядят не слишком ярко. Да, есть приятные исключения, но эта часть все равно кажется слабее остальной паранормальщины, которая есть в игре.</p>
<p class="measure-wide">Вторая претензия — то, при каких обстоятельствах игрок слышит <a class="link blue dim bb" href="https://www.youtube.com/watch?v=CkojH7htq-k">My Dark Disquet</a> от Poets of The Fall. Черт побери, это слишком крутой трек для такого проходного участка! Ожидал встретить его во время титров или какой-нибудь сумасшедшей схватки.</p>
<p class="measure-wide">Я понимаю, что оба пункта звучат мальца несерьёзно, но это правда всё. Control исключительно хороша и внешне, и геймплейно, и сюжетно. Единственная причина, по которой я никому не подарю эту игру на Новый Год — в Epic Games Store пока нет возможности это сделать :-)</p></description>
        </item>
        
        <item>
            <title>Control и Poets of the Fall</title>
            <link>https://kostyanetsky.ru/notes/control-and-poets-of-the-fall/</link>
            <guid isPermaLink="false">note-control-and-poets-of-the-fall</guid>
            <pubDate>Fri, 23 Aug 2019 18:02:23 +0700</pubDate>
            <description><p class="measure-wide">Я и так уже не устоял перед рыжей чертовкой из <a class="link blue dim bb" href="https://youtu.be/oFjb_vlCsRA">трейлера</a> Control, а этим роликом ребята из Remedy и вовсе зашли с непробиваемых козырей.</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/EpiahpKp-VA" width="560"></iframe>
<p class="measure-wide">Послушайте, это просто неприлично круто! Можно как-нибудь перемотать время на конец августа? :-)</p></description>
        </item>
        
        <item>
            <title>Парадокс Ферми</title>
            <link>https://kostyanetsky.ru/notes/fermi-paradox/</link>
            <guid isPermaLink="false">note-fermi-paradox</guid>
            <pubDate>Mon, 19 Aug 2019 10:38:32 +0700</pubDate>
            <description><div class="blog-embedded-tweet" data-tweet-id="1162911267419492353"><a class="link blue dim bb" href="https://twitter.com/tramdrey/status/1162911267419492353">Твит</a></div>
<p class="measure-wide">Причем, если игра хорошая, это обычно происходит как-то незаметно. Сидишь такой гоняешь в нишевый азиатский хоррор, а потом щелк! И приходишь в себя через пару часов где-нибудь в википедии, на странице про второй кризис в Тайваньском проливе.</p>
<p class="measure-wide">Статья про парадокс Ферми, кстати, и правда годная — пусть обзор, но написан живо и человеком, который любит то, о чем пишет.</p></description>
        </item>
        
        <item>
            <title>На, мужик, изоленту</title>
            <link>https://kostyanetsky.ru/notes/duct-tape/</link>
            <guid isPermaLink="false">note-duct-tape</guid>
            <pubDate>Fri, 02 Aug 2019 10:34:49 +0700</pubDate>
            <description><p class="measure-wide">Начитанные друзья иногда спрашивают — мол, какая у тебя любимая книга? Мне, блин, всегда чутка стыдно отвечать на этот вопрос, потому что при всём том огромном выборе, который есть, это «Марсианин» Энди Вейера.</p>
<p class="measure-wide">Если опустить то, что это классный приключенческий роман, то причина проста: как программист, я чувствую необыкновенное духовное родство с человеком, который решил кучу сложных инженерных проблем с помощью изоленты.</p>
<blockquote>
<p class="measure-wide">Да, разумеется, изолента работает почти в вакууме. Изолента работает почти везде и повсюду. Изолента — это дар богов, ей нужно поклоняться.</p>
<p class="measure-wide"><em>― Энди Вейер, «Марсианин»</em></p>
</blockquote></description>
        </item>
        
        <item>
            <title>Observation</title>
            <link>https://kostyanetsky.ru/notes/observation/</link>
            <guid isPermaLink="false">note-observation</guid>
            <pubDate>Sun, 28 Jul 2019 10:22:58 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/58ibIuaHer8" width="560"></iframe>
<p class="measure-wide">За бортом — недалекое будущее, а вы — искусственный интеллект космической станции, на которой произошла катастрофа. Работа ваших систем нарушена, большая часть данных потеряна, а экипаж — чёрт знает где. Во всём этом нужно разобраться и навести порядок.</p>
<p class="measure-wide">Это завязка недавней <a class="link blue dim bb" href="https://www.epicgames.com/store/ru/product/observation/home">Observation</a> от No Code. Коротко: игра — пушка. Зайдет любителям научной фантастики, особенно классики (Артур Кларк, вот это всё). Из последнего, во что я играл в этом жанре, круче — только <a class="link blue dim bb" href="https://store.steampowered.com/app/282140/SOMA/">SOMA</a>.</p>
<p class="measure-wide">Искренне советую не читать никаких обзоров (журналисты без спойлеров двух слов связать не могут) и не смотреть официальный трейлер — в игре крутое интро и его стоит посмотреть внутри истории, а не на ютубе.</p>
<p class="measure-wide">Музыку к интро, кстати, написал Робин Финк (Nine Inch Nails). Вижуал в момент просмотра непонятен, но когда догоняешь, что именно там показывают — невольно проникаешься.</p></description>
        </item>
        
        <item>
            <title>Хороший день</title>
            <link>https://kostyanetsky.ru/notes/rapunzel/</link>
            <guid isPermaLink="false">note-rapunzel</guid>
            <pubDate>Tue, 09 Jul 2019 10:15:16 +0700</pubDate>
            <description><div class="blog-embedded-tweet" data-tweet-id="1146234848362713088"><a class="link blue dim bb" href="https://twitter.com/IZRART/status/1146234848362713088">Твит</a></div>
<blockquote>
<p class="measure-wide">Дорогой дневник! Сегодня мне заплатили, чтобы я нарисовал думгая, который учит Рапунцель из диснеевской «Запутанной истории» стрельбе из тяжелой штурмовой винтовки. Сегодня был хороший день!</p>
<p class="measure-wide"><em>― izra</em></p>
</blockquote>
<p class="measure-wide">Обожаю художников. Особенные люди :-)</p>
<p class="measure-wide">(а также на рисунке я, обучающий дочку, как рашить зилотами в Starcraft 2)</p></description>
        </item>
        
        <item>
            <title>Мультиязычность в Vue.js</title>
            <link>https://kostyanetsky.ru/notes/vue-i18n/</link>
            <guid isPermaLink="false">note-vue-i18n</guid>
            <pubDate>Tue, 25 Jun 2019 14:29:28 +0700</pubDate>
            <description><p class="measure-wide">Я веду этот сайт на русском языке, но есть и <a class="link blue dim bb" href="https://kostyanetsky.me">зеркало</a> на английском — туда я постепенно перевожу то, что написал здесь. Поддерживать два набора скриптов я не хочу, поэтому оба домена ссылаются на один и тот же сервер, который определяет, с какого домена пришел запрос — и выводит ответ на соответствующем языке.</p>
<p class="measure-wide">Звучит просто, но на самом деле эта задача рождает довольно много дополнительных проблем, и одна из них — вывод интерфейса. Сначала я <s>по привычке</s> завел на клиенте два массива с фразами на разных языках, но быстро выкинул этот велосипед и прикрутил <a class="link blue dim bb" href="https://www.npmjs.com/package/vue-i18n">Vue I18n</a>.</p>
<p class="measure-wide">На нижнем уровне это, правда, всё те же <a class="link blue dim bb" href="https://kazupon.github.io/vue-i18n/guide/formatting.html#named-formatting">два массива</a> с фразами (их нужно задать при инициализации), однако выгода здесь в другом. Этот плагин сам по себе закрывает еще две проблемы с генерацией интерфейса:</p>
<ol class="measure-wide">
<li><a class="link blue dim bb" href="https://kazupon.github.io/vue-i18n/guide/pluralization.html">Склонение существительных</a>. Нужно, чтобы правильно выводить слово «страница» в <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/tags/">статистике по тегам</a> — одна заметка, две заметки, пять заметок и так далее.</li>
<li><a class="link blue dim bb" href="https://kazupon.github.io/vue-i18n/guide/datetime.html">Вывод дат</a>. Например, дата под этой заметкой.</li>
</ol>
<p class="measure-wide">Обе задачи, конечно, можно было закрыть на стороне сервера, силами PHP, но я счел это некрасивым решением. Сервер должен возвращать данные, клиент — строить интерфейс. Нечего их смешивать.</p></description>
        </item>
        
        <item>
            <title>Draugen</title>
            <link>https://kostyanetsky.ru/notes/draugen/</link>
            <guid isPermaLink="false">note-draugen</guid>
            <pubDate>Mon, 10 Jun 2019 18:03:04 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/ziNZqEw0Adg" width="560"></iframe>
<p class="measure-wide">Сравнительно короткая, но по-своему яркая история. Проиграть тут нельзя, особого выбора (кроме вариантов реплик) нет. Но то, как тут всё звучит и выглядит, то, как здорово прописаны персонажи — удивляет и трогает. Даже если угадываешь повороты сюжета до того, как с ними столкнешься.</p>
<p class="measure-wide">В целом игра напомнила то ли Firewatch, то ли The Vanishing of Ethan Carter. Сюжет, на мой вкус, мог быть немного длиннее и заметно драматичнее, но мне всё равно чертовски понравилось, как всё закончилось. Эмоции от финала можно выразить — <strong>осторожно, спойлер</strong> — <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/draugen/the-main-thing-is.jpg">вот этой картинкой</a> :-)</p></description>
        </item>
        
        <item>
            <title>И приятнее пахнуть</title>
            <link>https://kostyanetsky.ru/notes/burned-people/</link>
            <guid isPermaLink="false">note-burned-people</guid>
            <pubDate>Mon, 10 Jun 2019 17:04:33 +0700</pubDate>
            <description><p class="measure-wide">На днях выпустили очередный релиз FirstBIT ERP (наш программный продукт для автоматизации бизнеса в ОАЭ). Вложен вагон труда, всё работает как надо, есть чем гордиться и всё такое. Я, например, кучу сил потратил на то, чтобы сделать полноценный обмен данными с Битрикс24 и порядком рад, что успел этот механизм зафиналить.</p>
<p class="measure-wide">Но в душе всё равно немного завидно <a class="link blue dim bb" href="https://steamcommunity.com/games/505230/announcements/detail/1597002662743679418">коллегам</a> из геймдева: наши патчноуты, конечно, тоже интересные, но <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/burned-people/better.png">такого</a> там всё-таки не встретить.</p></description>
        </item>
        
        <item>
            <title>Сикока сикока?</title>
            <link>https://kostyanetsky.ru/notes/so-much/</link>
            <guid isPermaLink="false">note-so-much</guid>
            <pubDate>Wed, 05 Jun 2019 20:27:34 +0700</pubDate>
            <description><p class="measure-wide">Этот сайт почти полностью написан на PHP. JavaScript на клиенте используется ситуативно — редирект сделать, картинку показать и так далее.</p>
<p class="measure-wide">Для личного ресурса ничего сложнее и не нужно, но некоторое время назад мне приспичило слегка освежить свои навыки веб-разработки. В качестве платформы для эксперимента я выбрал Vue.js — популярный, быстрый и не слишком сложный фреймворк.</p>
<p class="measure-wide">Я, собственно, к чему это всё пишу. Развернул тут Node.js, Vue CLI, создал первый проект — и чуть не поседел. Триста мегабайт джаваскрипта прямо со старта?! Серьёзно?!</p></description>
        </item>
        
        <item>
            <title>Yomawari: Night Alone</title>
            <link>https://kostyanetsky.ru/notes/yomawari-night-alone/</link>
            <guid isPermaLink="false">note-yomawari-night-alone</guid>
            <pubDate>Thu, 30 May 2019 06:55:37 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/Li5YQxI_WQg" width="560"></iframe>
<p class="measure-wide">Клевая изометрическая бродилка про город, набитый классическими японскими призраками и девочку, которая в этом городе ищет пропавшую сестру. Не слишком страшная — она, скорее, держит в напряжении. Не слишком сложная, хотя требует внимательности и концентрации (привидений много, ведут они себя по-разному, нужно смотреть по сторонам и не считать ворон). Не слишком быстрая, хотя местами всё-таки нужна хорошая реакция (особенно ближе к концу сюжетной линии).</p>
<p class="measure-wide">В целом оставила очень приятное ощущение проекта, в который, может, и не были вложены миллионы, но который старались сделать настолько хорошо, насколько это было возможно.</p></description>
        </item>
        
        <item>
            <title>Большая таблица на клиенте</title>
            <link>https://kostyanetsky.ru/notes/big-table-at-client/</link>
            <guid isPermaLink="false">note-big-table-at-client</guid>
            <pubDate>Sun, 19 May 2019 16:54:12 +0700</pubDate>
            <description><p class="measure-wide">Про нюансы работы со здоровенными таблицами на клиенте я уже пару раз писал (<a class="link blue dim bb" href="https://kostyanetsky.ru/notes/find-rows-at-client">раз</a>, <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/big-value-tables">два</a>), но в конце прошлой недели коллеги подсказали ещё один любопытный способ оптимизации работы с относительно большими коллекциями данных на клиенте. Вкратце: стандарт <a class="link blue dim bb" href="https://its.1c.ru/db/v8std#content:628:hdoc">советует</a> работать с большими коллекциями только на сервере, однако если сразу обойти всю коллекцию на клиенте (например, в обработчике открытия формы) — она закешируется. В итоге последующие обходы, поиск строк и другая работа с данными не будут требовать дополнительных серверных вызовов. Суммарные расходы при таком подходе получаются ниже.</p>
<p class="measure-wide">Погонял сейчас простые тесты — да, похоже, что так и есть. Метод выглядит отчасти костыльно и на серьезных нагрузках я его ещё не проверял — но, вероятно, его вполне можно иметь ввиду.</p></description>
        </item>
        
        <item>
            <title>Close to the Sun</title>
            <link>https://kostyanetsky.ru/notes/close-to-the-sun/</link>
            <guid isPermaLink="false">note-close-to-the-sun</guid>
            <pubDate>Tue, 14 May 2019 15:17:22 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/UMsQ2oB006w" width="560"></iframe>
<p class="measure-wide">Игрожуры и ютуберы соревнуются, кто задорнее обложит «Close to the Sun» в рецензиях, а мне игра неожиданно понравилась. Конечно, это не шедевр, но атмосфера огромного «летучего голландца» передана просто отлично. Происходящее местами напоминает Биошок, но я очень далек от того, чтобы валять в перьях любую историю, которая чем-то похожа на то, что я уже где-то видел.</p>
<p class="measure-wide">А ещё во время финальных титров тут играет очень крутой <a class="link blue dim bb" href="https://www.youtube.com/watch?v=TiRZVAO2XbQ">сингл</a>, который буквально продал мне игру пару дней назад и который можно слушать, к самой игре не прикасаясь.</p></description>
        </item>
        
        <item>
            <title>Задержки PageLatch</title>
            <link>https://kostyanetsky.ru/notes/pagelatch/</link>
            <guid isPermaLink="false">note-pagelatch</guid>
            <pubDate>Mon, 22 Apr 2019 20:00:30 +0700</pubDate>
            <description><p class="measure-wide">Задержки вида PageIOLatch (я про них сегодня <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/pageiolatch">писал</a>) легко встретить в любых системах, в том числе небольших. С задержками PageLatch дела обстоят наоборот — их трудно заметить, пока пользователей меньше нескольких тысяч.</p>
<p class="measure-wide">Дело в том, что они возникают, когда страница находится в оперативной памяти и её пытаются изменить несколько пользователей. Пока один пользователь не завершит модификацию — прочие должны ждать. Время ожидания обычно ничтожно, однако если конкурирующих за страницу пользователей много — оно становится заметным.</p>
<p class="measure-wide">Возможных причин две.</p>
<h2>Горячее место в индексе</h2>
<p class="measure-wide">Такой расклад иногда называют хотспотом. Он возникает, когда мы массово пытаемся писать что-то на последнюю страницу индекса; в первую очередь речь идёт об индексе с монотонно возрастающим ключом — например, любые индексы по полям ссылочного типа (начиная с последних версий 8.2, платформа выдает последовательные GUID — это снижает фрагментацию диска и делает ключ индекса монотонно возрастающим).</p>
<p class="measure-wide">Что такое «индекс с монотонно возрастающим ключом»? Для платформы 1С это, например, индексы регистров по периоду. Конечно, они растут не вполне монотонно — однако тут скорее важно, что данные мы всегда будем писать в конец. Сюда же относятся индексы по номеру документа и индексы по коду справочника — в обеих случаях мы выдаем некий новый номер, который пишется в конец индекса.</p>
<p class="measure-wide">Решается проблема хотспота только архитектурно — нужно добиться того, чтобы данные записывались в разные места индекса, а не только в конец.</p>
<h2>Системные страницы tempdb</h2>
<p class="measure-wide">Когда мы создаём или удаляем таблицу в базе данных, в ней обновляется ряд служебных страниц — IAM (Index Allocation Map), PFS (Page Free Space), GAM (Global Allocation Map), SGAM (Shared Global Allocation Map) и другие.</p>
<p class="measure-wide">Почему это важно для tempdb? Для платформы 1С это база, в которой регулярно создается <strong>огромное</strong> количество таблиц. Служебные страницы при этом обновляются настолько часто, что при этом возникают задержки семейства PageLatch.</p>
<p class="measure-wide">Вообще-то MS SQL Server умеет оптимизировать обновления системных страниц для tempdb, благодаря чему это делается реже, но иногда даже этого не достаточно. Особенно если в tempdb создаются таблицы с индексами — а это очень частый кейс для приложений на 1С.</p>
<p class="measure-wide">У проблемы есть несколько возможных решений. Первый — если СУБД старше 2016-й, можно отключить смешанные экстенты через флаг трассировки 1118. При этом исчезнет необходимость сразу в двух служебных страницах — GAM и SGAM. Соответственно, ожиданий на их обновлении не будет. Экстент — это восемь страниц данных, т.е. 64 килобайта; если он содержит страницы одной таблицы — это нормированный экстент, если нескольких — смешанный.</p>
<p class="measure-wide">Второй подход — разбивать tempdb (с 2016-й версии СУБД она, кстати, по умолчанию разбивается на восемь файлов). Дело в том, что служебные страницы ведутся в разрезе файлов; если их будет несколько — ожидания на обновлениях служебных страниц будут ниже.</p>
<p class="measure-wide">Третий вариант — уменьшать количество временных таблиц с целью снизить нагрузку на tempdb. То есть переписывать наиболее частотные запросы так, чтобы они работали приемлемо быстро без временных таблиц.</p></description>
        </item>
        
        <item>
            <title>Задержки PageIOLatch</title>
            <link>https://kostyanetsky.ru/notes/pageiolatch/</link>
            <guid isPermaLink="false">note-pageiolatch</guid>
            <pubDate>Mon, 22 Apr 2019 19:40:08 +0700</pubDate>
            <description><p class="measure-wide">Когда мы читаем страницу данных с диска в буферный кэш, она на очень короткое время блокируется (её нельзя писать, а в некоторых случаях — ещё и читать). Ожидание на завершении этого действия — и есть задержка PageIOLatch.</p>
<p class="measure-wide">Причиной может быть вымывание буферного кэша — из-за небольшого объёма доступной ОЗУ или не оптимальных запросов, которые читают миллионы строк, а возвращают три. В итоге СУБД регулярно не находит нужных страниц в кэше и вынуждена снова и снова читать их с диска.</p>
<p class="measure-wide">В общем, если в системе есть существенные задержки PageIOLatch — их скорее всего можно снизить, используя более быстрые диски, наращивая объём ОЗУ и оптимизируя запросы.</p></description>
        </item>
        
        <item>
            <title>Объектные блокировки</title>
            <link>https://kostyanetsky.ru/notes/object-locks/</link>
            <guid isPermaLink="false">note-object-locks</guid>
            <pubDate>Mon, 22 Apr 2019 18:42:54 +0700</pubDate>
            <description><p class="measure-wide">Во-первых, сразу, чтобы не путаться: объектные блокировки платформы никак не связаны с управляемыми блокировками и, тем более, блокировками СУБД. Во-вторых, различают два вида: пессимистические объектные блокировки и оптимистические.</p>
<p class="measure-wide">Оба вида неплохо <a class="link blue dim bb" href="https://its.1c.ru/db/metod8dev#content:5839:hdoc">описаны</a> на ИТС; ниже — просто краткая выжимка.</p>
<h2>Пессимистические блокировки</h2>
<p class="measure-wide">Накладываются расширением формы, когда пользователь начинает редактировать объект — например, меняет значение поля. Если тот же объект попробует отредактировать в форме другой пользователь — форма, которую он открыл, тоже попробует наложить пессимистическую блокировку, не сможет этого сделать и пользователь получит ошибку «Не удалось заблокировать запись».</p>
<p class="measure-wide">То есть платформа в данном случае делает своего рода пессимистичную оценку ситуации: мол, раз первый пользователь начал редактировать объект — скорее всего, он его запишет. Раз так, второму пользователю разрешать редактировать нельзя.</p>
<p class="measure-wide">Пессимистическую блокировку также можно наложить методом объекта Заблокировать() и снять через метод Разблокировать(). Кроме того, можно воспользоваться методом глобального контекста ЗаблокироватьДанныеДляРедактирования() и методом управляемой формы ЗаблокироватьДанныеФормыДляРедактирования().</p>
<h2>Оптимистические блокировки</h2>
<p class="measure-wide">Сперва немного теории: платформа хранит версии объектов ссылочного типа (справочников, документов и так далее). По сути это просто момент времени, в который объект был изменён последний раз. Когда объект считывается расширением формы или кодом — его версия считывается вместе с ним.</p>
<p class="measure-wide">Так вот, в момент записи объекта платформа сверяет ту версию, что была получена при чтении объекта из базы данных и ту, что указана в базе данных в момент записи. Если версии различаются — возникает ошибка «Операция не может быть выполнена из-за несоответствия версии или отсутствия записи базы данных».</p>
<p class="measure-wide">Это и есть так называемая «оптимистическая блокировка». Называют её так потому, что платформа тянет с проверкой до последнего — пока не произойдет реальной попытки записи. Стакан наполовину полон, все дела.</p>
<p class="measure-wide">Возвращаясь к теории — версия объекта хранится в поле _Version, и его заполнением занимается СУБД. То есть платформа на это значение никак не влияет и, соответственно, наложить оптимистическую блокировку (читай, сменить версию) объекта через код нельзя. Впрочем, можно просто записать объект — и его версия изменится.</p></description>
        </item>
        
        <item>
            <title>Растолстевшие роли</title>
            <link>https://kostyanetsky.ru/notes/fat-roles/</link>
            <guid isPermaLink="false">note-fat-roles</guid>
            <pubDate>Thu, 18 Apr 2019 16:57:50 +0700</pubDate>
            <description><p class="measure-wide">Очень любопытная <a class="link blue dim bb" href="https://start1c.blogspot.com/2019/01/blog-post.html">заметка</a> про неприятности, которые можно нажить командой роли «Снять все права». Нет, никакого криминала, права-то она честно снимает — только вот её вызов может привести к тому, что объект роли на пустом месте сожрёт в несколько раз больше памяти, чем ему реально нужно.</p>
<p class="measure-wide">Прочитал, задумался и пошел проверять, как обстоят дела с этим у нас в конфигурации. И что бы вы думали? Накопал десятка два ролей, доверху набитых «снятыми галочками». Выгрузка прав весила около трёхста мегабайт, а после оптимизации — усохла почти втрое.</p>
<p class="measure-wide">Любопытно, как это до сих пор оставалось незамеченным. Скорее всего, из-за количества объектов — у нас сравнительно небольшая конфигурация. То есть проблемные роли потребляли не так много ресурсов, чтобы мы что-то заподозрили.</p></description>
        </item>
        
        <item>
            <title>GRIS</title>
            <link>https://kostyanetsky.ru/notes/gris/</link>
            <guid isPermaLink="false">note-gris</guid>
            <pubDate>Sun, 14 Apr 2019 20:35:44 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/gvECQlxrhbw" width="560"></iframe>
<p class="measure-wide">Эту игру сравнительно сложно рекомендовать, но она и правда искусство в прямом смысле слова. Сходу даже не вспомню, когда в последний раз был заворожен настолько, что не мог оторваться.</p>
<p class="measure-wide">То ли графикой, то ли музыкой, то ли тем, что авторы очень искренне передали то состояние, о котором хотели рассказать.</p></description>
        </item>
        
        <item>
            <title>Простая галочка</title>
            <link>https://kostyanetsky.ru/notes/simple-checkbox/</link>
            <guid isPermaLink="false">note-simple-checkbox</guid>
            <pubDate>Sat, 30 Mar 2019 11:26:57 +0700</pubDate>
            <description><p class="measure-wide">Пару недель назад мы добавили в справочник номенклатуры FirstBIT ERP параметр «Inactive». Задача была простой: если товар больше не нужен пользователю — он ставит галочку и тот исчезает отовсюду (из форм выбора, форм подбора остатков на складах и так далее).</p>
<p class="measure-wide">Звучит несложно, правда? Техническая реализация тоже была простой — мы прошлись по всем объектам, в которых предполагается выбор номенклатуры, и добавили дополнительный параметр этого выбора.</p>
<p class="measure-wide"><img alt="Параметры выбора" src="https://kostyanetsky.ru/notes/simple-checkbox/choice-parameters.png"/></p>
<p class="measure-wide">Но пользователи начали жаловаться, что настройка не работает. Мы полезли разбираться и поняли, что забыли про историю ввода — этот механизм, как оказалось, параметры выбора просто игнорирует. То есть пользователи выбирали в инвойсе какой-то товар, потом делали его неактивным, возвращались и инвойс и... Снова видели в истории товар, который вроде только что отключили.</p>
<p class="measure-wide">Мы принялись искать выход. Проблема в том, что история ввода хранится в системном хранилище и повлиять на неё программно нельзя. Можно разве что полностью удалить — но фактическая очистка истории происходит только при перезапуске клиента (и то через раз). Отключить историю вообще? Напоминает лечение простуды отсечением головы.</p>
<p class="measure-wide">В какой-то момент мы наткнулись на информацию о том, что история ввода хранится не просто для конкретного поля, а ещё и в разрезе параметров выбора. То есть для каждого сочетания параметров выбора и их значений история выбора своя. Получается, если добавить некий дополнительный параметр выбора ко всем полям, где выбирается номенклатура — изменение значения этого параметра будет «чистить» историю (на самом деле, конечно, создавать новую — но пользователю-то какая разница).</p>
<p class="measure-wide">В общем, мы создали такой параметр. Хранится в общем хранилище и транслируется в формы при их открытии через общий модуль, который программно добавляет параметр выбора. Если пользователь снимает или устанавливает флаг Inactive для любой номенклатуры — значение параметра меняется, а уже открытые формы получают его через механизм оповещений.</p>
<p class="measure-wide"><img alt="Минуточку!" src="https://media.giphy.com/media/3o7btPCcdNniyf0ArS/giphy.gif"/></p>
<p class="measure-wide">А ведь как все невинно начиналось, а?</p>
<p class="measure-wide">Однако механизм неплохо работает, хотя его недостатки налицо: во-первых, системное хранилище будет постепенно пухнуть по мере появления всё новых и новых сочетаний реальных параметров выбора и нашего, фиктивного. Во-вторых, запись номенклатуры теперь потенциально узкое место: два пользователя не смогут одновременно записать номенклатуры, у которых изменены флаги Inactive (будет блокировка при записи нового значения нашего скрытого параметра выбора в общее хранилище).</p>
<p class="measure-wide">Первую проблему можно решить очисткой хранилища по какому-то триггеру, вторую — записью нашего параметра выбора в разрезе пользователей (например, через регистр сведений). Впрочем, мы искренне надеемся, что 1С даст какой-то доступ к истории ввода до того, как нам придется городить дополнительные костыли к тем, что мы уже наворотили :-)</p></description>
        </item>
        
        <item>
            <title>Дата запуска сервера MS SQL</title>
            <link>https://kostyanetsky.ru/notes/mssql-server-start-date/</link>
            <guid isPermaLink="false">note-mssql-server-start-date</guid>
            <pubDate>Fri, 08 Mar 2019 07:47:23 +0700</pubDate>
            <description><p class="measure-wide">Для чего может пригодиться дата запуска MS SQL Server? Например, мы разбираем задержки в работе СУБД и хотим определить, в течении какого периода времени наполнялась DMV-шка <a class="link blue dim bb" href="https://docs.microsoft.com/ru-ru/sql/relational-databases/system-dynamic-management-views/sys-dm-os-wait-stats-transact-sql">sys.dm_os_wait_stats</a>. Её данные (как и любой другой DMV, впрочем) хранятся в оперативной памяти как раз с момента запуска СУБД.</p>
<p class="measure-wide">Дату запуска сервера можно получить из  DMV-шки <a class="link blue dim bb" href="https://docs.microsoft.com/ru-ru/sql/relational-databases/system-dynamic-management-views/sys-dm-os-sys-info-transact-sql">sys.dm_os_sys_info</a>:</p>
<pre><code>SELECT sqlserver_start_time FROM sys.dm_os_sys_info
</code></pre>
<p class="measure-wide">Есть и другой способ, связанный с tempdb. Эта база данных создаётся при запуске сервера, и дата её создания вполне может считаться датой запуска сервера. Значение можно вытащить из <a class="link blue dim bb" href="https://docs.microsoft.com/ru-ru/sql/relational-databases/system-catalog-views/sys-databases-transact-sql">sys.databases</a>:</p>
<pre><code>SELECT create_date FROM sys.databases WHERE name = 'tempdb'
</code></pre>
<p class="measure-wide">Нюанс: дату запуска сервера как точку начала сбора данных DMV-шек нужно рассматривать с осторожностью. Накопленная статистика могла быть очищена вручную — например, вот так:</p>
<pre><code>DBCC SQLPERF('sys.dm_os_wait_stats', CLEAR)
</code></pre></description>
        </item>
        
        <item>
            <title>Задержки сервера MS SQL</title>
            <link>https://kostyanetsky.ru/notes/mssql-server-waits/</link>
            <guid isPermaLink="false">note-mssql-server-waits</guid>
            <pubDate>Fri, 08 Mar 2019 06:40:05 +0700</pubDate>
            <description><p class="measure-wide">Каждый раз, когда SQL-запрос может запуститься, но ожидает другого ресурса — он записывает сведения о причине задержки. Доступ к ним можно получить через представление <a class="link blue dim bb" href="https://docs.microsoft.com/ru-ru/sql/relational-databases/system-dynamic-management-views/sys-dm-os-wait-stats-transact-sql">sys.dm_os_wait_stats</a>.</p>
<p class="measure-wide">Для анализа представления можно использовать готовые скрипты:</p>
<ul class="measure-wide">
<li><a class="link blue dim bb" href="https://kostyanetsky.ru/notes/mssql-server-waits/causes_of_wait_times.txt">Скрипт</a> из статьи Яна Стерка «Открытие скрытых данных для оптимизации производительности приложений», опубликованной в MSDN Magazine ещё в <a class="link blue dim bb" href="https://msdn.microsoft.com/ru-ru/magazine/ee310108.aspx">2008-м</a> году. Выводит список типов задержки, упорядоченный по времени — от самых частотных до наиболее редких.</li>
<li><a class="link blue dim bb" href="https://kostyanetsky.ru/notes/mssql-server-waits/sql_server_wait_statistics.txt">Cкрипт</a> из <a class="link blue dim bb" href="https://www.sqlskills.com/blogs/paul/wait-statistics-or-please-tell-me-where-it-hurts/">статьи</a> Пола Рэндала про анализ причин задержек в работе сервера MS SQL (на Хабре, кстати, есть <a class="link blue dim bb" href="https://habr.com/ru/post/216309/">перевод</a>). Фильтрует задержки, которые возникают на сервере всегда и которые обычно можно игнорировать. Кроме того, к каждой задержке добавляется ссылка на страницу, где эта задержка детально описана (например, вот <a class="link blue dim bb" href="https://www.sqlskills.com/help/waits/cxpacket">описание</a> CXPACKET).</li>
</ul></description>
        </item>
        
        <item>
            <title>The Cursed Forest</title>
            <link>https://kostyanetsky.ru/notes/cursed-forest/</link>
            <guid isPermaLink="false">note-cursed-forest</guid>
            <pubDate>Wed, 06 Mar 2019 19:35:51 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/uoCdg6SQRoA" width="560"></iframe>
<p class="measure-wide">Ничего не ждал от игры, но она, внезапно, удалась. Выглядит бодро; чувствуется внимание к деталям, да и в сумме — совсем неплохо. А ближе к концу — ещё и трогательно.</p>
<p class="measure-wide">Садитесь играть по всем правилам — гасите свет, надевайте наушники и, конечно, выключайте душнилу.</p></description>
        </item>
        
        <item>
            <title>Повторяющийся ключ</title>
            <link>https://kostyanetsky.ru/notes/duplicate-key/</link>
            <guid isPermaLink="false">note-duplicate-key</guid>
            <pubDate>Fri, 01 Mar 2019 17:17:35 +0700</pubDate>
            <description><p class="measure-wide">На Инфостарте вышла любопытная <a class="link blue dim bb" href="https://infostart.ru/public/1010017/">статья</a> про ошибку СУБД «cannot insert duplicate key». Одна из возможных причин сбоя — использование уникального идентификатора объекта для сопоставления при обмене с другими информационными базами (то есть, без служебного регистра, сопоставляющего объекты базы данных с идентификаторами объектов внешней базы).</p>
<p class="measure-wide">Такой жести, чтобы уникальные идентификаторы совпали в разных базах для одной и той же таблицы, у меня в практике пока не было. Однако от подхода «единого идентификатора» я отрекся окончательно после того, как делал обмен между <a class="link blue dim bb" href="https://firstbit.ae/products/erp-dubai/financial_management/">FirstBIT ERP</a> и <a class="link blue dim bb" href="http://superagent.ru/products/grotem_agent">GROTEM / Agent</a>.</p>
<p class="measure-wide">Архитектура пилотного решения была такая: данные из FirstBIT ERP выгружались сперва в служебную ИБ 1С, написанную разработчиками GROTEM'а, а уже оттуда — в основную базу данных сервера мобильных приложений.</p>
<p class="measure-wide">Сопоставление было сделано очень просто — через идентификаторы объектов. Например, один и тот же документ в обеих базах имел один и тот же идентфикатор. Но были и более сложные схемы: например, контрагент FirstBIT ERP на стороне GROTEM'а превращался в три объекта: собственно контрагента, торговую точку и документ взаиморасчетов.</p>
<p class="measure-wide"><img alt="WAIT WHAT" src="https://media.giphy.com/media/zkSFsZpQMZuG4/giphy.gif"/></p>
<p class="measure-wide">Да, в документ взаиморасчетов. И все три объекта имели один и тот же идентфикатор — идентификатор контрагента FirstBIT ERP. В общем, не то чтобы это было очень изящным решением, но для платформы такой расклад вполне адекватен и мы решили, что проблем быть не должно.</p>
<p class="measure-wide">Однако обмен работать отказался.</p>
<p class="measure-wide">Беглый анализ показал, что данные успешно выгружаются в промежуточную базу данных и проходят все возможные проверки на целостность и полноту, а не работает только финальный шаг — выгрузка в базу данных сервера мобильных приложений.</p>
<p class="measure-wide">В итоге выяснилось, что:</p>
<ol class="measure-wide">
<li>В этой самой базе есть таблица, где хранятся все интересующие нас объекты. Документы, элементы справочников, вот это всё.</li>
<li>Эта таблица имеет уникальный индекс по GUID объекта.</li>
</ol>
<p class="measure-wide">В этом месте интрига закончилась. Ну да, первый же выгруженный контрагент создавал целых три сущности с одним и тем же GUID, которые прекрасно лежали в своих таблицах на стороне 1С, но не могли быть записаны в одну общую таблицу базы данных приложения.</p>
<p class="measure-wide"><img alt="I will not use GUIDs to map objects!" src="https://kostyanetsky.ru/notes/duplicate-key/i-will-not-use-guids.gif"/></p></description>
        </item>
        
        <item>
            <title>Одиночество</title>
            <link>https://kostyanetsky.ru/notes/loneliness/</link>
            <guid isPermaLink="false">note-loneliness</guid>
            <pubDate>Fri, 01 Mar 2019 16:50:19 +0700</pubDate>
            <description><p class="measure-wide">Хороший ролик про одиночество, его причины и последствия (спойлер: все серьёзно, вплоть до биологического уровня). Рассказывают на английском, но если нужно — там есть русские субтитры.</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/n3Xv_g3g-mA" width="560"></iframe>
<p class="measure-wide">(емкий <a class="link blue dim bb" href="https://twitter.com/StatusyOk/status/1098845710668185602">твит</a> о том же)</p>
<p class="measure-wide">(а также я, походу, достаточно много наиграл в Starcraft II, чтобы название ролика у меня в голове произносилось исключительно голосом Зератула и под музыку из <a class="link blue dim bb" href="https://www.youtube.com/watch?v=xu94hnQDnRY">Alone</a>)</p></description>
        </item>
        
        <item>
            <title>Неудачная охота</title>
            <link>https://kostyanetsky.ru/notes/failed-hunt/</link>
            <guid isPermaLink="false">note-failed-hunt</guid>
            <pubDate>Thu, 21 Feb 2019 16:42:32 +0700</pubDate>
            <description><p class="measure-wide">При обновлении платформы до 8.13.12.1790 наткнулись на плавающий баг при переключении текущей страницы элемента на сервере. Конкретно на сервере оно срабатывает, но как только управление возвращается на клиент — текущей страницей становится та, что была до изменения. При этом ещё и происходит событие изменения текущей страницы (как будто пользователь сменил её вручную).</p>
<p class="measure-wide">Неприятно, но, в общем, ничего страшного — запатчили баг, описали и зарепортили в 1С. Там пока <a class="link blue dim bb" href="https://bugboard.v8.1c.ru/error/000050675.html">думают</a>. Но я, внезапно, даже как-то расстроен — когда расследуешь такие штуки, они всегда выглядят немного загадочно и кажется, что ты вот-вот найдешь что-то интересное! Например, новый аспект работы платформы или что-то вроде этого.</p>
<p class="measure-wide">И вот, наконец, ты смотришь на проблему под правильным углом, а она — обычный жук. Возможно, полосатый или в крапинку, но жук как жук — сидит себе, шевелит усами. И ты такой: блин, это что — и есть моя добыча? :-)</p></description>
        </item>
        
        <item>
            <title>Большие таблицы значений</title>
            <link>https://kostyanetsky.ru/notes/big-value-tables/</link>
            <guid isPermaLink="false">note-big-value-tables</guid>
            <pubDate>Sun, 17 Feb 2019 11:55:37 +0700</pubDate>
            <description><p class="measure-wide">Пока писал про <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/find-rows-at-client/">поиск строк</a> на клиенте, вспомнил ещё один нюанс, связанный с данными на управляемых формах — тоже про передачу между клиентом и сервером.</p>
<p class="measure-wide">Допустим, нам по условиям задачи нужно оперировать сравнительно большими (тысячи строк) таблицами значений. Это могут быть данные, которые в общем случае не нужно показывать пользователю: например, параметры расчета цен, информация о продажах и закупках, что-то ещё. Логично создать такие таблицы в виде атрибутов формы — хотя бы потому, что можно использовать удобный конструктор.</p>
<p class="measure-wide">Но когда платформа решит передать такую таблицу на сервер, начнутся проблемы. Дело в том, что передавать она будет не простой и компактный объект ТаблицаЗначений, а весьма насыщенный ДанныеФормыКоллекция. Разница колоссальна — на одном из наших проектов траты на такой обмен данными составляли порядка 40% от всего времени работы ключевой операции.</p>
<p class="measure-wide">Решение достаточно очевидно — не использовать атрибуты формы вообще. Вместо этого создавать таблицы значений с помощью кода (например, в обработчике ПриСозданииНаСервере), закидывать их во временное хранилище, а в атрибутах формы хранить только адреса хранилища. Таким образом при необходимости поработать с таблицей на сервер отправляется только строка с адресом, и расходы на сериализацию и обмен данными начинают стремиться к нулю. На сервере извлекаем таблицу, читаем данные, изменяем их, если нужно, и сохраняем обратно во временное хранилище — по тому же адресу.</p></description>
        </item>
        
        <item>
            <title>Алита: Боевой ангел</title>
            <link>https://kostyanetsky.ru/notes/alita-battle-angel/</link>
            <guid isPermaLink="false">note-alita-battle-angel</guid>
            <pubDate>Sat, 16 Feb 2019 12:16:51 +0700</pubDate>
            <description><p class="measure-wide">Тот неловкий момент, когда заходишь на сайт почтенного издания, чтобы посмотреть ультракороткую <a class="link blue dim bb" href="https://meduza.io/slides/chto-smotret-v-kino-alita-boevoy-angel-chestnyy-chelovek-ayka">рецензию</a> на «Алиту», а тебя оттуда обкладывают уважительным отношением к читателю :D</p>
<p class="measure-wide"><img alt="OH HI" src="https://media.giphy.com/media/fDO2Nk0ImzvvW/giphy.gif"/></p>
<p class="measure-wide">По сути: отличный фильм для любителей крутого экшена, разве что концовка, как по мне, подкачала. Манга, кстати, заметно длиннее (фильм пересказывает лишь несколько первых томов), так что если к концу просмотра НАКОПИЛИСЬ ВОПРОСЫ — в ней есть ответы.</p></description>
        </item>
        
        <item>
            <title>Эволюция</title>
            <link>https://kostyanetsky.ru/notes/evolution/</link>
            <guid isPermaLink="false">note-evolution</guid>
            <pubDate>Sat, 16 Feb 2019 11:22:43 +0700</pubDate>
            <description><p class="measure-wide">Говоря о развитии чего-либо (продукта, языка общения, языка программирования и так далее), люди иногда называют это «эволюцией». Мол, процессы похожи — неудачные решения точно так же постепенно вымываются, а удачные — остаются и усиляют сущность, к которой принадлежат. Так-то оно так, но я сейчас вспомнил не про позитивную сторону — фигня в том, что в ходе эволюции потомки, кроме полезных ништяков, получают все хреново выстроенные и зачастую бессмысленные механизмы, которые не смогли прикончить предка.</p>
<p class="measure-wide">В итоге мы задерживаем дыхание, когда глотаем, путаемся между dissatisfied и unsatisfactory, а ещё программируем на чудесном языке JavaScript — который, при всём своем удобстве и распостраненности, вобрал в себя все мыслимые и немыслимые недостатки скриптовых языков.</p>
<p class="measure-wide">Но это нам ещё везёт — есть, например, жирафы! У этих ребят гортанный нерв сначала спускается по шее на два метра вниз, а потом — поднимается обратно к мышцам гортани (ага, вместо того, чтобы пройти несколько сантиметров от мозга напрямую).</p>
<p class="measure-wide">Зная всё это, мне чуть-чуть проще смотреть на то, во что иногда превращается мой код на очередном цикле разработки. Ну и что, что у этого хомячка отрос драконий хвост? Эволюционно, например, такой хвост очень полезен. Кто я такой, чтобы спорить с Дарвином?</p>
<div class="blog-embedded-tweet" data-tweet-id="966624401172123649"><a class="link blue dim bb" href="https://twitter.com/bluecoders/status/966624401172123649">Твит</a></div></description>
        </item>
        
        <item>
            <title>Найти строки на клиенте</title>
            <link>https://kostyanetsky.ru/notes/find-rows-at-client/</link>
            <guid isPermaLink="false">note-find-rows-at-client</guid>
            <pubDate>Tue, 12 Feb 2019 17:14:18 +0700</pubDate>
            <description><p class="measure-wide">Про то, что метод НайтиСтроки() для коллекций данных формы горазд под шумок сделать серверный вызов, я узнал довольно давно, столкнувшись с неадекватно долгим открытием формы документа — в ней он вызывался при открытии, да ещё и в цикле. Так делать, конечно, не нужно, на что мягко намекает справка: calling the method executes a server call.</p>
<p class="measure-wide">Однако сегодня писал код для задачи с похожей механикой и заметил, что серверных вызовов по факту нет. Удивился, полез на ИТС и, в общем, дело в следующем: при вызове НайтиСтроки() на клиенте поиск на нём и происходит, однако платформа не держит все данные больших коллекций на клиенте. Они передаются с сервера, и запрос этих данных с клиента — тот самый серверный вызов, на который ссылается справка.</p>
<p class="measure-wide">Разработчики платформы расплывчато описывают объем коллекции, до которого клиенту не нужно обращаться к серверу (на ИТС пишут, что это порядка двадцати строк). Так что подход не меняется: делаем явный серверный вызов и не переживаем, что платформа решит наделать своих. Впрочем, всегда приятно немного лучше понимать, что внутри барабанчика :-)</p></description>
        </item>
        
        <item>
            <title>Ай ду май бэст</title>
            <link>https://kostyanetsky.ru/notes/i-wish-i-could/</link>
            <guid isPermaLink="false">note-i-wish-i-could</guid>
            <pubDate>Tue, 12 Feb 2019 05:17:34 +0700</pubDate>
            <description><p class="measure-wide">Что здорово облегчает работу над английским языком — так это практика, которая буквально сама лезет в руки. Причем порой она полезнее каких-нибудь примеров с условного Cambridge Dictionary — просто потому, что лучше запоминается.</p>
<p class="measure-wide">Например, вчера проходили на занятиях гипотетические формулировки и запоминали, как правильно понимать wish и if only; сегодня первое, что попалось в ленте — вот этот твит. Куда уж доходчивее :-)</p>
<div class="blog-embedded-tweet" data-tweet-id="1046952683477729282"><a class="link blue dim bb" href="https://twitter.com/roxiqt/status/1046952683477729282">Твит</a></div>
<p class="measure-wide">Или, скажем, недавно освежали в памяти разницу между try и trying — а я её запомнил давным-давно по вымученному «I do my best» Фелисити из Borderlands: The Pre-Sequel. Ситуация там была довольно яркая, и этот оттенок невозможности выполнить задачу здорово въелся в память.</p></description>
        </item>
        
        <item>
            <title>Из чего сделаны наши девчонки?</title>
            <link>https://kostyanetsky.ru/notes/what-are-our-girls-made-of/</link>
            <guid isPermaLink="false">note-what-are-our-girls-made-of</guid>
            <pubDate>Sat, 09 Feb 2019 16:08:00 +0700</pubDate>
            <description><p class="measure-wide">На фоне скандальной рекламы «Reebok» (я в этой теме полный мимокрокодил, но взрывная волна даже до меня докатилась) на ютубе попался классный ролик их конкурентов. Ему уже пара лет, но он ровно про то же и, блин! Реклама здорового человека — не знаю, как лучше выразиться.</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/xifSHMbGSKI" width="560"></iframe>
<p class="measure-wide">Показал мелкой — смотрела глазами по пять копеек. Покажу ещё раз, когда опять будет батониться вместо тренировки :-)</p></description>
        </item>
        
        <item>
            <title>Внезапный барабанщик</title>
            <link>https://kostyanetsky.ru/notes/drummer/</link>
            <guid isPermaLink="false">note-drummer</guid>
            <pubDate>Sat, 09 Feb 2019 12:34:07 +0700</pubDate>
            <description><p class="measure-wide">Я пишу на платформе 1С довольно давно и повидал некоторое дерьмо, но такое, честно говоря, вижу первый раз.</p>
<p class="measure-wide"><a href="https://kostyanetsky.ru/notes/drummer/bug.png"><img alt="Оттакота!" src="https://kostyanetsky.ru/notes/drummer/bug-thumbnail.png"/></a></p>
<p class="measure-wide">Поначалу я даже не понял, с какого конца это жевать. Поискал перевод иероглифа — Википедия лишь сухо сообщила, что это такой <a class="link blue dim bb" href="https://en.wiktionary.org/wiki/%E4%80%80">тип чашки</a>, а Google Translate вообще <a class="link blue dim bb" href="https://translate.google.com/#view=home&amp;op=translate&amp;sl=auto&amp;tl=ru&amp;text=%E4%80%80">развёл руками</a>.</p>
<p class="measure-wide">Коллега заметил, что символ отдаленно похож на складского сортировщика — мол, перекладывает что-то там себе между коробками. Не знаю, не знаю. По-моему, больше напоминает барабанщика за работой. Но что, черт побери, это значит? Может быть, 1С пытается что-то мне сказать? Что-то про музыку?</p>
<p class="measure-wide">Может, мне нужно было стать басистом, а не вот это всё.</p></description>
        </item>
        
        <item>
            <title>Удаление временных таблиц</title>
            <link>https://kostyanetsky.ru/notes/temporary-tables-deletion/</link>
            <guid isPermaLink="false">note-temporary-tables-deletion</guid>
            <pubDate>Thu, 07 Feb 2019 17:35:29 +0700</pubDate>
            <description><p class="measure-wide">Любопытная деталь: при закрытии менеджера временных таблиц не происходит удаления этих таблиц из tempdb. Актуально и для прямого вызова метода Закрыть() объекта менеджера, и для неявного варианта (когда объект менеджера уничтожается при завершении метода, в котором он был создан). На деле в обеих случаях выполняется только TRUNCATE, который удаляет данные таблицы; сама же таблица остаётся на случай, если пользователь снова выполнит запрос с таким же составом полей (это выгоднее, чем заново её создавать).</p>
<p class="measure-wide">То же самое (удаление данных, но не самой таблицы) происходит при прямом вызове УНИЧТОЖИТЬ из текста запроса. К слову, эта команда вообще редко бывает осмыслена — разве что если объект менеджера живет сравнительно долго, а во временную таблицу помещён большой объем данных, от которого хочется побыстрее избавиться.</p>
<p class="measure-wide">Что до удаления таблицы, то оно выполняется только при закрытии соединения с сервером приложений.</p></description>
        </item>
        
        <item>
            <title>Конкатенация строк</title>
            <link>https://kostyanetsky.ru/notes/string-concatenation/</link>
            <guid isPermaLink="false">note-string-concatenation</guid>
            <pubDate>Sun, 27 Jan 2019 11:52:24 +0700</pubDate>
            <description><p class="measure-wide">Как и многие другие компании, мы даем соискателям тестовое задание. Оно намеренно несложное и нужно больше для того, чтобы посмотреть — насколько кандидат понимает платформу? Как аккуратно работает с объектами конфигурации и её кодом?</p>
<p class="measure-wide">Одна из множества мелких штук, которые там проверяются — это формирование длинного сообщения для пользователя, включающее множество параметров. Разработчик может делать это через СтрШаблон() или СтрСоединить(), а может — через простую конкатенацию (соединение) строк. Если кандидат использует последний вариант — это считается небольшим минусом: для пользователя результат будет тот же, но вот понять из кода, как он будет примерно выглядеть — заметно сложнее.</p>
<p class="measure-wide">Однако результат, как выяснилось, тоже может отличаться. В первой половине прошлого года «Рарус» опубликовал <a class="link blue dim bb" href="http://techlab.rarus.ru/upload/iblock/2/185/Beeline-obespechenie-bespereboynoy-raboti.pdf">отчет</a> о работах, проделанных для «Билайна». Там много любопытного, но среди прочего есть совершенно оглушительный пункт: за счет отказа от соединения строк разработчики добились 40% снижения нагрузки на процессоры! От двух дополнительных серверов после этих изменений вообще отказались, так как они стали не нужны :-)</p>
<p class="measure-wide">Проблема возникала из-за того, чтобы рабочие процессы тратили слишком много времени на распределение памяти для склейки строк. В случае однократного соединения заметной нагрузки не возникает, однако когда мы, например, собираем большой запрос в цикле и делаем это многократно — нагрузка растет лавинообразно. Конкатенацию в таких случаях использовать нельзя, правильный вариант — СтрСоединить() или СтрШаблон(). На старых версиях платформы, где этих методов нет, можно применять объект текстового документа — добавлять в него строки, а потом получать текст.</p></description>
        </item>
        
        <item>
            <title>Не скомпилированный код</title>
            <link>https://kostyanetsky.ru/notes/incompiled-code/</link>
            <guid isPermaLink="false">note-incompiled-code</guid>
            <pubDate>Sun, 27 Jan 2019 10:09:59 +0700</pubDate>
            <description><p class="measure-wide">Не очевидная штука: абстрактная внешняя обработка работает заметно медленнее точно такой же, но встроенной в конфигурацию или её расширение. Причина — её код нужно заново компилировать для каждого пользователя при каждом запуске (тогда как код встроенных обработок компилируется один раз и для всех). Судя по <a class="link blue dim bb" href="https://kb.1c.ru/articleView.jsp?id=111">статье</a> в базе знаний 1С, для платформы 8.3.10 это было прямо катастрофа, но и пятидесятипроцентный рост нагрузки на процессор в 8.3.13 — тоже, в общем, ничего хорошего.</p>
<p class="measure-wide">Другой подход с тем же эффектом — это хранение кода внутри базы (в реквизитах служебных справочников, например). Каждый раз, когда такой код нужно запустить, он извлекается из БД и компилируется. Например, у нас в <a class="link blue dim bb" href="https://firstbit.ae/products/erp-dubai/financial_management/">конфигурации</a> можно создавать регламентные задания без изменения метаданных — просто добавляем элемент специального справочника, загружаем в него код и настраиваем расписание работы.</p>
<p class="measure-wide">Это относительно нормально — регламентные задания обычно выполняются не слишком часто и компиляция, скорее всего, не создаст сколько-либо заметной нагрузки на процессор. Однако этот же справочник может использоваться и для автоматического вызова какого-либо кода после произвольного события: например, после сохранения документа определенного типа. В таких случаях, если есть понимание, что код будет выполняться постоянно и множеством пользователей — стоит перенести логику в метод общего модуля из расширения, а в самом хранимом коде оставить только вызов этой логики.</p>
<p class="measure-wide">А ещё можно вообще отказаться от хранения кода и сделать весь механизм в виде расширения. Возможно, решение будет менее гибким, но все же это лучше, чем потом медитировать над низким APDEX'ом.</p></description>
        </item>
        
        <item>
            <title>Поездка на Кок-Коль</title>
            <link>https://kostyanetsky.ru/notes/trip-to-kok-kol/</link>
            <guid isPermaLink="false">note-trip-to-kok-kol</guid>
            <pubDate>Sun, 06 Jan 2019 16:23:04 +0700</pubDate>
            <description><p class="measure-wide">Летом катался с друзьями на границу с Монголией (на машинах доехали до Ташанты, а оттуда — на велосипедах до <a class="link blue dim bb" href="http://rasulka.ru/ооо-расул---кок-коль.html">Кок-Коля</a>). Вымотались как проклятые, однако это того определенно стоило — виды с гор невероятно крутые! Одно жаль, животные попадались нечасто — даже чумных сусликов не встретили, хотя их нам каждый встречный анонсировал, включая погранцев :-)</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/4HbJAdYQ-xM" width="560"></iframe></description>
        </item>
        
        <item>
            <title>Знак амперсанда в 1С</title>
            <link>https://kostyanetsky.ru/notes/ampersand-sign-in-1c/</link>
            <guid isPermaLink="false">note-ampersand-sign-in-1c</guid>
            <pubDate>Thu, 27 Dec 2018 10:11:50 +0700</pubDate>
            <description><p class="measure-wide">При обработке символа амперсанда в тексте надписей платформа применяет стандартный подход Windows: то есть, сам амперсанд не отобразится, а следующий после него символ станет горячей клавишей для действия, закрепленного за надписью (например, обработчика команды или события элемента).</p>
<p class="measure-wide">Пример ниже выведется как «Project Costing». Символ «P» в ней будет подчеркнут и станет горячей клавишей; если это, например, заголовок команды, то её можно будет вызвать, нажав Alt + P.</p>
<pre><code>ТекстНадписи = "&amp;Project Costing";
</code></pre>
<p class="measure-wide">Единственное неудобство — если нужно вывести амперсанд прямо в надпись. В этом случае символ следует удвоить: так, пример ниже будет выглядеть как «Project P&amp;L». Никаких горячих клавиш в таком случае создано не будет.</p>
<pre><code>ТекстНадписи = "Project P&amp;&amp;L";
</code></pre></description>
        </item>
        
        <item>
            <title>Как Valve в посудной лавке</title>
            <link>https://kostyanetsky.ru/notes/valve-in-a-china-shop/</link>
            <guid isPermaLink="false">note-valve-in-a-china-shop</guid>
            <pubDate>Mon, 10 Dec 2018 11:28:24 +0700</pubDate>
            <description><p class="measure-wide">Ребята из Valve продолжают заигрывать с поклонниками своих игр — то ли по привычке, то ли там и правда кто-то считает, что это отличный способ напоминать о себе.</p>
<p class="measure-wide">Конечно, с этой компанией как разработчиком игр всё в целом понятно. Мало кто всерьёз ждет третий Half-Life или, скажем, продолжение Portal. Но меня каждый раз умиляет это непринужденное изящество слона в посудной лавке, с которым Valve работает со своей аудиторией.</p>
<div class="blog-embedded-tweet" data-tweet-id="1072013105515913216"><a class="link blue dim bb" href="https://twitter.com/retropcan/status/1072013105515913216">Твит</a></div></description>
        </item>
        
        <item>
            <title>Эффект сноуборда</title>
            <link>https://kostyanetsky.ru/notes/snowboard-effect/</link>
            <guid isPermaLink="false">note-snowboard-effect</guid>
            <pubDate>Sat, 01 Dec 2018 13:58:43 +0700</pubDate>
            <description><p class="measure-wide"><a href="https://kostyanetsky.ru/notes/snowboard-effect/standing.jpg"><img alt="Стою!" src="https://kostyanetsky.ru/notes/snowboard-effect/standing-thumbnail.jpg"/></a> <a href="https://kostyanetsky.ru/notes/snowboard-effect/sitting.jpg"><img alt="Сижу!" src="https://kostyanetsky.ru/notes/snowboard-effect/sitting-thumbnail.jpg"/></a></p>
<p class="measure-wide">Летишь такой вниз по склону, в который раз пытаясь почувствовать точку равновесия и не полететь кубарем, но чувствуешь только отбитую задницу, а из головы не идет знаменитый спич Васа из третьего Far Cry.</p>
<blockquote>
<p class="measure-wide">Я уже говорил тебе, что такое безумие, а? Безумие — это точное повторение одного и того же действия. Раз за разом, в надежде на изменение. Это есть безумие.</p>
<p class="measure-wide"><em>― Ваас Монтенегро, Far Cry 3</em></p>
</blockquote>
<p class="measure-wide">Но вниз все равно приезжаешь невероятно довольный.</p>
<p class="measure-wide">Магия какая-то.</p></description>
        </item>
        
        <item>
            <title>Ссылка нового объекта</title>
            <link>https://kostyanetsky.ru/notes/set-new-object-ref/</link>
            <guid isPermaLink="false">note-set-new-object-ref</guid>
            <pubDate>Thu, 29 Nov 2018 19:22:56 +0700</pubDate>
            <description><p class="measure-wide">Уникальный идентификатор — удобный критерий при сопоставлении объектов в разных конфигурациях. Например, когда нужно передавать инвойсы из одной базы в другую. Как второй базе понять, загружался полученный инвойс или нет? Первое, что приходит в голову — просто выполнить поиск объекта по его UUID:</p>
<pre><code>ИнвойсЗагружен = Документы.Инвойс.ПолучитьСсылку(UUID).Пустая();
</code></pre>
<p class="measure-wide">Однако иногда уникальный идентификатор используют для связи объектов в одной конфигурации. Например, если условия задачи мешают добавить обычный ссылочный реквизит и мы не можем в документе А прямо сослаться на документ Б. Или, скажем, если мы создаем элемент справочника на основании документа и хотим иметь между ними прямую связь — присваивая элементу справочника ссылку, полученную по уникальному идентификатору документа. Платформа гарантирует уникальность идентификатора в пределах таблицы, так что такие трюки вполне безопасны.</p>
<p class="measure-wide">Я это к чему. Метод УстановитьСсылкуНового() в коде нужно использовать с осторожностью! Проверяйте, что ссылка ещё не установлена до выполнения вашего кода:</p>
<pre><code>СсылкаЗадана = ПолучитьСсылкуНового().Пустая();
</code></pre>
<p class="measure-wide">Если ссылка задана, то это надо как-то обработать — либо не заменять её вашей (если логика задачи позволяет), либо создать исключение. Иначе может возникнуть нарушение связности данных, которое будет непросто расследовать — да и вообще заметить.</p>
<p class="measure-wide">Ну и, конечно, эта штука работает в обе стороны — я имею в виду, что установленную вами ссылку тоже может потереть какой-нибудь посторонний код (например, обработчик события объекта или подписка на него). Это надежно решается только тестированием.</p></description>
        </item>
        
        <item>
            <title>Распределенный дизайн</title>
            <link>https://kostyanetsky.ru/notes/distributed-design/</link>
            <guid isPermaLink="false">note-distributed-design</guid>
            <pubDate>Sat, 20 Oct 2018 12:34:45 +0700</pubDate>
            <description><p class="measure-wide">Дизайнер из «Stack Overflow» <a class="link blue dim bb" href="http://www.tedgoas.com/blog/distributed-design">написал</a> о том, как они организуют удаленную работу. Понравилась структура текста — не просто «как мы это делаем», а прямо парами: проблема + решение. В фейсбуке Тимура Козьменко (разработчика из «Avisales») есть частичный <a class="link blue dim bb" href="https://www.facebook.com/timur.kozmenko/posts/1902087259909467">конспект</a> текста и небольшое обсуждение.</p>
<p class="measure-wide">У нас в компании почти вся разработка — удаленная и сам я — тоже удаленщик. Мне очень нравится так работать; главное тут — помнить, как легко нахватать самых неожиданных проблем, когда твое рабочее место и твой дом — одно и то же место. Советы из статьи пить воду и вылезать под солнце вполне себе актуальны, например — в ходе какого-нибудь кранча про это и правда легко забыть.</p></description>
        </item>
        
        <item>
            <title>Идеальное произношение</title>
            <link>https://kostyanetsky.ru/notes/ideal-pronunciation/</link>
            <guid isPermaLink="false">note-ideal-pronunciation</guid>
            <pubDate>Mon, 15 Oct 2018 06:25:01 +0700</pubDate>
            <description><div class="blog-embedded-tweet" data-tweet-id="1051001827104178177"><a class="link blue dim bb" href="https://twitter.com/vanswan/status/1051001827104178177">Твит</a></div>
<p class="measure-wide">Примерно то же самое я услышал несколько лет назад от инженера Bloomberg'а — мы тогда писали для заказчика программу, автоматически следящую за курсами акций, и столкнулись с кучей проблем (для работы с финансовыми инструментами Bloomberg дает мощный, но довольно сложный API).</p>
<p class="measure-wide">В конце концов дело дошло до диалога с техподдержкой, и после обмена несколькими сообщениями коллега предложил пообщаться голосом. Я здорово смутился и заметил, что, мол, так-то можно, но my English isn't fluent enough. На это собеседник лишь пожал плечами: мол, мы привыкли — английский используется повсеместно, и обратная сторона медали в том, что его везде крутят на свой лад. Так что правильное ударение — последнее, что его будет волновать, лишь бы была понятна мысль.</p></description>
        </item>
        
        <item>
            <title>Принцип не-осуждения</title>
            <link>https://kostyanetsky.ru/notes/non-judgmental-attitude/</link>
            <guid isPermaLink="false">note-non-judgmental-attitude</guid>
            <pubDate>Sun, 02 Sep 2018 15:48:30 +0700</pubDate>
            <description><p class="measure-wide">Хорошая <a class="link blue dim bb" href="http://maximilyahov.ru/blog/all/mne-ok">заметка</a> Максима Ильяхова про анализ чего-то такого, что вроде бы вас не касается, но почему-то невероятно раздражает. Напомнило американский принцип не-осуждения, про который я <a class="link blue dim bb" href="https://www.facebook.com/lilya.kim/posts/490845771117074">вычитал</a> в Фейсбуке пару лет назад; тут немного другие формулировки, но суть — точно та же.</p>
<p class="measure-wide">У нас этот подход, в общем, тоже есть — даже в фольклоре осел со знаменитым «не суди и не судим будешь». Жаль, что пока не так широко применяется.</p></description>
        </item>
        
        <item>
            <title>СКД и право просмотра</title>
            <link>https://kostyanetsky.ru/notes/rights-for-dcs/</link>
            <guid isPermaLink="false">note-rights-for-dcs</guid>
            <pubDate>Tue, 28 Aug 2018 20:35:33 +0700</pubDate>
            <description><p class="measure-wide">Универсальный подход системы компоновки данных «если у пользователя нет права на просмотр чего-то, то этого как бы нет» иногда заставляет платформу выкидывать знатные фортели. Нет, сферический отчет в вакууме и правда работает хорошо — например, если нет права на просмотр какого-то справочника, то в отчете он фигурировать не будет. Однако реальные примеры бывают посложнее.</p>
<p class="measure-wide">Например, пару недель назад я отлаживал отчет, который при попытке генерации выдавал понятную на первый взгляд ошибку:</p>
<p class="measure-wide"><img alt="У вас настройка кривая, товарищ!" src="https://kostyanetsky.ru/notes/rights-for-dcs/ru.png"/></p>
<p class="measure-wide">Отчет гигантский — запрос на добрую тысячу строк, сложная настройка, здоровенный макет, запутанный код компоновки. Первое подозрение пало на ошибку в настройке, но расследование быстро дошло от ссылки на валюту в выборке данных до чтения константы с этой валютой на самом нижнем уровне отчета, на которую не было права просмотра.</p>
<p class="measure-wide">Не скажу сходу, что именно тут сбило платформу с толку и привело к не очевидной диагностике — то ли манипуляции с временной таблицей, куда эта константа была прочитана, то ли то, что читалась она в конструкции ВЫБОР, то ли то, что на сам справочник валют все необходимые права были. Искать конкретное условие или их сочетания я не стал — думаю, это просто специфика реализации движка СКД, которая может меняться от версии к версии. Достаточно не забывать о праве просмотра, и проблемы не будет.</p>
<p class="measure-wide">Что касается ошибки, при столкновении с ней стоит вывести проблемный отчет под полными правами. Если тут всё о'кей, нужно набросать список таблиц, откуда отчет читает данные, и проверить — все ли они с правами на чтение и просмотр.</p>
<p class="measure-wide">Нудно, но может сэкономить прилично времени.</p></description>
        </item>
        
        <item>
            <title>Беги от дочери морей</title>
            <link>https://kostyanetsky.ru/notes/jaina/</link>
            <guid isPermaLink="false">note-jaina</guid>
            <pubDate>Sun, 29 Jul 2018 15:44:38 +0700</pubDate>
            <description><p class="measure-wide">Наталья О'Шей озвучила русский ролик для грядущего обновления World of Warcraft. У неё круто получаются такие образы — умеет и настроение создать, и стали в голос припустить.</p>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/5j-S448XC8k" width="560"></iframe>
<p class="measure-wide">Вообще, если говорить о ней и «Мельнице» в целом — самые сильные песни у них именно те, где речь о чем-то конкретном. Были весной на концерте в честь выхода «Люциферазы» — прямо небо и земля; то ли мне не хватало знания контекста, то ли многие тексты и правда были здорово абстрактными, не знаю. Но в итоге местами было трудно понять, о чем песня, и настроение порядком сбивалось.</p>
<p class="measure-wide">А тут даже знать особо ничего не нужно. Я в WoW не играл и не буду, но от финальных интонаций морозом по коже все равно отдает :-)</p></description>
        </item>
        
        <item>
            <title>Печать ГПиМРМ</title>
            <link>https://kostyanetsky.ru/notes/hpmor-printing/</link>
            <guid isPermaLink="false">note-hpmor-printing</guid>
            <pubDate>Sun, 22 Jul 2018 15:44:09 +0700</pubDate>
            <description><p class="measure-wide">Возможно, вы уже слышали про то, что русский перевод «Методов рационального мышления» Элиезера Юдковского пошел в некоммерческую печать (спасибо «Эволюции» и другим инфопартнерам), но на всякий случай напомню ещё раз.</p>
<p class="measure-wide">Книжка и правда хороша, я про неё уже <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/hpmor">писал</a> пару лет назад. Учит правильным штукам и в такой форме, что не оторваться. Текст есть в свободном доступе, но если вы вдруг хотите бумажную копию — <a class="link blue dim bb" href="https://planeta.ru/campaigns/hpmor">прием заявок</a> еще идет.</p></description>
        </item>
        
        <item>
            <title>Результаты FCE</title>
            <link>https://kostyanetsky.ru/notes/fce-results/</link>
            <guid isPermaLink="false">note-fce-results</guid>
            <pubDate>Sun, 15 Jul 2018 10:07:20 +0700</pubDate>
            <description><p class="measure-wide">Кембридж прислал результаты июньских экзаменов. И — вступают трубы — FCE я сдал! Судя по баллам, ухитрился в чём-то налажать во время письменной части, зато неплохо отыгрался во время разговорной. Жаль, что экзаменаторы не дают более подробных комментариев; впрочем, и так понятно, куда дальше воевать :) Преподаватель заметила, что раньше вообще сообщали только итоговый балл — мол, понимайте как хотите, уважаемые претенденты.</p>
<p class="measure-wide">В общем, в следующем году перевешу планку повыше — видимо, нужно готовиться к CAE.</p>
<p class="measure-wide">По этому поводу вспомнился Фейнман со своей знаменитой «Вы, конечно, шутите». Среди прочего он рассказывал, как во время жизни в Бразилии учился играть на фригидейре и доучился до того, что его стали ставить в пример местным музыкантам:</p>
<blockquote>
<p class="measure-wide">Я думаю, это напоминает ситуацию, когда человек, который говорит по-французски, приезжает в Америку. Сначала он делает все ошибки, которые можно сделать, и понимать его очень сложно. Но он непрерывно занимается, до тех пор пока не начинает говорить довольно хорошо, и манера речи этого человека начинает доставлять вам истинное удовольствие: у него очень милый акцент, и его приятно слушать.</p>
<p class="measure-wide"><em>― Ричард Фейнман</em></p>
</blockquote>
<p class="measure-wide">Между «все ошибки» и «приятно слушать» непринужденно опущено целое море труда, но в целом этот синопсис мне нравится. Работаем куда-то туда!</p></description>
        </item>
        
        <item>
            <title>Нарушения велосипедистов</title>
            <link>https://kostyanetsky.ru/notes/cyclist-violations/</link>
            <guid isPermaLink="false">note-cyclist-violations</guid>
            <pubDate>Sun, 01 Jul 2018 11:00:16 +0700</pubDate>
            <description><p class="measure-wide">Неплохой <a class="link blue dim bb" href="https://velonation.bike/2018/05/23/milonov/">текст</a> про самые популярные нарушения, которые совершают велосипедисты. Насчет того, что иногда проигнорить правила безопаснее — прямо в точку: у нас в городе до сих пор не все водители в курсе, что велосипед вообще может двигаться по проезжей части.</p>
<p class="measure-wide">До кучи: <a class="link blue dim bb" href="https://velonation.bike/2016/06/23/pdd/">разбор</a> правил дорожного движения, относящийся к велосипедистам, и небольшая <a class="link blue dim bb" href="https://velonation.bike/2018/06/18/courtesy/">заметка</a> о том, как, собственно, заставить велосипедистов соблюдать эти самые правила.</p></description>
        </item>
        
        <item>
            <title>Momodora: Reverie Under the Moonlight</title>
            <link>https://kostyanetsky.ru/notes/momodora/</link>
            <guid isPermaLink="false">note-momodora</guid>
            <pubDate>Wed, 27 Jun 2018 19:50:27 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/9wJI_VjFqlg" width="560"></iframe>
<p class="measure-wide">Несложная метроидвания без особых претензий. Хорошая пиксельная графика, приятная музыка, отзывчивое управление. Сюжет простой — но не сказал бы, что сделан на отвали.</p>
<p class="measure-wide">Хорошее развлечение на пару вечеров!</p></description>
        </item>
        
        <item>
            <title>Kona</title>
            <link>https://kostyanetsky.ru/notes/kona/</link>
            <guid isPermaLink="false">note-kona</guid>
            <pubDate>Tue, 29 May 2018 17:56:13 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/M6KizfrASRY" width="560"></iframe>
<p class="measure-wide">У игры есть сильные стороны, которые честно старались удержать мое внимание: тут есть где погулять, что почитать, о чем подумать и на что посмотреть. Если вы цените это в играх — возможно, вам понравится. От прогулок и размышлений почти ничего не отвлекает — умереть от чего бы то ни было тут довольно сложно. Ровно как и заблудиться — у главного героя есть карта и автомобиль, а позже можно раздобыть ещё и снегоход.</p>
<p class="measure-wide">Но сюжет меня здорово расстроил. Интригующая детективная завязка, не успев обрасти деталями, тает в воздухе и уступает место откровенной мистике. Всё бы ничего, но вместе с этим исчезает всякая интрига — зачем искать улики, строить догадки, вообще о чём-то волноваться? Необъяснимые видения из ниоткуда расскажут и покажут всё, что и как тут было, и вот ты уже невольно заражаешься меланхоличным отношением героя к паранормальщине вокруг.</p>
<p class="measure-wide">При этом мистическая сторона сюжета сама по себе зияет здоровенными дырами. Да, картина трагедии ближе к концу становится более или менее понятна — но даже последнее, самое полное видение само по себе рождает целую кучу вопросов, на которые никто не трудится отвечать. Сюжет в этой игре вообще здорово напоминает её же карту — выглядит цельным, но по факту доступна от силы половина, а остальное скомкано под отчетливо читаемое «ну, потому что магия, магия такая, понимаете?».</p>
<p class="measure-wide">Нет, блин, не понимаю.</p></description>
        </item>
        
        <item>
            <title>Сообщение пользователю</title>
            <link>https://kostyanetsky.ru/notes/message-to-user/</link>
            <guid isPermaLink="false">note-message-to-user</guid>
            <pubDate>Mon, 30 Apr 2018 09:37:18 +0700</pubDate>
            <description><p class="measure-wide">В 1С:Предприятии есть удобный метод вывода сообщений — объект СообщениеПользователю. Он выводит их в нижней части формы и это, внезапно, потенциальная проблема: дело в том, что большинство пользователей туда не смотрит. Мол, если никаких явных ошибок на экране нет — беспокоиться не о чем.</p>
<p class="measure-wide">Поэтому в случае, когда происходит сбой или просто нужно донести какую-то критично важную информацию, сообщение нужно выводить в диалоговом окне — например, через методы ПоказатьВопрос() или ПоказатьПредупреждение(). В противном случае пользователь может не обратить внимания на проблему и продолжить работу — несмотря на то, что какое-то действие не было выполнено или было выполнено не так. Впоследствии это станет явным и в проблеме (справедливо) обвинят вас.</p>
<p class="measure-wide">До кучи можно вспомнить небольшие служебные формы: в них СообщениеПользователю вообще противопоказано. Да, на маленьком полотне сложнее не заметить всплывший внизу текст, однако тут дело в другом — одно-два сообщения буквально <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/message-to-user/ru.png">пожирают</a> рабочее пространство формы и работать с ней становится неудобно.</p></description>
        </item>
        
        <item>
            <title>Эти мерзкие смартфоны</title>
            <link>https://kostyanetsky.ru/notes/these-nasty-smartphones/</link>
            <guid isPermaLink="false">note-these-nasty-smartphones</guid>
            <pubDate>Sat, 31 Mar 2018 00:00:00 +0700</pubDate>
            <description><p class="measure-wide">По-моему, отличная <a class="link blue dim bb" href="https://www.instagram.com/p/BXTBuGugG5y">иллюстрация</a> к вечному стону «чего они все таращатся в телефоны, бла-бла-бла». Причина проста, как три копейки — у людей в телефоне их друзья и подружки, книжки и подкасты, игры и ютуб. Всё это куда интереснее, чем, скажем, хмурый дядька или мрачная тётка с синдромом гуру.</p>
<p class="measure-wide">То же касается и детей. Соцсети набиты спорами по этому поводу, как бочка селедкой, однако причина проблемы остаётся точно такой же: если подросток при виде вас утыкается в телефон, ему с вами попросту не интересно и проблема, очевидно, в вас самих.</p></description>
        </item>
        
        <item>
            <title>Двойная «i»</title>
            <link>https://kostyanetsky.ru/notes/double-i/</link>
            <guid isPermaLink="false">note-double-i</guid>
            <pubDate>Fri, 09 Mar 2018 13:56:51 +0700</pubDate>
            <description><p class="measure-wide">Разбирался недавно с транслитерацией собственной фамилии. Согласно правилам МИД'а, на английском она пишется как «Kostianetskii» — с двойной «i» в конце. Такое сочетание букв встречается довольно редко — «skiing» единственное частотное слово, которое приходит в голову.</p>
<p class="measure-wide">Мне стало любопытно, почему так, и я загуглил. Точного ответа не нашёл, но одна из возможных причин забавная: пропись! Две «i» рядом только на экране смотрятся хорошо, а когда пытаешься написать их от руки — внезапно получается «u».</p>
<p class="measure-wide">Подробнее и нагляднее про это — <a class="link blue dim bb" href="https://spellingisnotcrazy.weebly.com/blog/category/the-letter-i">здесь</a>.</p></description>
        </item>
        
        <item>
            <title>Разные стороны медали</title>
            <link>https://kostyanetsky.ru/notes/different-sides-of-one-coin/</link>
            <guid isPermaLink="false">note-different-sides-of-one-coin</guid>
            <pubDate>Mon, 05 Mar 2018 00:00:00 +0700</pubDate>
            <description><p class="measure-wide"><img alt="Привет!" src="https://kostyanetsky.ru/notes/different-sides-of-one-coin/ru.png"/></p>
<p class="measure-wide">Фидбек — одна из самых клевых штук в моей профессии. Да, не первый год программирую, да, кучу всего написал, переписал и переделал, и всё равно каждый сложный механизм, наконец заработавший так, как надо — это... Ну, не знаю. Как снова и снова слышать «да» на выпускном бале :-)</p>
<p class="measure-wide">Это несколько компенсирует обратную сторону медали — когда ты, например, в стопятый раз пытаешься разобраться в стопяти уровнях абстракции чьего-то приложения, ошибаешься снова и снова, за окном два часа ночи и вместо крови по венам давно бежит кофе.</p></description>
        </item>
        
        <item>
            <title>Ваши документы</title>
            <link>https://kostyanetsky.ru/notes/papers-please-short-film/</link>
            <guid isPermaLink="false">note-papers-please-short-film</guid>
            <pubDate>Thu, 01 Mar 2018 18:51:09 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/YFHHGETsxkE" width="560"></iframe>
<p class="measure-wide">Крутая экранизация «<a class="link blue dim bb" href="https://store.steampowered.com/app/239030/Papers_Please/">Papers, Please</a>», даром что на десять минут. Савочкин здорово сыграл, да и остальные не подкачали, включая сценариста. Запихнуть в такой хронометраж драму и сюжетный твист — это надо уметь.</p>
<p class="measure-wide">Если вспомнить, что экранизации видеоигр обычно звёзд с небес не хватают — эту можно считать блестящим экземпляром.</p></description>
        </item>
        
        <item>
            <title>Чего так серьезно?</title>
            <link>https://kostyanetsky.ru/notes/why-so-serious/</link>
            <guid isPermaLink="false">note-why-so-serious</guid>
            <pubDate>Sat, 17 Feb 2018 00:00:00 +0700</pubDate>
            <description><p class="measure-wide">Иногда при отладке какого-нибудь сложного механизма не хватает времени на адекватные имена переменных и методов. Как итог — в коде появляются загадочные КакогоФига, ПрименитьМагию и прочие ЖивыеНеудачи.</p>
<p class="measure-wide">Этого нужно избегать, правда. На первый взгляд, конечно, смотрится забавно, но через месяц-другой написанный код нужно будет доработать — и тут-то проблема встанет в полный рост! Материться сквозь зубы на автора не выйдет лишь потому, что автор — ты сам.</p></description>
        </item>
        
        <item>
            <title>White Day</title>
            <link>https://kostyanetsky.ru/notes/white-day/</link>
            <guid isPermaLink="false">note-white-day</guid>
            <pubDate>Wed, 17 Jan 2018 21:16:27 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/VRiYZbAmun4" width="560"></iframe>
<p class="measure-wide">Может, этот хоррор и нишевый, но и правда неплохой. Атмосфера ночной школы, набитой мрачными секретами, удалась на славу — напряжение отпускает редко, а игра то и дело подкидывает сюрпризы там, откуда не ждешь. Я в этом жанре стреляный воробей, а все равно вздрогнуть не раз пришлось.</p>
<p class="measure-wide">Местный сюжет меняется в зависимости от действий игрока, и если хочется добраться до конца истории — одним прохождением никак не обойтись. Но, на мой взгляд, оно того стоит. Например, из-за антагониста — это сравнительно редкий случай, когда он вышел в разы интереснее, привлекательнее и трагичнее, чем протагонисты и все остальные герои вместе взятые.</p></description>
        </item>
        
        <item>
            <title>Выгрузка автобусных рейсов</title>
            <link>https://kostyanetsky.ru/notes/bus-trips-uploading/</link>
            <guid isPermaLink="false">note-bus-trips-uploading</guid>
            <pubDate>Fri, 17 Nov 2017 16:49:35 +0700</pubDate>
            <description><p class="measure-wide">С тех пор, как мы с коллегами заново автоматизировали <a class="link blue dim bb" href="http://kpat.ru/">КПАТ</a>, она работает на «<a class="link blue dim bb" href="http://avibus.pro/standalone/">Управлении автовокзалами</a>». Это конфигурация для 1С:Предприятия, то есть её можно сравнительно быстро интегрировать почти с чем угодно.</p>
<p class="measure-wide">Первым делом мы решили наладить выгрузку маршрутного расписания автобусов на E-Traffic и Яндекс.Расписания.</p>
<h2>Что это за ресурсы?</h2>
<p class="measure-wide">Первый ресурс, <a class="link blue dim bb" href="http://e-traffic.ru">E-Traffic</a> — это крупнейший в России агрегатор данных автовокзалов. Собирает информацию о запланированных рейсах и выступает как агент по продаже электронных билетов. То есть пассажирам не нужно продираться через сайты автовокзалов — на E-Traffic можно купить билет откуда угодно куда угодно.</p>
<p class="measure-wide">Что касается <a class="link blue dim bb" href="http://rasp.yandex.ru">Яндекс.Расписаний</a> — это один из дочерних проектов российского поисковика. Как и E-Traffic, предназначен в первую очередь для пассажиров и умеет быстро строить относительно сложные маршруты с пересадками. Билетами они, правда, не торгуют.</p>
<h2>Как была сделана выгрузка?</h2>
<p class="measure-wide">Поначалу мы нагородили довольно сложную архитектуру, позволяющую транслировать расписание в обе системы. Потели как черти — пока в ходе переговоров не выяснилось, что у E-Traffic уже есть рабочий транспорт для передачи расписания в Яндекс, и задача естественным образом не усохла вдвое.</p>
<p class="measure-wide">Технически всё было сделано в виде веб-сервиса для «Управления автовокзалами». Получив SOAP-запрос от E-Traffic, он собирал внутри информационной базы 1С:Предприятия все необходимые данные о запланированных автобусных рейсах и возвращал их в виде XML-ки.</p>
<p class="measure-wide">Нам даже не пришлось писать код получения расписания с каждого вокзала, входящего в сеть КПАТ'а: все они создаются и хранятся в одном месте — главном узле РИБ, а веб-сервис мы развернули именно там. В итоге больше времени ушло на разные согласования, чем на программирование.</p>
<h2>А где посмотреть?</h2>
<p class="measure-wide">Внутренняя кухня снаружи не видна, да и там ничего необычного — роботы общаются с роботами, эка невидаль :-) Результат их болтовни — куда интереснее! Например, вот <a class="link blue dim bb" href="https://rasp.yandex.ru/search/bus/?fromName=Кемерово&amp;toName=Новокузнецк&amp;fromId=c64&amp;toId=c237&amp;when=сегодня">расписание</a> рейсов из Кемерово в Новокузнецк на сегодня.</p></description>
        </item>
        
        <item>
            <title>Себби x Игрок</title>
            <link>https://kostyanetsky.ru/notes/sebby-x-player/</link>
            <guid isPermaLink="false">note-sebby-x-player</guid>
            <pubDate>Mon, 14 Aug 2017 00:00:00 +0700</pubDate>
            <description><p class="measure-wide">В конце июля я на волне энтузиазма <a class="link blue dim bb" href="https://acomics.ru/~sebby-x-player">перевёл</a> фанатскую мангу по «Stardew Valley», про которую я уже <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/stardew-valley">писал</a> две недели назад.</p>
<p class="measure-wide">Забавный опыт. Во-первых, автор — китаец (точнее, китаянка) и английский язык для неё не родной — как и для меня. В итоге ряд фреймов, скажем так, вызывал вопросы. Во-вторых, я обнаружил, что подыскать русский аналог английской фразы, который бы не выглядел цитатой из документации к порталу госуслуг — само по себе неплохой челлендж.</p>
<p class="measure-wide">Короче, часть смысла по ходу дела, подозреваю, потерялась, хотя я постарался передать что мог и даже списался с автором, разбирая совсем уж непонятные участки. Было весело: я не знаю китайского, она — русского; общались на английском, а он у обоих далёк от идеала.</p>
<p class="measure-wide">Думаю, некоторые фразы можно было сделать поживее, где-то ровнее поправить исходную картинку, но — нафиг. Лучшее — враг хорошего, а результат мне уже нравится. Конечно, в сухом остатке здесь нет чего-то особенно крутого — рисовка как рисовка, сюжет по большей части повторяет игру, но... Не знаю. Наверное, визуальные новеллы сделали из меня чересчур сентиментального сукиного сына :-)</p>
<p class="measure-wide">Спасибо <a class="link blue dim bb" href="https://vk.com/id54890849">Кэт</a> за помощь с отрисовкой, <a class="link blue dim bb" href="https://twitter.com/amish77kin">Лему</a> — за подсказки по переводу и <a class="link blue dim bb" href="https://vk.com/mahrunteka">Марике</a> — за мысль. Ну и, конечно, <a class="link blue dim bb" href="https://curayukie.deviantart.com">Квантусу</a> — за мангу.</p></description>
        </item>
        
        <item>
            <title>Stardew Valley</title>
            <link>https://kostyanetsky.ru/notes/stardew-valley/</link>
            <guid isPermaLink="false">note-stardew-valley</guid>
            <pubDate>Tue, 01 Aug 2017 18:24:37 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/ot7uXNQskhs" width="560"></iframe>
<p class="measure-wide">Невероятно аддиктивный симулятор фермера, сделанный с огромным вниманием к деталям. Серьёзные ребята расскажут про саундтрек, про качественный пиксель-арт и прочие такие штуки, а я так не умею — мне просто офигенно понравилось, вот и всё :-)</p>
<p class="measure-wide">Хотя нет, про саундтрек всё-таки скажу. Зимой в игре иногда играет «<a class="link blue dim bb" href="https://www.youtube.com/watch?v=Zr-PHm_qLgg">Ancient</a>», и это одна из самых простых и одновременно атмосферных мелодий, которые я вообще слышал в видеоиграх.</p></description>
        </item>
        
        <item>
            <title>Layers of Fear</title>
            <link>https://kostyanetsky.ru/notes/layers-of-fear/</link>
            <guid isPermaLink="false">note-layers-of-fear</guid>
            <pubDate>Thu, 06 Jul 2017 21:26:21 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/CyDs5UJfvks" width="560"></iframe>
<p class="measure-wide">Спорная штука. С одной стороны — довольно яркая и сочная картина сумасшествия, показанная «изнутри». Неплохой в целом сюжет, хотя с какого-то момента финал начинает угадываться.</p>
<p class="measure-wide">С другой — фантастическая коридорность, почти полное отсутствие челленджа и логики происходящего. Дело в том, что повествование идет от лица сумасшедшего и внутри его сознания, и это накладывает определённый отпечаток на геймплей — невозможно угадать, что нужно сделать в очередной комнате.</p>
<p class="measure-wide">В итоге просто ходишь, ищешь триггеры и пытаешься понять, что означает очередная фантасмагория вроде плавящегося телефона или взрывающихся часов. Моменты, когда сквозь это прорываются по-настоящему сильные штуки — например, письма главного героя и его жены — редки и ощущаются как глотки свежего воздуха.</p>
<p class="measure-wide">Я в целом не жалею, что прошёл — это тяжелая и грустная история, тщательно нарисованная и хорошо озвученная. Но, сдается мне, в море местного символизма утонуло немало смысла.</p></description>
        </item>
        
        <item>
            <title>Outlast 2</title>
            <link>https://kostyanetsky.ru/notes/outlast-2/</link>
            <guid isPermaLink="false">note-outlast-2</guid>
            <pubDate>Sat, 29 Apr 2017 21:44:23 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/EOrTuPljfPU" width="560"></iframe>
<p class="measure-wide">Не сказать, чтобы прямо провал, но — очень-очень слабо, особенно в сравнении с первой частью или её DLC. Ярких, пугающих, вообще вызывающих эмоции моментов — невероятно мало. Те же, что есть, быстро смываются волной раздражения от очередной смерти.</p>
<p class="measure-wide">Из плюсов — крутая озвучка, неплохая графика, хорошая работа над мелкими деталями. Есть с десяток удачных сцен и полдюжины очень крутых ракурсов, ради которых, возможно, стоит играть. Мир игры вообще более или менее проработан — хотя здесь испытываешь чаще брезгливость да отвращение, а не страх, как в Маунт-Массиве.</p>
<p class="measure-wide">Всё остальное — просто плохо. Корявый стелс в непроглядной темноте; бесконечные заскриптованные погони; блеклые, вяло раскрытые персонажи; частые баги вроде подвисания в воздухе или врагов, проходящих сквозь предметы.</p>
<p class="measure-wide">Как венец — откровенно никакая концовка. Да, она додумывается, конечно, всё выглядит вполне логично, но... Как бы сформулировать. В общем, после восьми часов беготни от психопатов хочется видеть хоть какой-то результат своих усилий. А вместо него получаешь лишь огромное, жаркое, ослепительное нихрена — во всех смыслах.</p></description>
        </item>
        
        <item>
            <title>Firewatch</title>
            <link>https://kostyanetsky.ru/notes/firewatch/</link>
            <guid isPermaLink="false">note-firewatch</guid>
            <pubDate>Sat, 22 Apr 2017 21:50:58 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/WexJcqgismA" width="560"></iframe>
<p class="measure-wide">Обычная, человеческая такая история, и ей совершенно по-человечески чего-то не хватает. Какой-то искры, что ли? Идеи? Смысла? Чем ближе к развязке, тем сильнее становится ощущение, что в кастрюлю забыли налить супа.</p>
<p class="measure-wide">Не, я не хочу сказать, что играть не стоит. Тут <strong>очень</strong> живые и здорово прописанные диалоги, которые делают три четверти атмосферы. Кроме того, игра неплохо выглядит (хотя я не очень понял, откуда в отзывах столько восторгов — в каком-нибудь «The Vanishing of Ethan Carter» виды встречались покруче) и в целом проходится на ура.</p>
<p class="measure-wide">Но концовка сюжета откровенно скомкана, а кульминация просто отсутствует. Да, я в курсе насчёт заложенной философии — мол, это жизнь, бла-бла-бла, многоточий больше чем точек, бла-бла-бла. Но, камон! Если история ставит кучу вопросов и не отвечает ни на один из них — это не очень-то и круто, как ни ссылайся на age-check.</p></description>
        </item>
        
        <item>
            <title>Совершенно несчастный</title>
            <link>https://kostyanetsky.ru/notes/unhappy/</link>
            <guid isPermaLink="false">note-unhappy</guid>
            <pubDate>Fri, 24 Mar 2017 11:35:49 +0700</pubDate>
            <description><p class="measure-wide">Наткнулся на «<a class="link blue dim bb" href="https://theoatmeal.com/comics/unhappy">How to be Perfectly Unhappy</a>» — комикс Мэтью Инмана о счастье, несчастье и том, что вообще стоит за этими словами.</p>
<p class="measure-wide">У мужика отличное чувство юмора — собственно, он и известен как автор юмористических комиксов «The Oatmeal». Когда такие люди говорят о серьёзном, часто получается вот так: забавно, мудро и как-то откровенно, что ли.</p></description>
        </item>
        
        <item>
            <title>Tattletail</title>
            <link>https://kostyanetsky.ru/notes/tattletail/</link>
            <guid isPermaLink="false">note-tattletail</guid>
            <pubDate>Sat, 18 Mar 2017 20:10:00 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/yX01Blu4g94" width="560"></iframe>
<p class="measure-wide">Я понимаю, что разговоры о сюжете в продукте такого уровня сами по себе звучат забавно, но автору всё же следовало выбрать что-то одно: или сумасшедшую машину, или заигрывания с оккультизмом. А так салат вышел довольно сумасбродный и алогичный, хотя при такой продолжительности игры избежать этого было нетрудно.</p>
<p class="measure-wide">Впрочем, своих денег она стоит, так что претензий нет. Правда, <a class="link blue dim bb" href="https://www.youtube.com/watch?v=_gsJWAOyaO0">ролик</a> JT Music по мотивам получился на порядок ярче :-)</p></description>
        </item>
        
        <item>
            <title>Стоп-слова для интерфейсов</title>
            <link>https://kostyanetsky.ru/notes/semiconductors/</link>
            <guid isPermaLink="false">note-semiconductors</guid>
            <pubDate>Sat, 14 Jan 2017 12:09:08 +0700</pubDate>
            <description><p class="measure-wide">Любопытная <a class="link blue dim bb" href="https://bureau.ru/bb/soviet/20161220/">заметка</a> про термины и формулировки, которые лучше не применять при разработке интерфейсов. Позабавила ремарка про аутентификацию и авторизацию.</p>
<p class="measure-wide">И, конечно, список выглядит неполным без знаменитых контактов (и полупроводников) :-)</p></description>
        </item>
        
        <item>
            <title>ГПиМРМ</title>
            <link>https://kostyanetsky.ru/notes/hpmor/</link>
            <guid isPermaLink="false">note-hpmor</guid>
            <pubDate>Sun, 06 Nov 2016 15:32:00 +0700</pubDate>
            <description><p class="measure-wide">Дочитал «Гарри Поттер и методы рационального мышления» — эпический фанфик по сами-знаете-какой вселенной. Автор — крутой спец по искусственному интеллекту и интересен сам по себе, но вот эту его книгу я прямо настойчиво <a class="link blue dim bb" href="http://hpmor.ru">рекомендую</a>.</p>
<p class="measure-wide">В первую очередь — как очень любопытное переосмысление оригинальной саги Джоан Роулинг. Многие аспекты поданы как минимум не менее интересно и выпукло, и вообще интрига закручена отменная — две трети истории я прочитал, не выключая <a class="link blue dim bb" href="https://kostyanetsky.ru/notes/hpmor/gene-wilder-meme.jpg">Джина Уайлдера</a> :-) При этом автор ухитрился свести концы с концами и закрыть сюжетную линию так, что претензий у меня почти не осталось.</p>
<p class="measure-wide">Ну и в любом случае, безотносительно всего — это неплохой способ знакомства с кучей научных, около-научных и просто интересных штук, так или иначе затронутых по ходу дела. Автор умен, и книжка тоже вышла неглупая.</p></description>
        </item>
        
        <item>
            <title>Kholat</title>
            <link>https://kostyanetsky.ru/notes/kholat/</link>
            <guid isPermaLink="false">note-kholat</guid>
            <pubDate>Sun, 23 Oct 2016 17:48:42 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/622TC6IPwT4" width="560"></iframe>
<p class="measure-wide">Чудовищно утомительный геймплей, сводящийся к поискам листочков бумаги. Вялая бессвязная сюжетка, построенная на кое-как склеенных друг с другом мистических версиях гибели группы Дятлова. Как хоррор — полный ноль. Пугаться тут особо нечему — так, слепые монстры да редкие скримеры.</p>
<p class="measure-wide">Радуют только картинка и звук. Те, кто трудился над ними, проделали великолепную работу. Но на выходе, увы, получилась лишь огромная локация, где нет почти никого, где нет почти ничего, где почти нечего и — самое плохое — почти незачем что-то делать.</p></description>
        </item>
        
        <item>
            <title>DOOM</title>
            <link>https://kostyanetsky.ru/notes/doom/</link>
            <guid isPermaLink="false">note-doom</guid>
            <pubDate>Wed, 29 Jun 2016 19:34:09 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/RO90omga8D4" width="560"></iframe>
<p class="measure-wide">Тот случай, когда игра настолько крута, что говорить об этом — максимально душная затея.</p>
<p class="measure-wide">Поступим иначе; не знаю, какой из двух треков лучше передает драйв нового DOOM'а — <a class="link blue dim bb" href="https://www.youtube.com/watch?v=kjIVkl34Vig">Hell to Pay</a> Гэвина Данна или <a class="link blue dim bb" href="https://www.youtube.com/watch?v=hauVRrgEXl8">Fight Like Hell</a> от JT Music — так что сошлюсь и на первый, и на второй.</p></description>
        </item>
        
        <item>
            <title>Feist</title>
            <link>https://kostyanetsky.ru/notes/feist/</link>
            <guid isPermaLink="false">note-feist</guid>
            <pubDate>Thu, 16 Jun 2016 19:54:49 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/Bj9vK75qB_w" width="560"></iframe>
<p class="measure-wide">Короткий, но атмосферный и довольно суровый платформер.</p>
<p class="measure-wide">Чем-то напомнил LIMBO, только здесь не загробный мир, а тёмный и таинственный лес, в котором водятся разумные ежи-забияки :-)</p></description>
        </item>
        
        <item>
            <title>Bioshock Infinite</title>
            <link>https://kostyanetsky.ru/notes/bioshock-infinite/</link>
            <guid isPermaLink="false">note-bioshock-infinite</guid>
            <pubDate>Sun, 10 Jan 2016 22:14:56 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/EsJ55BzIvkE" width="560"></iframe>
<p class="measure-wide">Эта игра — точно не лучшая из «Биошоков» с точки зрения геймплея, но она настолько красива и детализована, что её как-то не тянет ругать. Кроме того, тут есть сурово закрученный сюжет! И Элизабет :-) Тут Дэвид Браун в своей «<a class="link blue dim bb" href="https://www.youtube.com/watch?v=IvvO-ndDLVE">Limelight</a>» уже всё спел, добавить мне нечего.</p>
<p class="measure-wide">Точно буду проходить еще раз — просто чтобы снова на всё посмотреть. Не знаю, правда, как играть в DLC – история Колумбии и её детей закончена, по-моему, настолько, насколько вообще можно закончить какую-то историю.</p></description>
        </item>
        
        <item>
            <title>Gone Home</title>
            <link>https://kostyanetsky.ru/notes/gone-home/</link>
            <guid isPermaLink="false">note-gone-home</guid>
            <pubDate>Wed, 11 Mar 2015 21:58:38 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/x5KJzLsyfBI" width="560"></iframe>
<p class="measure-wide">Короткий и яркий квест. Никакого челленджа, просто история одной семьи, в которой родители за своими проблемами потеряли кое-что очень важное.</p>
<p class="measure-wide">Дневники сестры, мне кажется, можно было вообще убрать из игры — сюжет отлично восстанавливается по вещам, письмам, запискам и фотографиям. Было бы больше загадок и места для расследования.</p>
<p class="measure-wide">Хотя, надо признать, в таком виде всё это чертовски трогательно.</p></description>
        </item>
        
        <item>
            <title>Места лишения свободы</title>
            <link>https://kostyanetsky.ru/notes/places-of-imprisonment/</link>
            <guid isPermaLink="false">note-places-of-imprisonment</guid>
            <pubDate>Mon, 23 Feb 2015 21:33:13 +0700</pubDate>
            <description><p class="measure-wide">Нашел здорово оформленный <a class="link blue dim bb" href="https://kefiijrw.com/army/#intro">дневник</a> российского срочника, ныне — одного из дизайнеров <a class="link blue dim bb" href="https://artlebedev.ru">студии</a> Артемия Лебедева. Написано интересно и с юмором, читается — запоем.</p>
<p class="measure-wide">С праздником всех причастных!</p></description>
        </item>
        
        <item>
            <title>Авибус</title>
            <link>https://kostyanetsky.ru/notes/avibus-pro/</link>
            <guid isPermaLink="false">note-avibus-pro</guid>
            <pubDate>Mon, 16 Feb 2015 21:22:55 +0700</pubDate>
            <description><p class="measure-wide">Конфигурация для 1С:Предприятия, которую мы пару лет назад внедряли на кузбасских автовокзалах, обзавелась симпатичной <a class="link blue dim bb" href="http://avibus.pro/">обложкой</a>.</p>
<p class="measure-wide">По-моему, очень круто! В том числе и тем, что это один из проектов, постепенно разрушающих заплесневелый, но невероятно устойчивый даже среди айтишников миф про 1С — типа, это скучный тормозной софт для бухгалтеров, а настоящие пацаны пишут только на C++ (Java, Javascript, подчеркните, впишите) и тому подобные бредни.</p></description>
        </item>
        
        <item>
            <title>Польза от блога</title>
            <link>https://kostyanetsky.ru/notes/blogging-benefits/</link>
            <guid isPermaLink="false">note-blogging-benefits</guid>
            <pubDate>Sun, 01 Feb 2015 21:12:39 +0700</pubDate>
            <description><p class="measure-wide">Всеволод Устинов написал любопытную <a class="link blue dim bb" href="http://vsevolodustinov.ru/blog/all/o-polze-vedeniya-professionalnogo-bloga/">заметку</a> по поводу ведения рабочего блога.</p>
<p class="measure-wide">Я не уверен насчет формы (блог, статья, презентация «для своих» — не так важно, по-моему), но с одной из основных мыслей согласен на все сто: освоенное, но не записанное и не обдуманное ещё на три раза очень быстро утонет в чашках утреннего кофе.</p></description>
        </item>
        
        <item>
            <title>Движение вперёд</title>
            <link>https://kostyanetsky.ru/notes/move-on/</link>
            <guid isPermaLink="false">note-move-on</guid>
            <pubDate>Tue, 20 Jan 2015 08:12:13 +0700</pubDate>
            <description><p class="measure-wide">Подумалось тут: длинные, тяжелые и сложные задачи — обучение, тренировки, диеты и прочий мрак — становится заметно легче штурмовать, как только понимаешь, что результат тебе действительно нужен.</p>
<p class="measure-wide">Вот сидишь ты с комфортом на условном нуле и наконец подрываешься худеть, или там к MBA готовиться, не знаю. Мозоли неприятно ноют и вообще отстой, может не так уж этот MBA и нужен, да и вместо утренней прогулки лучше поспать; однако после первого же подхода (покорпел над курсом, побегал трусцой, кефира навернул вместо булочки) ловишь себя на скрытых, но офигенно сильных эндорфинах: ба, а я-то молодец, я все делаю правильно, я двигаюсь вперед!</p>
<p class="measure-wide">И наоборот — фейлишь вот (тупишь в какой-нибудь шутер вместо книги, трескаешь печенье вместо творога, а в спортзал что-то совсем некогда) и отсутствие эндорфинов качает мотивацию. В итоге сегодня пожевал печенья, потом неделю на него смотреть не можешь — не потому, что не хочется, а потому что опять на месте топчешься и тюфяк.</p>
<p class="measure-wide">То есть движение вперед вполне себе наркотик — при условии, что ты точно знаешь, где находится это самое вперед и точно знаешь, что тебе туда надо.</p></description>
        </item>
        
        <item>
            <title>Alien: Isolation</title>
            <link>https://kostyanetsky.ru/notes/alien-isolation/</link>
            <guid isPermaLink="false">note-alien-isolation</guid>
            <pubDate>Fri, 16 Jan 2015 17:27:05 +0700</pubDate>
            <description><iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/7h0cgmvIrZw" width="560"></iframe>
<p class="measure-wide">Отменный, по-честному — без скримеров — пугающий хоррор. Анимация Чужого и его охотничьи повадки выше всяких похвал: игра в кошки-мышки с монстром, попытки угадать или услышать, где он находится, истеричный писк детектора движения, слюна, капающая из вентиляции, чьи-то предсмертные вопли поблизости, панический поиск укрытий — всё это держит в диком напряжении всю игру.</p>
<p class="measure-wide">Даже когда у Рипли появляется возможность прогонять монстра, это мало что меняет. Он, может, и сбежит (если успеешь выстрелить и попадешь), но вернётся очень быстро, будет в два раза злее и сунет нос в каждый угол.</p>
<p class="measure-wide">В минусы проекту можно записать <s>деревянную анимацию лиц персонажей и мелкие огрехи стелса</s> кнопки Tab и Escape, которые ставят игру на паузу и позволяют успокоить расшатанные нервы :-)</p></description>
        </item>
        
        <item>
            <title>Совсем ленивые</title>
            <link>https://kostyanetsky.ru/notes/completely-lazy/</link>
            <guid isPermaLink="false">note-completely-lazy</guid>
            <pubDate>Fri, 12 Sep 2014 07:58:01 +0700</pubDate>
            <description><p class="measure-wide">Дочка спрашивает: пап, а что значит «молиться»?</p>
<p class="measure-wide">Я объясняю — смотри, мол, некоторые люди верят в могущественное существо, которое живет на небе и управляет всем-всем-всем. Люди время от времени это существо о чем-то просят, вот это и называется молитвой.</p>
<p class="measure-wide">Мелкая, подумав:</p>
<p class="measure-wide">— Пап, эти люди, они совсем ленивые, да?</p>
<p class="measure-wide"><a href="https://kostyanetsky.ru/notes/completely-lazy/little-one.jpg"><img alt="Совсем-совсем?" src="https://kostyanetsky.ru/notes/completely-lazy/little-one-thumbnail.jpg"/></a></p></description>
        </item>
        
        <item>
            <title>Зомби! Бежим!</title>
            <link>https://kostyanetsky.ru/notes/zombies-run/</link>
            <guid isPermaLink="false">note-zombies-run</guid>
            <pubDate>Tue, 26 Aug 2014 08:16:53 +0700</pubDate>
            <description><p class="measure-wide">Я, как и все толстяки, не очень-то люблю бегать и трай-хард со мной не проходит абсолютно — два-три дня волевых усилий и всё, матушка лень да батюшка стрём.</p>
<p class="measure-wide">Пришлось как следует заморочиться с мотивацией; в итоге нашлась смартфонная игрушка «<a class="link blue dim bb" href="https://zombiesrungame.com/">Zombies, Run!</a>». По факту — тупо плеер, втыкаешь плейлист и идешь гулять. Однако привычные треки перемежаются незатейливым сюжетом про выживание в типичном зомбиленде: твой вертолёт потерпел крушение и ты пытаешься добраться до выживших. Ищешь припасы, медикаменты... И вокруг тебя зомби, так что если хочешь жить — шевели задницей.</p>
<p class="measure-wide">Джи-и-изус Христ! Это офигительно. Не знаю, заслуга это игры или моего воображения, но сотни тысяч фрагов в Left 4 Dead мне не помогли никак — под рычание за спиной бежится невероятно хорошо! Игра, причем, беспристрастно сообщает, на каком расстоянии очередной мертвец; когда один такой прыгнул ко мне разом на сорок метров — я выдал, наверное, лучший спринт в своей жизни.</p>
<p class="measure-wide"><img alt="Йее!" src="https://kostyanetsky.ru/notes/zombies-run/escapologist.jpg"/></p>
<p class="measure-wide">(под конец второй прогулки runner five, вдобавок, повредил ногу и начал очень аутентично хромать, что добавило драматизма и погружения в атмосферу)</p></description>
        </item>
        
        <item>
            <title>Шмот под левел</title>
            <link>https://kostyanetsky.ru/notes/gear-suitability/</link>
            <guid isPermaLink="false">note-gear-suitability</guid>
            <pubDate>Sun, 13 Jul 2014 14:12:34 +0700</pubDate>
            <description><p class="measure-wide">Слегка обновил летний гардероб. Без привычных килограммов почувствовал себя в примерочной кем-то вроде персонажа MMORPG, который апнул уровень и теперь может таскать шмот поинтереснее.</p>
<p class="measure-wide">Проблемы, в общем, примерно те же, включая извечный вопрос «а надо ли мне покупать этот лайт сет, если скоро новый левел-ап».</p></description>
        </item>
        
        <item>
            <title>Выбор</title>
            <link>https://kostyanetsky.ru/notes/my-school/</link>
            <guid isPermaLink="false">note-my-school</guid>
            <pubDate>Thu, 05 Jun 2014 22:02:34 +0700</pubDate>
            <description><p class="measure-wide">Дочка усердно расчесывает ногу. Говорю ей: эй, не чеши, болеть будет. Она на меня серьезно так смотрит и отвечает: пап, это мой выбор, чесать или не чесать.</p>
<p class="measure-wide">Не нашел, что возразить.</p>
<p class="measure-wide"><img alt="Моя школа!" src="https://kostyanetsky.ru/notes/my-school/bender.jpg"/></p></description>
        </item>
        
        <item>
            <title>Столп света</title>
            <link>https://kostyanetsky.ru/notes/pillar-of-light/</link>
            <guid isPermaLink="false">note-pillar-of-light</guid>
            <pubDate>Mon, 07 Apr 2014 16:43:54 +0700</pubDate>
            <description><p class="measure-wide">Чтение собственного прошлогоднего кода отчетливо отдает мазохизмом: ага, вот тут я неявный запрос в цикле организовал, а вот тут — получил таблицу остатков и зачем-то сгруппировал её. Молодец, дружище!</p>
<p class="measure-wide">С другой стороны, это хоть какой-то индикатор роста. Игры играми, но в реальной жизни порой жуть как не хватает каких-нибудь столпов света, падающих с небес при получении нового уровня.</p></description>
        </item>
        
        <item>
            <title>Рецепт торта</title>
            <link>https://kostyanetsky.ru/notes/cake-recipe/</link>
            <guid isPermaLink="false">note-cake-recipe</guid>
            <pubDate>Tue, 03 Dec 2013 21:43:16 +0700</pubDate>
            <description><p class="measure-wide">На курсах английского разбирали тему кухни — посуда, мебель, еда, вот это всё. Зачитал <a class="link blue dim bb" href="https://www.youtube.com/watch?v=fXzr5iwGFfE">рецепт торта</a> из Portal как пример блюда, которое готовится из множества компонентов. Имел определенный успех :-)</p>
<p class="measure-wide">Кстати, редкий случай отличной локализации: в русской версии игры этот монолог (да и все остальные реплики GLaDOS) звучат куда выразительнее.</p></description>
        </item>
        
        <item>
            <title>Кегли на дороге</title>
            <link>https://kostyanetsky.ru/notes/skittles/</link>
            <guid isPermaLink="false">note-skittles</guid>
            <pubDate>Mon, 03 Jun 2013 21:43:12 +0700</pubDate>
            <description><p class="measure-wide">Интересно, какому проценту пешеходов, переходящих дорогу где придется, реально тяжело добраться до зебры, а какому — просто плевать на последствия? Недавно прочитал «<a class="link blue dim bb" href="http://mymaster.livejournal.com/344609.html">Откровения кегли</a>» (клёвую заметку Антона Буслова про ситуацию с зебрами с точки зрения больного человека) — но мне всё равно трудно поверить, что все эти упитанные и совсем не старые люди настолько измотаны, что не могут добраться до перехода.</p>
<p class="measure-wide">Ладно я, велосипед легко маневрирует и быстро тормозит. А вот что испытывают водители автомобилей и мотоциклов — боюсь представить.</p></description>
        </item>
        
        <item>
            <title>Спокойного сна</title>
            <link>https://kostyanetsky.ru/notes/silent-night/</link>
            <guid isPermaLink="false">note-silent-night</guid>
            <pubDate>Wed, 17 Apr 2013 21:37:46 +0700</pubDate>
            <description><p class="measure-wide">Ночью в Березовском невероятно тихо. Большие города так крепко засыпать не умеют — всегда кто-нибудь по улицам шляется, машины ездят, музыку слышно, собаки какие-нибудь воют.</p>
<p class="measure-wide">А тут — ни души, одни бесконечные фонари да сонные светофоры. И мертвая тишина. Вообще ни единого звука — только эхо собственных шагов.</p>
<p class="measure-wide">Ощущение... Странное. Как будто я попал в какой-нибудь, не знаю, Сайлент Хилл или Припять, а не в маленький шахтерский городок.</p></description>
        </item>
        
        <item>
            <title>План на поездку</title>
            <link>https://kostyanetsky.ru/notes/trip-plan/</link>
            <guid isPermaLink="false">note-trip-plan</guid>
            <pubDate>Mon, 25 Mar 2013 08:42:02 +0700</pubDate>
            <description><p class="measure-wide">Укатил в Екатеринбург на конференцию по софту для автовокзалов. Наказал Кэт слушаться дочку, а дочке — слушаться Кэт. Подозреваю, их ждет веселая неделя.</p>
<p class="measure-wide"><a href="https://kostyanetsky.ru/notes/trip-plan/plan.jpg"><img alt="План" src="https://kostyanetsky.ru/notes/trip-plan/plan-thumbnail.jpg"/></a></p>
<p class="measure-wide">Вернусь в субботу. Скучайте.</p></description>
        </item>
        
        <item>
            <title>Орлы-телепаты</title>
            <link>https://kostyanetsky.ru/notes/eagles/</link>
            <guid isPermaLink="false">note-eagles</guid>
            <pubDate>Sat, 09 Mar 2013 08:28:52 +0700</pubDate>
            <description><p class="measure-wide">Почерк у Кэт такой, что опытные медики давятся от зависти. Сегодня, если верить записке, она попросила по дороге домой купить четыре шурупных ведра и двенадцать орлов-телепатов.</p>
<p class="measure-wide">Ладно шурупы, но где мне добыть орлов? Да и еще и телепатов?</p>
<p class="measure-wide">Я в растерянности, жизнь прожита зря.</p></description>
        </item>
        
        <item>
            <title>Частная станция</title>
            <link>https://kostyanetsky.ru/notes/theme-hospital/</link>
            <guid isPermaLink="false">note-theme-hospital</guid>
            <pubDate>Sun, 03 Feb 2013 12:22:46 +0700</pubDate>
            <description><p class="measure-wide">Кассы Беловского автовокзала изнутри остро напомнили старый-престарый симулятор больницы для DOS — «<a class="link blue dim bb" href="https://ru.wikipedia.org/wiki/Theme_Hospital">Theme Hospital</a>».</p>
<p class="measure-wide">Во всяком случае я, когда играл, кабинеты терапевтов делал по тому же принципу: одинаковые квадратные комнатки, урна строго в одном углу, цветок строго в другом углу, батарея строго под окном и так далее :-)</p></description>
        </item>
        
    </channel>
</rss>